<!DOCTYPE html>

<html>
<head>
  <title>analyze.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="app.html">
                  app.js
                </a>
              
                
                <a class="source" href="PrenostikUser.html">
                  PrenostikUser.js
                </a>
              
                
                <a class="source" href="accounts.html">
                  accounts.js
                </a>
              
                
                <a class="source" href="accountsCommon.html">
                  accountsCommon.js
                </a>
              
                
                <a class="source" href="categories.html">
                  categories.js
                </a>
              
                
                <a class="source" href="corpaccounts.html">
                  corpaccounts.js
                </a>
              
                
                <a class="source" href="login.html">
                  login.js
                </a>
              
                
                <a class="source" href="analyze.html">
                  analyze.js
                </a>
              
                
                <a class="source" href="category.html">
                  category.js
                </a>
              
                
                <a class="source" href="categoryUpdate.html">
                  categoryUpdate.js
                </a>
              
                
                <a class="source" href="dataset.html">
                  dataset.js
                </a>
              
                
                <a class="source" href="home.html">
                  home.js
                </a>
              
                
                <a class="source" href="snapshot.html">
                  snapshot.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>analyze.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> toast = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../lib/toast'</span>),
  hbs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hbsfy/runtime'</span>),
  _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>),
  form = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../lib/form'</span>),
  store = <span class="hljs-built_in">require</span>(<span class="hljs-string">'store'</span>),
  Q = <span class="hljs-built_in">require</span>(<span class="hljs-string">'q'</span>),
  Backbone = <span class="hljs-built_in">require</span>(<span class="hljs-string">'backbone'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>templates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> analyzeViewTpl = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../templates/trending.hbs'</span>),
  listWorksheetsTableTpl = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../templates/list-worksheets-table.hbs'</span>),
  trendingChartsTpl = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../templates/trending-charts.hbs'</span>),
  topCorrelationTableTpl = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../templates/top-correlation-table.hbs'</span>),
  bestPredictorModelTableTpl = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../templates/best-predictor-model-table.hbs'</span>),
  forecastEqualizerTpl = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../../templates/forecast-equalizer.hbs'</span>);


<span class="hljs-keyword">var</span> PrenostikUser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../app/PrenostikUser'</span>);
<span class="hljs-keyword">var</span> accountsCommon = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../app/accountsCommon'</span>);

Backbone.$ = $;

<span class="hljs-keyword">var</span> dateToUTC = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(date)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(),
  date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds());
};


<span class="hljs-keyword">var</span> AnalyzeView = Backbone.View.extend({

  el: $(<span class="hljs-string">'#container'</span>),

  template: analyzeViewTpl,

  events: {
      <span class="hljs-string">'click .btn-tab'</span>: <span class="hljs-string">'tabHandler'</span>,
      <span class="hljs-string">'click .btn-remove-tab'</span>: <span class="hljs-string">'removeTabHandler'</span>,
      <span class="hljs-string">'click .btn-create-tab'</span>: <span class="hljs-string">'createTabHandler'</span>,
      <span class="hljs-string">'click .btn-rename-tab'</span>: <span class="hljs-string">'renameTabHandler'</span>,
      <span class="hljs-string">'click .btn-tab .icon-remove-sign'</span>: <span class="hljs-string">'secondaryRemoveTabHandler'</span>,
      <span class="hljs-string">'click .btn-save-worksheet'</span>: <span class="hljs-string">'saveWorksheetHandler'</span>,
      <span class="hljs-string">'click a[href="#simple"]'</span>: <span class="hljs-string">'printHandlerSimple'</span>,
      <span class="hljs-string">'click a[href="#all"]'</span>: <span class="hljs-string">'printHandler'</span>,
      <span class="hljs-string">'click .btn-options-clone'</span>: <span class="hljs-string">'optionsHandler'</span>,
      <span class="hljs-string">'click .btn-cancel'</span>: <span class="hljs-string">'optionsHandler'</span>,
      <span class="hljs-string">'click .btn-save'</span> : <span class="hljs-string">'saveModalHandler'</span>,
      <span class="hljs-string">'click .btn-open-worksheet'</span>: <span class="hljs-string">'openWsModalHandler'</span>,
      <span class="hljs-string">'click .btn-open'</span>: <span class="hljs-string">'openWorksheetHandler'</span>,
  },

  initialize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(socket, snapshotId)</span> </span>{
    _.bindAll(<span class="hljs-keyword">this</span>, <span class="hljs-string">'render'</span>, <span class="hljs-string">'close'</span>);
    <span class="hljs-keyword">this</span>.ctx = <span class="hljs-string">'.analyze-controller'</span>;
    <span class="hljs-keyword">this</span>.socket = socket;
    <span class="hljs-keyword">this</span>.ctxSocket = socket;
    <span class="hljs-keyword">this</span>.snapshotId = snapshotId;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Snapshot ID'</span>, <span class="hljs-keyword">this</span>.snapshotId);
    <span class="hljs-keyword">this</span>.render();
    <span class="hljs-keyword">this</span>.ctxTrending = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.ctxForecast = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.updateCachedSnapshots();
  },

  close: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.ctxTrending){
      <span class="hljs-keyword">this</span>.ctxTrending.remove();
    }

    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.ctxForecast){
      <span class="hljs-keyword">this</span>.ctxForecast.remove();
    }
  },

  remove: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">this</span>.$el.empty().off(); <span class="hljs-comment">/* off to unbind the events */</span>
      <span class="hljs-keyword">this</span>.stopListening();
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },

  prepareRemove: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(cb)</span></span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> unsavedTabs = $(<span class="hljs-string">'.tab-buttons .unsaved-indicator'</span>);
    <span class="hljs-keyword">var</span> hasEmptyTabs = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span>(unsavedTabs.length &gt; <span class="hljs-number">0</span>){

      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; unsavedTabs.length; i++){
        <span class="hljs-keyword">var</span> elem = $(unsavedTabs[i]).parent();
        <span class="hljs-keyword">if</span>(elem.data(<span class="hljs-string">'default'</span>)){
          hasEmptyTabs = <span class="hljs-literal">true</span>;
          <span class="hljs-keyword">break</span>;
        }
      }
    }

    <span class="hljs-keyword">if</span>(hasEmptyTabs){
      <span class="hljs-keyword">var</span> html = <span class="hljs-string">'&lt;p class="lead text-center"&gt;Empty snapshots will be lost. Are you sure you want to continue?&lt;/p&gt;'</span>;
      bootbox.confirm(html, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(result)</span></span>{
        cb(result);
      });
    } <span class="hljs-keyword">else</span> {
      cb(<span class="hljs-literal">true</span>);
    }


  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $.isLoading({ text: <span class="hljs-string">"Loading Analyze View"</span>});
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

    self.delegateEvents(self.events);
    $.ajax({
        url: <span class="hljs-string">'/analyze/render'</span>,
        dataType: <span class="hljs-string">'json'</span>,
        success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
          <span class="hljs-keyword">var</span> data = {
            datasets: response
          };
          hbs.registerHelper(<span class="hljs-string">'YYYY-MM-DD'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(date)</span> </span>{
            <span class="hljs-keyword">return</span> moment(date).utc().format(<span class="hljs-string">'YYYY-MM-DD'</span>);
          });

          <span class="hljs-built_in">console</span>.log(data);

          $(<span class="hljs-string">'#container'</span>).html(self.template(data));
          $.isLoading(<span class="hljs-string">'hide'</span>);
          Highcharts.setOptions({
            chart: {
              style: {
                fontFamily: <span class="hljs-string">'"Lato", sans-serif'</span>
              }
            }
          });

          self.ctxTrending = <span class="hljs-keyword">new</span> TrendingView({parent: self});
          self.ctxForecast = <span class="hljs-keyword">new</span> ForecastView({parent: self});
          form.init();

          <span class="hljs-keyword">var</span> snapshotData,
            cachedSnapshots = [];
          <span class="hljs-keyword">var</span> snapshotsObj = store.get(<span class="hljs-string">'snapshots'</span>);
          <span class="hljs-keyword">if</span> (snapshotsObj) {
            cachedSnapshots = <span class="hljs-built_in">Object</span>.keys(snapshotsObj);
          }
          <span class="hljs-keyword">var</span> totalCachedSnapshots = cachedSnapshots.length;
          <span class="hljs-keyword">if</span> (totalCachedSnapshots &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">var</span> isLast = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">var</span> loadCacheTimeout = <span class="hljs-number">500</span>;
            <span class="hljs-keyword">var</span> futures = [];
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; cachedSnapshots.length; i++){
              <span class="hljs-keyword">var</span> snapshot = cachedSnapshots[i];
              snapshotData = store.get(snapshot);
              <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Snapshot data"</span>, snapshotData);
              <span class="hljs-keyword">if</span> (i === cachedSnapshots.length - <span class="hljs-number">1</span>) {
                isLast = <span class="hljs-literal">true</span>;
              }
              <span class="hljs-keyword">if</span>(snapshotData.worksheetId &amp;&amp; !<span class="hljs-built_in">isNaN</span>(<span class="hljs-built_in">parseInt</span>(snapshotData.worksheetId))){
                <span class="hljs-keyword">if</span>(<span class="hljs-built_in">parseInt</span>(snapshotData.worksheetId) !== <span class="hljs-built_in">parseInt</span>(self.snapshotId)){
                  <span class="hljs-keyword">var</span> cachedWorksheetId = snapshotData.worksheetId;
                  setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(snapshotId, isLast)</span></span>{
                    futures.push(self.loadSnapshot(<span class="hljs-built_in">parseInt</span>(snapshotId), isLast));
                  }(cachedWorksheetId, isLast), loadCacheTimeout);
                }
                loadCacheTimeout += <span class="hljs-number">500</span>;

              } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span>(futures.length &gt; <span class="hljs-number">0</span>){
                  Q.all(futures).then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
                    self.createTabWithOptions(snapshotData, isLast);
                    futures = [];
                  });
                }
              }
            }
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span>(!self.snapshotId) {
              self.createTab();
              setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                $(<span class="hljs-string">'.btn-options'</span>).trigger(<span class="hljs-string">'click'</span>);
              }, <span class="hljs-number">500</span>);
            }
          }

          <span class="hljs-keyword">var</span> loadTabTimeout = totalCachedSnapshots * <span class="hljs-number">500</span>;
          <span class="hljs-keyword">if</span>(self.snapshotId){</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>if snapshotId is found, load it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
              self.loadSnapshot(<span class="hljs-built_in">parseInt</span>(self.snapshotId), <span class="hljs-literal">true</span>);
            }, <span class="hljs-number">500</span> + loadTabTimeout);
          }
          self.delegateEvents(self.events);
        }
      });

    $(<span class="hljs-string">'html'</span>).attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'analyze-controller trending-template'</span>);
  },

  openWsModalHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    e.preventDefault();
    <span class="hljs-keyword">this</span>.loadModal();
  },

  openWorksheetHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    e.stopPropagation();
    e.preventDefault();
    $(<span class="hljs-string">'#openWorksheetModal'</span>).modal(<span class="hljs-string">'hide'</span>);
    <span class="hljs-keyword">var</span> worksheetId = $(e.currentTarget).data(<span class="hljs-string">'worksheetid'</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Opening snapshot:"</span>, worksheetId);
    <span class="hljs-keyword">var</span> href = <span class="hljs-string">'/analyze/trending/'</span> + worksheetId;
    <span class="hljs-built_in">window</span>.router.navigate(href, {trigger: <span class="hljs-literal">false</span>})
    <span class="hljs-keyword">this</span>.loadSnapshot(<span class="hljs-built_in">parseInt</span>(worksheetId), <span class="hljs-literal">true</span>);
  },

  saveModalHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">this</span>.showSaveModal();
  },

  tabHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
    <span class="hljs-keyword">this</span>.goToSection($(e.currentTarget).data(<span class="hljs-string">'section'</span>));
  },

  removeTabHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> currentTab = <span class="hljs-keyword">this</span>.getCurrentTab();
    <span class="hljs-keyword">var</span> snapshotName = currentTab.find(<span class="hljs-string">'span.name'</span>).text();
    <span class="hljs-keyword">if</span>(!currentTab.data(<span class="hljs-string">'default'</span>) &amp;&amp; currentTab.children(<span class="hljs-string">'.unsaved-indicator'</span>).length &gt; <span class="hljs-number">0</span>){
      <span class="hljs-keyword">var</span> html = <span class="hljs-string">'&lt;p class="lead text-center"&gt;Are you sure you want to delete unsaved snapshot?&lt;/p&gt;'</span>;
      bootbox.confirm(html, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(result)</span></span>{
        <span class="hljs-keyword">if</span>(result){
          <span class="hljs-keyword">var</span> snapshots = store.get(<span class="hljs-string">'snapshots'</span>);
          <span class="hljs-keyword">if</span> (snapshots) {
            <span class="hljs-keyword">delete</span> snapshots[snapshotName];
            store.set(<span class="hljs-string">'snapshots'</span>, snapshots);
            store.remove(snapshotName);
          }
          self.removeTab(self.getCurrentTab().data(<span class="hljs-string">'section'</span>));
        }
      });
    } <span class="hljs-keyword">else</span> {

      <span class="hljs-keyword">var</span> snapshots = store.get(<span class="hljs-string">'snapshots'</span>);
      <span class="hljs-keyword">if</span> (snapshots) {
        <span class="hljs-keyword">delete</span> snapshots[snapshotName];
        store.set(<span class="hljs-string">'snapshots'</span>, snapshots);
        store.remove(snapshotName);
      }
      <span class="hljs-keyword">this</span>.removeTab(<span class="hljs-keyword">this</span>.getCurrentTab().data(<span class="hljs-string">'section'</span>));
    }
  },

  secondaryRemoveTabHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> currentTab = $(e.currentTarget).parent();
    <span class="hljs-keyword">var</span> snapshotName = currentTab.find(<span class="hljs-string">'span.name'</span>).text();
    e.stopPropagation();
    <span class="hljs-keyword">if</span>(!currentTab.data(<span class="hljs-string">'default'</span>) &amp;&amp; currentTab.children(<span class="hljs-string">'.unsaved-indicator'</span>).length &gt; <span class="hljs-number">0</span>){
      <span class="hljs-keyword">var</span> html = <span class="hljs-string">'&lt;p class="lead text-center"&gt;Are you sure you want to delete unsaved snapshot?&lt;/p&gt;'</span>;
      bootbox.confirm(html, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(result)</span></span>{
        <span class="hljs-keyword">if</span>(result){
          <span class="hljs-keyword">var</span> snapshots = store.get(<span class="hljs-string">'snapshots'</span>);
          <span class="hljs-keyword">if</span> (snapshots) {
            <span class="hljs-keyword">delete</span> snapshots[snapshotName];
            store.set(<span class="hljs-string">'snapshots'</span>, snapshots);
            store.remove(snapshotName);
          }
          self.removeTab(currentTab.data(<span class="hljs-string">'section'</span>));

        }
      });
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">var</span> snapshots = store.get(<span class="hljs-string">'snapshots'</span>);
      <span class="hljs-keyword">if</span> (snapshots) {
        <span class="hljs-keyword">delete</span> snapshots[snapshotName];
        store.set(<span class="hljs-string">'snapshots'</span>, snapshots);
        store.remove(snapshotName);
      }
      self.removeTab(currentTab.data(<span class="hljs-string">'section'</span>));

    }

  },

  createTabHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">this</span>.createTab();
  },

  renameTabHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> currentTabName = <span class="hljs-keyword">this</span>.getCurrentTab().find(<span class="hljs-string">'span.name'</span>).text();
    <span class="hljs-keyword">var</span> worksheetNames = [];

    <span class="hljs-keyword">var</span> $tab = $(<span class="hljs-string">'.tab-buttons .btn.active'</span>);
    <span class="hljs-keyword">var</span> rawDataText = $tab.data(<span class="hljs-string">'data_raw'</span>);

    <span class="hljs-keyword">var</span> getSnapshots = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">var</span> worksheetNames = [];

      $.ajax({
        url: <span class="hljs-string">'/api/snapshots/list'</span>,
        dataType: <span class="hljs-string">'json'</span>,
        beforeSend: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
          $.isLoading({
            text: <span class="hljs-string">"Loading All Snapshot Names"</span>,
            position:<span class="hljs-string">'overlay'</span>});
        },
        complete: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
          $.isLoading(<span class="hljs-string">'hide'</span>);
        },
        error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(msg)</span></span>{
          deferred.reject(msg);
        },
        success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; response.length; j++) {
            <span class="hljs-keyword">var</span> obj1 = response[j];
            worksheetNames.push(obj1.name);
          }
          deferred.resolve(worksheetNames);
        }
      });
      <span class="hljs-keyword">return</span> deferred.promise;
    };

    getSnapshots().then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(worksheetNames)</span></span>{


        <span class="hljs-keyword">var</span> div = bootbox.prompt(<span class="hljs-string">'Rename/Copy Snapshot'</span>, <span class="hljs-string">'Cancel'</span>, <span class="hljs-string">'Rename'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tabName, cloneRequest)</span> </span>{
          <span class="hljs-keyword">if</span>(!cloneRequest){
            <span class="hljs-keyword">if</span> (_.contains(worksheetNames, tabName)) {
              toastr.error(<span class="hljs-string">"Snapshot Name Already Exists"</span>, <span class="hljs-string">'&lt;i class="icon-ban-circle"&gt;&lt;/i&gt; &lt;span&gt;'</span> + <span class="hljs-string">"Error"</span> + <span class="hljs-string">'&lt;/span&gt;'</span>);
              <span class="hljs-keyword">return</span>;
            }
          }

          <span class="hljs-keyword">if</span> (tabName === <span class="hljs-literal">null</span>) {
            tabName = self.currentTabName;
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(cloneRequest){
            <span class="hljs-keyword">if</span>(tabName === currentTabName){
              <span class="hljs-keyword">var</span> newTabName;
              <span class="hljs-keyword">var</span> counter = <span class="hljs-number">1</span>;
              <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){
                newTabName = tabName + <span class="hljs-string">' ('</span>+ counter +<span class="hljs-string">')'</span>;
                <span class="hljs-keyword">if</span>(worksheetNames.indexOf(newTabName) === -<span class="hljs-number">1</span>){
                  tabName = newTabName;
                  <span class="hljs-keyword">break</span>;
                }
                counter++;
              }
            }

            <span class="hljs-keyword">var</span> worksheetId = self.getCurrentTab().find(<span class="hljs-string">'input#worksheetId'</span>).val();

            <span class="hljs-keyword">var</span> cloneSnapshot = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
              <span class="hljs-keyword">var</span> deferred = Q.defer();

              $.ajax({
                url: <span class="hljs-string">'/api/snapshots/clone/'</span> + worksheetId,
                data: {
                  name: tabName
                },
                method: <span class="hljs-string">'post'</span>,
                dataType: <span class="hljs-string">'json'</span>,
                beforeSend: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                  $.isLoading({
                    text: <span class="hljs-string">"Copying Snapshot"</span>,
                    position:<span class="hljs-string">'overlay'</span>});
                },
                complete: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
                  $.isLoading(<span class="hljs-string">'hide'</span>);
                },
                error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span></span>{
                  deferred.reject(res);
                },
                success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
                  <span class="hljs-keyword">if</span> (response.id) {
                    toast.notifySuccess(<span class="hljs-string">'Success'</span>, <span class="hljs-string">'Snapshot cloned successfully.'</span>);
                    deferred.resolve(response.id);
                  } <span class="hljs-keyword">else</span> {
                    toast.notifyError(<span class="hljs-string">'Error'</span>, <span class="hljs-string">'Unable to clone snapshot:'</span> + response.error);
                    deferred.reject(response);
                  }
                }
              });

              <span class="hljs-keyword">return</span> deferred.promise;

            };


            cloneSnapshot().then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(worksheetId)</span></span>{

              $.ajax({
                  url: <span class="hljs-string">'/api/snapshots/get/'</span>+worksheetId,
                  dataType: <span class="hljs-string">'json'</span>,
                  beforeSend: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                    $.isLoading({
                      text: <span class="hljs-string">"All done! Opening Copied Snapshot"</span>,
                      position:<span class="hljs-string">'overlay'</span>});
                  },
                  complete: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
                    $.isLoading(<span class="hljs-string">'hide'</span>);
                  },
                  success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
                    <span class="hljs-keyword">if</span>(response.data !== <span class="hljs-string">''</span>){
                      self.createTabForWorksheet(response);
                    }
                  }
                });

            });


          } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>var $tab = $(‘.tab-buttons .btn.active’);
var name = $(‘.tab-buttons .btn.active .name’).text();</p>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>var options = $tab.data(‘options’);
var data_correlation = $tab.data(‘data_correlation’);
var data_correlationtable = $tab.data(‘data_correlationtable’);
var data_sequence = $tab.data(‘data_sequence’);
var data_sequencetable = $tab.data(‘data_sequencetable’);
var data_bestpredictor = $tab.data(‘data_bestpredictor’);
var data_bestpredictortable = $tab.data(‘data_bestpredictortable’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> worksheetId = self.getCurrentTab().find(<span class="hljs-string">'input#worksheetId'</span>).val();

            $.ajax({
              url: <span class="hljs-string">'/api/snapshots/update'</span>,
              data: {
                id: worksheetId,
                data: rawDataText,
                name: tabName
              },
              method: <span class="hljs-string">'post'</span>,
              dataType: <span class="hljs-string">'json'</span>,
              success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
                <span class="hljs-keyword">if</span> (response.success) {
                  self.renameTab(self.getCurrentTab(), tabName);
                  self.onSaveWorksheetSuccess(response);
                  toast.notifySuccess(<span class="hljs-string">'Success'</span>, <span class="hljs-string">'Snapshot updated successfully.'</span>);
                  self.renameTab(self.getCurrentTab(), tabName);
                } <span class="hljs-keyword">else</span> {
                  <span class="hljs-keyword">if</span> (response.error === <span class="hljs-string">'Worksheet does not exist'</span>) {
                    self.renameTab(self.getCurrentTab(), tabName);
                  } <span class="hljs-keyword">else</span> {
                    toast.notifyError(<span class="hljs-string">'Error'</span>, <span class="hljs-string">'Unable to update worksheet:'</span> + response.error);
                  }
                }
              }
            });
          }
        }, currentTabName, <span class="hljs-string">'Copy'</span>);

        $(div).find(<span class="hljs-string">'input'</span>).css({
          <span class="hljs-string">'margin-bottom'</span>: <span class="hljs-string">'80px'</span>
        })

        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
          $(div).find(<span class="hljs-string">'input'</span>).autocomplete({
            source: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(request, response)</span> </span>{
              <span class="hljs-keyword">var</span> results = $.ui.autocomplete.filter(worksheetNames, request.term);
              response(results.slice(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>));
            }
          });
        }, <span class="hljs-number">500</span>);

    });

  },
  printHandlerSimple: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    $(<span class="hljs-string">".correlation-table, .table-striped"</span>).css(<span class="hljs-string">"display"</span>,<span class="hljs-string">"none"</span>);
    <span class="hljs-built_in">window</span>.print();
    $(<span class="hljs-string">".correlation-table, .table-striped"</span>).css(<span class="hljs-string">"display"</span>,<span class="hljs-string">"block"</span>);
  },
  printHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-built_in">window</span>.print();</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>LH: get section class analyze-section with display is block. Meaning the current shown chart section
var section = $(‘<div/>‘).append($(“.analyze-section[style*=’display: block’]”).clone()).html();
var section = $(‘<div/>‘).append($(“html”).clone()).html();
var $head =  $(‘<div/>‘).append($(“head”).clone()).html();
var $body =  $(‘<div/>‘).append($(“body”).clone()).html();</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>var mywindow = window.open(‘’, ‘Correlation Chart’, ‘height=800,width=900’);
mywindow.document.write(‘<html><head><title>Correlation Chart</title>‘);
mywindow.document.write(‘<link rel="stylesheet" href="/css/app2.css" type="text/css" />‘);
mywindow.document.write(‘</head><body>‘);
mywindow.document.write(section);
mywindow.document.write(‘<script src="/js/app.min.js"></script>‘);
mywindow.document.write(‘</body></html>‘);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        mywindow.document.write(<span class="hljs-string">'&lt;html lang="en" class="analyze-controller trending-template"&gt;&lt;head&gt;'</span>);
        mywindow.document.write($head);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>mywindow.document.write(‘<link rel="stylesheet" href="/css/app2.css" type="text/css" />‘);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        mywindow.document.write(<span class="hljs-string">'&lt;/head&gt;&lt;body&gt;'</span>);
        mywindow.document.write($body);
        mywindow.document.write(<span class="hljs-string">'&lt;/body&gt;&lt;/html&gt;'</span>);
        mywindow.document.close();
        mywindow.focus();</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>setTimeout(function(){
mywindow.print();
mywindow.close();
}, 1000);//wait for highchart to finished</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  },
  saveWorksheetHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> $tab = $(<span class="hljs-string">'.tab-buttons .btn.active'</span>);
    <span class="hljs-keyword">var</span> name = $(<span class="hljs-string">'.tab-buttons .btn.actibe .name'</span>).text();

    <span class="hljs-keyword">var</span> worksheetNames = [];

    $.ajax({
      url: <span class="hljs-string">'/api/snapshots/list'</span>,
      dataType:<span class="hljs-string">'json'</span>,
      success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; response.length; j++) {
          <span class="hljs-keyword">var</span> obj1 = response[j];
          worksheetNames.push(obj1.name);
        }
      }
    });

    <span class="hljs-keyword">var</span> div = bootbox.prompt(<span class="hljs-string">'Snapshot Name'</span>, <span class="hljs-string">'Cancel'</span>, <span class="hljs-string">'Ok'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tabName)</span> </span>{
      <span class="hljs-keyword">if</span>(_.contains(worksheetNames, tabName)) {
        toastr.error(<span class="hljs-string">"Snapshot Name Already Exists"</span>, <span class="hljs-string">'&lt;i class="icon-ban-circle"&gt;&lt;/i&gt;'</span>)
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (tabName === <span class="hljs-literal">null</span> || tabName.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

      $(<span class="hljs-string">'.tab-buttons .btn.active .name'</span>).text(tabName);

      $.ajax({
        url: <span class="hljs-string">'/api/snapshots/add'</span>,
        data: {
          rawResults: $tab.data(<span class="hljs-string">'data_raw'</span>),
          options: $.data($tab[<span class="hljs-number">0</span>], <span class="hljs-string">'options'</span>),
          name: tabName
        },
        beforeSend: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
          $.isLoading({ text: <span class="hljs-string">"Saving Snapshot"</span>});
        },
        complete: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
          $.isLoading(<span class="hljs-string">'hide'</span>);
        },
        method: <span class="hljs-string">'post'</span>,
        dataType: <span class="hljs-string">'json'</span>,
        success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
          <span class="hljs-keyword">if</span>(response.success) {
            self.onSaveWorksheetSuccess(response);
            toast.notifySuccess(<span class="hljs-string">'Success'</span>, <span class="hljs-string">'Snapshot saved successfully.'</span>);
            <span class="hljs-keyword">var</span> snapshots = store.get(<span class="hljs-string">'snapshots'</span>);
            <span class="hljs-keyword">if</span> (snapshots) {
              <span class="hljs-keyword">delete</span> snapshots[name];
              store.set(<span class="hljs-string">'snapshots'</span>, snapshots);
              store.remove(name);
            }
          } <span class="hljs-keyword">else</span> {
            toast.notifyError(<span class="hljs-string">'Error'</span>, <span class="hljs-string">'Unable to save snapshot.'</span>);
          }
        }
      });
    }, name);

    $(div).find(<span class="hljs-string">'input'</span>).css({
      <span class="hljs-string">'margin-bottom'</span>: <span class="hljs-string">'80px'</span>
    })


    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
      $(div).find(<span class="hljs-string">'input'</span>).autocomplete({
        source: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(request, response)</span> </span>{
          <span class="hljs-keyword">var</span> results = $.ui.autocomplete.filter(worksheetNames, request.term);
          response(results.slice(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>));
        }
      });
    }, <span class="hljs-number">500</span>);

  },

  optionsHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    $(<span class="hljs-string">'.btn-options'</span>).trigger(<span class="hljs-string">'click'</span>);
    e.preventDefault();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>loadSnapshot is taking longer than createTabWithOptions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  loadSnapshot: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(snapshotId, isLast)</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'*****LOADING SNAPSHOT WITH ID:'</span>, snapshotId);
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> deferred = Q.defer()

    <span class="hljs-keyword">var</span> openSnapshots = <span class="hljs-keyword">this</span>.getOpenSnapshotIds();
    <span class="hljs-keyword">if</span>(openSnapshots.indexOf(snapshotId) &gt; -<span class="hljs-number">1</span>){
      toastr.error(<span class="hljs-string">"Snapshot Already Opened"</span>, <span class="hljs-string">'&lt;i class="icon-ban-circle"&gt;&lt;/i&gt; &lt;span&gt;'</span> + <span class="hljs-string">"Error"</span> + <span class="hljs-string">'&lt;/span&gt;'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    $.ajax({
      url: <span class="hljs-string">'/api/snapshots/get/'</span> + snapshotId,
      beforeSend: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

          $(<span class="hljs-string">'body'</span>).isLoading({
            text: <span class="hljs-string">"Opening Snapshot"</span>,
            position: <span class="hljs-string">"overlay"</span>
          });
      },
      complete: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">if</span>(isLast){
          setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
            $(<span class="hljs-string">'body'</span>).isLoading(<span class="hljs-string">'hide'</span>);
          }, <span class="hljs-number">500</span>);
        }
      },
      dataType: <span class="hljs-string">'json'</span>,
      success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
        <span class="hljs-keyword">if</span>(response.data === <span class="hljs-string">''</span>) {
          self.createTabForWorksheetAndSubmit(response);
        } <span class="hljs-keyword">else</span> {
          self.createTabForWorksheet(response);
        }
        deferred.resolve(response);
      }
    });

    <span class="hljs-keyword">return</span> deferred.promise;
  },

  checkRemainingTabs: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> remainingTabs = $(<span class="hljs-string">'.btn-tab'</span>);
    <span class="hljs-keyword">if</span>(remainingTabs.length === <span class="hljs-number">0</span>) {
      $(<span class="hljs-string">'.btn-options'</span>).hide();
      $(<span class="hljs-string">'.btn-rename-tab'</span>).hide()
      $(<span class="hljs-string">'.btn-save-worksheet'</span>).hide()
      <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#trendingOptions'</span>).hasClass(<span class="hljs-string">'open'</span>)) {
        $(<span class="hljs-string">'#trendingOptions'</span>).removeClass(<span class="hljs-string">'open'</span>);
        $(<span class="hljs-string">'#trendingOptions'</span>).css(<span class="hljs-string">'visibility'</span>, <span class="hljs-string">'hidden'</span>);
      }
    } <span class="hljs-keyword">else</span> {
      $(<span class="hljs-string">'.btn-options'</span>).show();
    }
  },

  updateCachedSnapshots: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

      <span class="hljs-keyword">var</span> filterWorksheets = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(worksheets)</span> </span>{
        <span class="hljs-keyword">var</span> snapshots = [];
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; worksheets.length; i++){
           snapshots.push(worksheets[i].name);
        }
        <span class="hljs-keyword">return</span> snapshots;
      }

      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'updating snapshots'</span>);
      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">var</span> support = <span class="hljs-keyword">new</span> accountsCommon();
      <span class="hljs-keyword">var</span> currentUser = support.getAuthUser();
      <span class="hljs-keyword">var</span> snapshots = store.get(<span class="hljs-string">'snapshots'</span>);
      self.snapshots = snapshots;
      <span class="hljs-keyword">if</span>(snapshots &amp;&amp; <span class="hljs-keyword">typeof</span> snapshots !== <span class="hljs-string">"undefined"</span>){
        $.ajax({
          url: <span class="hljs-string">'/api/snapshots'</span>,
          dataType: <span class="hljs-string">'json'</span>,
          success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
            <span class="hljs-keyword">var</span> validSnapshots = filterWorksheets(data);
            <span class="hljs-keyword">var</span> snapshots = <span class="hljs-built_in">JSON</span>.parse(self.snapshots);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> snapshots){
              <span class="hljs-built_in">console</span>.log(key);
              <span class="hljs-keyword">if</span> (snapshots.hasOwnProperty(key) &amp;&amp; validSnapshots.indexOf(key) === -<span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>delete snapshot from cache and from view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Deleting key:"</span>, key);
                <span class="hljs-keyword">delete</span> snapshots[key];
                store.remove(key+<span class="hljs-string">':'</span>+currentUser.id);
                $(<span class="hljs-string">'.btn.btn-tab'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(i, elem)</span></span>{
                    <span class="hljs-keyword">var</span> snapshotName = $(elem).find(<span class="hljs-string">'.name'</span>).text();
                    <span class="hljs-keyword">if</span>(snapshotName === key) {
                      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Snapshot name being deleted:"</span>, snapshotName);
                      <span class="hljs-built_in">console</span>.log($(elem).data(<span class="hljs-string">'section'</span>));
                      self.removeTab($(elem).data(<span class="hljs-string">'section'</span>), <span class="hljs-string">'called'</span>);
                    }
                })
              }
              store.set(<span class="hljs-string">'snapshots'</span>, snapshots);
              <span class="hljs-keyword">delete</span> self[snapshots];
            }
          },
          error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
            <span class="hljs-built_in">console</span>.log(e);
            <span class="hljs-keyword">delete</span> self[snapshots];
          }
        });
      }
  },

  tabCount: <span class="hljs-number">0</span>,

  analyzeToolbarSelector: <span class="hljs-string">'#analyzeToolbar'</span>,
  tabsArray: [],

  currentSection: <span class="hljs-literal">null</span>,

  getOpenSnapshotIds: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
     <span class="hljs-keyword">var</span> snapshotIds = [];
     <span class="hljs-keyword">var</span> openTabs = [];
     <span class="hljs-keyword">var</span> cachedTabs = [];

     <span class="hljs-keyword">var</span> tabs = $(<span class="hljs-string">'.btn.btn-tab'</span>);
     <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Number of tabs queried"</span>, tabs.length);

     _.each(tabs, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(elem)</span></span>{
        openTabs.push($.trim($(elem).text()));
     });

     <span class="hljs-keyword">var</span> snapshotsObj = store.get(<span class="hljs-string">'snapshots'</span>);
     <span class="hljs-keyword">if</span>(snapshotsObj){
       cachedTabs = <span class="hljs-built_in">Object</span>.keys(snapshotsObj);
     }

     <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Cached Tabs"</span>, cachedTabs);
     <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Open Tabs"</span>, openTabs);

     unOpenedSnapshots = _.difference(cachedTabs, openTabs);

     <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'unOpenedSnapshots'</span>, unOpenedSnapshots);

     <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; tabs.length; i++){
       <span class="hljs-keyword">var</span> tab = tabs[i];
       <span class="hljs-keyword">var</span> worksheetId = <span class="hljs-built_in">parseInt</span>($(tab).find(<span class="hljs-string">'#worksheetId'</span>).val());
       <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'worksheetID: '</span>, worksheetId);
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> worksheetId !== <span class="hljs-string">'undefined'</span> &amp;&amp; !<span class="hljs-built_in">isNaN</span>(worksheetId)){
          <span class="hljs-built_in">console</span>.log(worksheetId);
          snapshotIds.push(worksheetId);
        }
     }
     <span class="hljs-keyword">return</span> snapshotIds;
  },

  goToSection: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, noCalculate)</span> </span>{

      <span class="hljs-keyword">if</span>(noCalculate === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> noCalculate === <span class="hljs-string">'undefined'</span>){
        <span class="hljs-keyword">var</span> noCalculate = <span class="hljs-literal">false</span>;
      }

      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'.section-'</span> + <span class="hljs-keyword">this</span>.currentSection)) {
        <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'.tab-buttons .btn.active .unsaved-indicator'</span>).length) {
          self.ctxTrending.saveOptionsToTab();
        }
        $(<span class="hljs-string">'.section-'</span> + <span class="hljs-keyword">this</span>.currentSection).hide();
      }
      <span class="hljs-keyword">this</span>.currentSection = name;
      $(<span class="hljs-string">'.section-'</span> + name).show();
      $(<span class="hljs-string">'.btn'</span>, <span class="hljs-keyword">this</span>.analyzeToolbarSelector).removeClass(<span class="hljs-string">'active'</span>);
      $(<span class="hljs-string">'.btn[data-section="'</span> + name + <span class="hljs-string">'"]'</span>, <span class="hljs-keyword">this</span>.analyzeToolbarSelector).addClass(<span class="hljs-string">'active'</span>);
      <span class="hljs-keyword">if</span> (name.indexOf(<span class="hljs-string">'tab'</span>) !== -<span class="hljs-number">1</span>) {
        $(<span class="hljs-string">'.tab-toolbar'</span>).show();
        <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'.tab-buttons .btn.active .unsaved-indicator'</span>).length) {
          $(<span class="hljs-string">'.tab-toolbar .btn-save-worksheet'</span>).show();
          $(<span class="hljs-string">'.tab-toolbar .btn-rename-tab'</span>).hide().parent().removeClass(<span class="hljs-string">'btn-group'</span>);
        } <span class="hljs-keyword">else</span> {
          $(<span class="hljs-string">'.tab-toolbar .btn-rename-tab'</span>).show();
          $(<span class="hljs-string">'.tab-toolbar .btn-save-worksheet'</span>).hide().parent().removeClass(<span class="hljs-string">'btn-group'</span>);
        }
      } <span class="hljs-keyword">else</span> {
        $(<span class="hljs-string">'.tab-toolbar'</span>).hide();
      }
      <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#trendingOptions'</span>).hasClass(<span class="hljs-string">'open'</span>)) {
        $(<span class="hljs-string">'#trendingOptions'</span>).removeClass(<span class="hljs-string">'open'</span>);
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
          $(<span class="hljs-string">'#trendingOptions'</span>).css(<span class="hljs-string">'visibility'</span>, <span class="hljs-string">'hidden'</span>);
        }, <span class="hljs-number">250</span>);
      }

      <span class="hljs-keyword">this</span>.setOptionsFromTab();
      self.ctxTrending.saveOptionsToTab();

      <span class="hljs-keyword">var</span> presetOptions = $(<span class="hljs-string">'.btn[data-section="'</span> + <span class="hljs-keyword">this</span>.currentSection + <span class="hljs-string">'"]'</span>).data(<span class="hljs-string">'options'</span>);
      <span class="hljs-keyword">var</span> isDefaultTab = $(<span class="hljs-string">'.tab-buttons .btn.active'</span>).data(<span class="hljs-string">'default'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>if (presetOptions) {
  var presetOptionsObj = JSON.parse(presetOptions);
  var defaultOptionsObj = self.ctxTrending.getDefaultOptionValues();
  delete presetOptionsObj.dataStreamStart;
  delete presetOptionsObj.dataStreamEnd;
  delete presetOptionsObj.section;
  $(window).trigger(‘resize’);
  if (_.isEqual(presetOptionsObj, defaultOptionsObj)) {
    isDefaultTab = true;
  } else {
    isDefaultTab = false;
  }
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      <span class="hljs-keyword">if</span> (isDefaultTab === <span class="hljs-literal">true</span>) {
        $(<span class="hljs-string">'.tab-toolbar .btn-save-worksheet'</span>).hide();
      }

      <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'.section-'</span> + name).children(<span class="hljs-string">'#emptyCalculationMessage'</span>).is(<span class="hljs-string">':visible'</span>) &amp;&amp; presetOptions &amp;&amp; !isDefaultTab &amp;&amp; !noCalculate) {
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
          self.ctxTrending.performChartCalculations();
        }, <span class="hljs-number">250</span>);
      }
  },

  setOptionsFromTab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'.btn[data-section="'</span> + <span class="hljs-keyword">this</span>.currentSection + <span class="hljs-string">'"]'</span>).data(<span class="hljs-string">'options'</span>)) {
        <span class="hljs-keyword">this</span>.ctxTrending.setOptionValues(<span class="hljs-built_in">JSON</span>.parse($(<span class="hljs-string">'.btn[data-section="'</span> + <span class="hljs-keyword">this</span>.currentSection + <span class="hljs-string">'"]'</span>).data(<span class="hljs-string">'options'</span>)));
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.ctxTrending.setDefaultOptionValues();
      }
  },

  createTabWithOptionsAndSubmit: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> displayedTabCount = <span class="hljs-keyword">this</span>.tabCount;
    displayedTabCount++;

    <span class="hljs-keyword">var</span> $tab = $(<span class="hljs-string">'&lt;div class="btn btn-tab" data-section="tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">'"&gt;&lt;i class="icon-asterisk unsaved-indicator"&gt;&lt;/i&gt;&lt;span class="name"&gt;New Snapshot '</span> + displayedTabCount + <span class="hljs-string">'&lt;/span&gt; &amp;nbsp;&amp;nbsp; &lt;i class="icon-remove-sign"&gt;&lt;/i&gt;&lt;/div&gt;'</span>);
    $(<span class="hljs-string">'.tab-buttons'</span>).append($tab);

    <span class="hljs-keyword">var</span> $section = $(<span class="hljs-string">'.analyze-section.section-trending'</span>).clone();
    $section.removeClass(<span class="hljs-string">'section-trending'</span>);
    $section.addClass(<span class="hljs-string">'section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount);
    $section.hide();
    $(<span class="hljs-string">'.analyze-sections'</span>).append($section);
    self.ctxTrending.buildChartContainer($section);
    $(<span class="hljs-string">'.section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">' .trending-charts'</span>).hide();

    <span class="hljs-keyword">var</span> options = self.ctxTrending.getOptionValues();
    $tab.data(<span class="hljs-string">'options'</span>, <span class="hljs-built_in">JSON</span>.stringify(options));

    <span class="hljs-keyword">this</span>.goToSection(<span class="hljs-string">'tab'</span> + <span class="hljs-keyword">this</span>.tabCount);
    <span class="hljs-keyword">this</span>.tabsArray.push({
      tab: $tab,
      section: $section,
      name: <span class="hljs-string">"tab"</span> + <span class="hljs-keyword">this</span>.tabCount
    });

    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      self.ctxTrending.performChartCalculations();
    }, <span class="hljs-number">250</span>);

    <span class="hljs-keyword">this</span>.tabCount++;
    self.checkRemainingTabs();
  },

  createTabWithOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(snapshotData, isLast)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> $tab;
    <span class="hljs-keyword">if</span> (snapshotData.isUnsaved) {
      $tab = $(<span class="hljs-string">'&lt;div class="btn btn-tab" data-section="tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">'"&gt;&lt;i class="icon-asterisk unsaved-indicator"&gt;&lt;/i&gt;&lt;span class="name"&gt;'</span> + snapshotData.name + <span class="hljs-string">'&lt;/span&gt; &amp;nbsp;&amp;nbsp; &lt;i class="icon-remove-sign"&gt;&lt;/i&gt;&lt;/div&gt;'</span>);
    } <span class="hljs-keyword">else</span> {
      $tab = $(<span class="hljs-string">'&lt;div class="btn btn-tab" data-section="tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">'"&gt;&lt;span class="name"&gt;'</span> + snapshotData.name + <span class="hljs-string">'&lt;/span&gt; &amp;nbsp;&amp;nbsp; &lt;i class="icon-remove-sign"&gt;&lt;/i&gt;&lt;input id="worksheetId" type="hidden" value="'</span>+ snapshotData.worksheetId+<span class="hljs-string">'"/&gt;&lt;/div&gt;'</span>);
    }
    $(<span class="hljs-string">'.tab-buttons'</span>).append($tab);

    <span class="hljs-keyword">var</span> $section = $(<span class="hljs-string">'.analyze-section.section-trending'</span>).clone();
    $section.removeClass(<span class="hljs-string">'section-trending'</span>);
    $section.addClass(<span class="hljs-string">'section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount);
    $section.hide();
    $(<span class="hljs-string">'.analyze-sections'</span>).append($section);
    self.ctxTrending.buildChartContainer($section);
    $(<span class="hljs-string">'.section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">' .trending-charts'</span>).hide();

    $tab.data(<span class="hljs-string">'options'</span>, snapshotData.data);

    <span class="hljs-keyword">this</span>.tabsArray.push({
      tab: $tab,
      section: $section,
      name: <span class="hljs-string">"tab"</span> + <span class="hljs-keyword">this</span>.tabCount
    });

    <span class="hljs-keyword">if</span> (isLast) {
      <span class="hljs-keyword">this</span>.goToSection(<span class="hljs-string">'tab'</span> + <span class="hljs-keyword">this</span>.tabCount, <span class="hljs-literal">true</span>);
      setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        self.ctxTrending.performChartCalculations();
      }, <span class="hljs-number">250</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>ctxTrending.performChartCalculations();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">this</span>.tabCount++;
    self.checkRemainingTabs();
  },

  createTab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> displayedTabCount = <span class="hljs-keyword">this</span>.tabCount;
    displayedTabCount++;

    <span class="hljs-keyword">var</span> $tab = $(<span class="hljs-string">'&lt;div class="btn btn-tab" data-default=true data-section="tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">'"&gt;&lt;i class="icon-asterisk unsaved-indicator"&gt;&lt;/i&gt;&lt;span class="name"&gt;New Snapshot '</span> + displayedTabCount + <span class="hljs-string">'&lt;/span&gt; &amp;nbsp;&amp;nbsp; &lt;i class="icon-remove-sign"&gt;&lt;/i&gt;&lt;/div&gt;'</span>);
    $(<span class="hljs-string">'.tab-buttons'</span>).append($tab);

    <span class="hljs-keyword">var</span> $section = $(<span class="hljs-string">'.analyze-section.section-trending'</span>).clone();
    $section.removeClass(<span class="hljs-string">'section-trending'</span>);
    $section.addClass(<span class="hljs-string">'section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount);
    $section.hide();
    $(<span class="hljs-string">'.analyze-sections'</span>).append($section);
    <span class="hljs-keyword">this</span>.ctxTrending.buildChartContainer($section);
    $(<span class="hljs-string">'.section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">' .trending-charts'</span>).hide();
    <span class="hljs-keyword">this</span>.goToSection(<span class="hljs-string">'tab'</span> + <span class="hljs-keyword">this</span>.tabCount);
    <span class="hljs-keyword">this</span>.tabsArray.push({
      tab: $tab,
      section: $section,
      name: <span class="hljs-string">"tab"</span> + <span class="hljs-keyword">this</span>.tabCount
    });

    <span class="hljs-keyword">this</span>.tabCount++;
    <span class="hljs-keyword">this</span>.checkRemainingTabs();
  },

  createTabForWorksheet: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
    $(<span class="hljs-string">'body'</span>).isLoading({
          text: <span class="hljs-string">"Generating data"</span>,
          position: <span class="hljs-string">"overlay"</span>
        });
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> tabName = data.name;

    <span class="hljs-keyword">var</span> $tab = $(<span class="hljs-string">'&lt;div class="btn btn-tab" data-section="tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">'"&gt;&lt;span class="name"&gt;'</span> + tabName + <span class="hljs-string">'&lt;/span&gt; &amp;nbsp;&amp;nbsp; &lt;i class="icon-remove-sign"&gt;&lt;/i&gt;&lt;input id="worksheetId" type="hidden" value="'</span> + data.id + <span class="hljs-string">'"/&gt;&lt;/div&gt;'</span>);
    $(<span class="hljs-string">'.tab-buttons'</span>).append($tab);

    <span class="hljs-keyword">var</span> rawData = data.data;
    $tab.data(<span class="hljs-string">'data_raw'</span>, <span class="hljs-built_in">JSON</span>.stringify(rawData)); <span class="hljs-comment">//so we can manipulate scenarios</span>

    <span class="hljs-keyword">var</span> $section = $(<span class="hljs-string">'.analyze-section.section-trending'</span>).clone();
    $section.removeClass(<span class="hljs-string">'section-trending'</span>);
    $section.addClass(<span class="hljs-string">'section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount);
    $section.hide();

    $(<span class="hljs-string">'.analyze-sections'</span>).append($section);
    self.ctxTrending.buildChartContainer($section);
    $(<span class="hljs-string">'.section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">' #emptyCalculationMessage'</span>).hide();
    $(<span class="hljs-string">'.section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">' #trendingChartLoader'</span>).show();
    <span class="hljs-keyword">this</span>.goToSection(<span class="hljs-string">'tab'</span> + <span class="hljs-keyword">this</span>.tabCount);


    self.ctxTrending.buildWorksheetInTab(data, <span class="hljs-string">'.section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount);
    self.ctxTrending.setOptionValues(data.data.params);

    self.ctxTrending.saveOptionsToTab();
    self.ctxTrending.cacheOptions();
    <span class="hljs-keyword">this</span>.tabsArray.push({
      tab: $tab,
      section: $section,
      name: <span class="hljs-string">"tab"</span> + <span class="hljs-keyword">this</span>.tabCount
    });
    <span class="hljs-keyword">this</span>.tabCount++;
    self.checkRemainingTabs();
    $(<span class="hljs-string">'body'</span>).isLoading(<span class="hljs-string">'hide'</span>);
  },

  createTabForWorksheetAndSubmit: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">var</span> displayedTabCount = <span class="hljs-keyword">this</span>.tabCount;
      displayedTabCount++;

      <span class="hljs-keyword">var</span> tabName = data.name;

      <span class="hljs-keyword">var</span> $tab = $(<span class="hljs-string">'&lt;div class="btn btn-tab" data-section="tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">'"&gt;&lt;span class="name"&gt;'</span> + tabName + <span class="hljs-string">'&lt;/span&gt; &amp;nbsp;&amp;nbsp; &lt;i class="icon-remove-sign"&gt;&lt;/i&gt;&lt;input id="worksheetId" type="hidden" value="'</span> + data.id + <span class="hljs-string">'"/&gt;&lt;/div&gt;'</span>);
      $(<span class="hljs-string">'.tab-buttons'</span>).append($tab);
      <span class="hljs-keyword">var</span> $section = $(<span class="hljs-string">'.analyze-section.section-trending'</span>).clone();
      $section.removeClass(<span class="hljs-string">'section-trending'</span>);
      $section.addClass(<span class="hljs-string">'section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount);
      $section.hide();

      $(<span class="hljs-string">'.analyze-sections'</span>).append($section);
      $(<span class="hljs-string">'.section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">' #emptyCalculationMessage'</span>).hide();
      $(<span class="hljs-string">'.section-tab'</span> + <span class="hljs-keyword">this</span>.tabCount + <span class="hljs-string">' #trendingChartLoader'</span>).show();
      <span class="hljs-keyword">this</span>.goToSection(<span class="hljs-string">'tab'</span> + <span class="hljs-keyword">this</span>.tabCount);
      self.ctxTrending.showChartLoader();
      self.ctxTrending.buildChartContainer($section);
      <span class="hljs-keyword">this</span>.tabsArray.push({
        tab: $tab,
        section: $section,
        name: <span class="hljs-string">"tab"</span> + <span class="hljs-keyword">this</span>.tabCount
      });

      <span class="hljs-keyword">var</span> rawData = data.data;
      <span class="hljs-keyword">if</span>(!rawData || <span class="hljs-keyword">typeof</span> rawData === <span class="hljs-string">'undefined'</span>){
        self.ctxTrending.setOptionValuesFromResponse(data);
        rawData = <span class="hljs-string">''</span>;
      }

      $tab.data(<span class="hljs-string">'data_raw'</span>, <span class="hljs-built_in">JSON</span>.stringify(rawData)); <span class="hljs-comment">//so we can manipulate scenarios</span>

      <span class="hljs-keyword">var</span> options = self.ctxTrending.getOptionValues();
      $tab.data(<span class="hljs-string">'options'</span>, <span class="hljs-built_in">JSON</span>.stringify(options));</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>self.ctxTrending.renderForecastEqualizer($(‘.section-tab’ + this.tabCount + ‘ .forecast-equalizer’), data.data);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        self.ctxTrending.performChartCalculations();
        self.ctxTrending.hideChartLoader();
      }, <span class="hljs-number">250</span>);

      <span class="hljs-keyword">this</span>.tabCount++;
      self.checkRemainingTabs();
    },


  removeTab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(section)</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.tabsArray.length &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.tabsArray.length; i++) {
        <span class="hljs-keyword">var</span> tabData = <span class="hljs-keyword">this</span>.tabsArray[i];
        <span class="hljs-keyword">if</span> (tabData.name == section) {
          <span class="hljs-keyword">this</span>.tabsArray.splice(i, <span class="hljs-number">0</span>);
          <span class="hljs-keyword">break</span>;
        }
      }
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.tabsArray.length &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.goToSection(<span class="hljs-keyword">this</span>.tabsArray[<span class="hljs-keyword">this</span>.tabsArray.length - <span class="hljs-number">1</span>].name);
    }
    $(<span class="hljs-string">'.btn-tab[data-section="'</span> + section + <span class="hljs-string">'"]'</span>).remove();
    $(<span class="hljs-string">'.analyze-section.section-'</span> + section).remove();
    <span class="hljs-keyword">this</span>.checkRemainingTabs();
  },

  getCurrentTab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> $(<span class="hljs-string">'.btn-tab.active'</span>);
  },

  renameTab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tab, name)</span> </span>{
    tab.find(<span class="hljs-string">'span.name'</span>).html(name);
  },

  toggleSaveVisibility: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> numTabs = $(<span class="hljs-string">'#analyzeToolbar .tab-buttons .btn-tab'</span>).length;
    <span class="hljs-keyword">if</span> (numTabs &gt; <span class="hljs-number">0</span>) {
      $(<span class="hljs-string">'#analyzeToolbar .btn-save'</span>).show();
      $(<span class="hljs-string">'.analyze-section-toolbar, .tab-toolbar'</span>).addClass(<span class="hljs-string">'square-corner'</span>);
    } <span class="hljs-keyword">else</span> {
      $(<span class="hljs-string">'#analyzeToolbar .btn-save'</span>).hide();
      $(<span class="hljs-string">'.analyze-section-toolbar, .tab-toolbar'</span>).removeClass(<span class="hljs-string">'square-corner'</span>);
    }
  },

  showSaveModal: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> $tabList = <span class="hljs-string">''</span>;
    $(<span class="hljs-string">'.btn-tab'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(i, el)</span> </span>{
      <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'span.name'</span>, el).length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
      $tabList += <span class="hljs-string">'&lt;label for="checkbox1"&gt;&lt;input type="checkbox" id="checkbox1" checked style="display: none;"&gt;&lt;span class="custom checkbox checked"&gt;&lt;/span&gt; '</span> + $(<span class="hljs-string">'span.name'</span>, el).text() + <span class="hljs-string">'&lt;/label&gt;'</span>;

    });
    $(<span class="hljs-string">'#saveModal .tabs-to-save'</span>).html($tabList);
  },

  allowTabCreation: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $(<span class="hljs-string">'.btn-create-tab'</span>).show();
  },

  onSaveWorksheetSuccess: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
    $(<span class="hljs-string">'.tab-buttons .btn.active'</span>).find(<span class="hljs-string">'.unsaved-indicator'</span>).remove();
    $(<span class="hljs-string">'.tab-toolbar .btn-save-worksheet'</span>).hide().parent().removeClass(<span class="hljs-string">'btn-group'</span>);
    $(<span class="hljs-string">'.tab-toolbar .btn-rename-tab'</span>).show();
    <span class="hljs-keyword">if</span> (response &amp;&amp; response.id) {
      $(<span class="hljs-string">'&lt;input&gt;'</span>).attr({
          type: <span class="hljs-string">'hidden'</span>,
          id: <span class="hljs-string">'worksheetId'</span>,
          value: response.id.id
        }).appendTo(<span class="hljs-keyword">this</span>.getCurrentTab());
    }
  },

  loadModal: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $(<span class="hljs-string">'#openWorksheetModal'</span>).find(<span class="hljs-string">'.modal-body'</span>).html(<span class="hljs-string">'&lt;div class="well"&gt;&lt;img src="/img/ajax-loader-circle.gif"/&gt; &amp;nbsp; Loading Snapshots...&lt;/div&gt;'</span>);
    $(<span class="hljs-string">'#openWorksheetModal'</span>).modal(<span class="hljs-string">'show'</span>);

    $.ajax({
      url: <span class="hljs-string">'/api/snapshots/list'</span>,
      dataType: <span class="hljs-string">'json'</span>,
      success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
        <span class="hljs-keyword">var</span> data = {
          worksheets: response
        };
        <span class="hljs-keyword">var</span> html = listWorksheetsTableTpl(data);
        $(<span class="hljs-string">'#openWorksheetModal'</span>).find(<span class="hljs-string">'.modal-body'</span>).html(html);
      }
    });
  },

  openWorksheet: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> </span>{
    <span class="hljs-keyword">var</span> openSnapshots = <span class="hljs-keyword">this</span>.getOpenSnapshotIds();
    <span class="hljs-built_in">console</span>.log(openSnapshots, id);
    $(<span class="hljs-string">'#openWorksheetModal'</span>).modal(<span class="hljs-string">'hide'</span>);
    <span class="hljs-keyword">if</span>(openSnapshots.indexOf(id) &gt; -<span class="hljs-number">1</span>){
      toastr.error(<span class="hljs-string">"Snapshot Already Opened"</span>, <span class="hljs-string">'&lt;i class="icon-ban-circle"&gt;&lt;/i&gt; &lt;span&gt;'</span> + <span class="hljs-string">"Error"</span> + <span class="hljs-string">'&lt;/span&gt;'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    $(<span class="hljs-string">'#openWorksheetModal'</span>).modal(<span class="hljs-string">'hide'</span>);
    self.ctxTrending.showChartLoader();
    $.ajax({
      url: <span class="hljs-string">'/api/snapshots/get/'</span> + id,
      dataType: <span class="hljs-string">'json'</span>,
      success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
        self.ctxTrending.hideChartLoader();
        <span class="hljs-keyword">if</span> (response.data !== <span class="hljs-string">''</span>) {
          self.createTabForWorksheet(response);
        } <span class="hljs-keyword">else</span> {
          toastr.error(<span class="hljs-string">"Snapshot Not Found"</span>, <span class="hljs-string">'&lt;i class="icon-ban-circle"&gt;&lt;/i&gt; &lt;span&gt;'</span> + <span class="hljs-string">"Error"</span> + <span class="hljs-string">'&lt;/span&gt;'</span>);
        }
      }
    });
  },

  updateWorksheet: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    self.ctxTrending.showChartLoader();
    $.ajax({
      url: <span class="hljs-string">'/manage/worksheets/update'</span> + id,
      dataType: <span class="hljs-string">'json'</span>,
      success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
        self.ctxTrending.hideChartLoader();
      }
    });
  }
});

<span class="hljs-keyword">var</span> TrendingView = Backbone.View.extend({

  el: $(<span class="hljs-string">'#container'</span>),

  $el_trendingOptions: $(<span class="hljs-string">'#trendingOptions'</span>),

  events: {
    <span class="hljs-string">'click .btn-submit'</span>: <span class="hljs-string">'submitHandler'</span>,
    <span class="hljs-string">'click .btn-options'</span>: <span class="hljs-string">'toggleTrendingOptions'</span>,
    <span class="hljs-string">'change .field-offset-type'</span>: <span class="hljs-string">'onOffsetChange'</span>,
    <span class="hljs-string">'change .field-start-date, .field-end-date'</span>: <span class="hljs-string">'onDateChange'</span>,
    <span class="hljs-string">'change .field-test-data .field-reference-data'</span>: <span class="hljs-string">'fieldTestChangeHandler'</span>,
    <span class="hljs-string">'click #preset-dates a'</span>: <span class="hljs-string">'onPresetDateClick'</span>
  },

  initialize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span></span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    _.bindAll(<span class="hljs-keyword">this</span>, <span class="hljs-string">'render'</span>, <span class="hljs-string">'onOffsetChange'</span>);
    <span class="hljs-keyword">this</span>.parent = options.parent;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>socket events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.parent.ctxSocket.on(<span class="hljs-string">'CALCULATE_TRENDING_CHARTS_COMPLETE'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(results)</span></span>{
      <span class="hljs-keyword">if</span>(results.params.section === self.parent.currentSection){
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[App] calculateTrendingChartsComplete'</span>);
        <span class="hljs-built_in">console</span>.log(results);

        <span class="hljs-keyword">if</span>($(<span class="hljs-string">'.tab-buttons .btn.active'</span>).find(<span class="hljs-string">'.unsaved-indicator'</span>).length &gt; <span class="hljs-number">0</span>) {
          $(<span class="hljs-string">'.tab-buttons .btn.active'</span>).data(<span class="hljs-string">'default'</span>, <span class="hljs-literal">false</span>);
          $(<span class="hljs-string">'.tab-toolbar .btn-save-worksheet'</span>).show();
        }

        self.hideChartLoader();
        self.saveRawResults(results);

        <span class="hljs-keyword">var</span> sectionName = results.params.section;
        $(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .trending-charts'</span>).show();

        <span class="hljs-keyword">var</span> chartOptions = self.getBestPredictorChartOptions(results);
        self.saveBestPredictorChartOptions(chartOptions);
        self.renderChart($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .best-predictor-chart'</span>), self.getSavedBestPredictorChartOptions());
        self.saveBestPredictorModelTableData(results);

        <span class="hljs-keyword">var</span> chartOptions = self.getCorrelationChartOptions(results);
        self.saveCorrelationChartOptions(chartOptions);
        self.renderChart($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .correlation-chart'</span>), self.getSavedCorrelationChartOptions());
        self.saveTopCorrelationData(results);

        <span class="hljs-keyword">var</span> chartOptions = self.getSequenceChartOptions(results);
        self.saveSequenceChartOptions(chartOptions);
        self.renderChart($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .sequence-chart'</span>), self.getSavedSequenceChartOptions());

        <span class="hljs-keyword">var</span> chartOptions = self.getCorrelationChartOptions(results);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>context.renderChart($(‘.forecast-chart’ + lastTrendingChartContainerCount), context.getSavedCorrelationChartOptions());</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        self.renderTopCorrelationTable($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .correlation-table'</span>), self.getSavedTopCorrelationData());
        self.renderTopCorrelationTable($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .sequence-table'</span>), self.getSavedTopCorrelationData());

        <span class="hljs-keyword">if</span> (results.autofactorreduce.error) {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>display error messages…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">var</span> errorMessage = <span class="hljs-string">'Error: '</span> + results.autofactorreduce.error.code + <span class="hljs-string">' - '</span> + results.autofactorreduce.error.message;
          errorMessage += <span class="hljs-string">'&lt;br/&gt;Modify the snapshot parameters to increase the number of data set rows and/or decrease the number of data sets in the analysis.'</span>;
          <span class="hljs-built_in">console</span>.log(self.chartContainerCount);
          $(<span class="hljs-string">'#best-predictor-chart-tab'</span> + (self.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' #best-predictor-error'</span>).html(errorMessage);
          $(<span class="hljs-string">'#best-predictor-chart-tab'</span> + (self.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' .analyze-error'</span>).show();
          $(<span class="hljs-string">'.section-'</span> + self.parent.currentSection).find(<span class="hljs-string">'.trending-charts ul li a[href^="#best-predictor"]'</span>).addClass(<span class="hljs-string">'icon-warning-sign'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>hide any previous best predictor results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          $(<span class="hljs-string">'.best-predictor-chart'</span>).hide();
          $(<span class="hljs-string">'.best-predictor-table'</span>).hide();

          $(<span class="hljs-string">'#forecast-chart-tab'</span> + (self.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' #forecast-error'</span>).html(errorMessage);
          $(<span class="hljs-string">'#forecast-chart-tab'</span> + (self.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' .analyze-error'</span>).show();
          $(<span class="hljs-string">'.section-'</span> + self.parent.currentSection).find(<span class="hljs-string">'.trending-charts ul li a[href^="#forecast"]'</span>).addClass(<span class="hljs-string">'icon-warning-sign'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>hide any previous forecast results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          $(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .forecast-equalizer'</span>).hide();

        } <span class="hljs-keyword">else</span> {
          $(<span class="hljs-string">'#best-predictor-chart-tab'</span> + (self.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' .analyze-error'</span>).hide();</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>hide any previous best predictor results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          $(<span class="hljs-string">'.best-predictor-chart'</span>).show();
          $(<span class="hljs-string">'.best-predictor-table'</span>).show();
          $(<span class="hljs-string">'#forecast-chart-tab'</span> + (self.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' .analyze-error'</span>).hide();
          $(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .forecast-equalizer'</span>).show();
          $(<span class="hljs-string">'.section-'</span> + self.parent.currentSection).find(<span class="hljs-string">'.trending-charts ul li a[href^="#forecast"]'</span>).removeClass(<span class="hljs-string">'icon-warning-sign'</span>);
          $(<span class="hljs-string">'.section-'</span> + self.parent.currentSection).find(<span class="hljs-string">'.trending-charts ul li a[href^="#best-predictor"]'</span>).removeClass(<span class="hljs-string">'icon-warning-sign'</span>);
          self.renderBestPredictorModelTable($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .best-predictor-table'</span>), self.getSavedBestPredictorModelTableData());
          <span class="hljs-keyword">var</span> data = self.getSavedBestPredictorModelTableData();
          data.chartOptions = chartOptions;
          self.renderForecastEqualizer($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .forecast-equalizer'</span>), data);
        }
        self.saveDataToTab();
      }
    });

    <span class="hljs-keyword">this</span>.parent.ctxSocket.on(<span class="hljs-string">'CALCULATE_TRENDING_CHARTS_ERROR'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(results)</span> </span>{
      self.hideChartLoader();
      toast.notifyError(<span class="hljs-string">'Error'</span>, <span class="hljs-string">'Error performing chart calculation.'</span>);
    });

    <span class="hljs-keyword">this</span>.render();
  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $(<span class="hljs-string">'.field-offset-limit'</span>).off(<span class="hljs-string">'spinstop'</span>).on(<span class="hljs-string">'spinstop'</span>, <span class="hljs-keyword">this</span>.onOffsetChange).on(<span class="hljs-string">'spinchange'</span>, <span class="hljs-keyword">this</span>.onOffsetChange);
    <span class="hljs-keyword">this</span>.calculateAdjustedDates();
  },

  fieldTestChangeHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.validateForm();</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>cache what is selected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> referenceData = $(<span class="hljs-string">'.field-reference-data'</span>).find(<span class="hljs-string">'option:selected'</span>).val();
    <span class="hljs-keyword">var</span> testData = [];
    $(<span class="hljs-string">'.field-test-data'</span>).find(<span class="hljs-string">'option:selected'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(i, elem)</span> </span>{
      testData.push($(elem).val());
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>ok need to manage each snapshot as an object
this means converting back and forth from JSON</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> currentSnapshot = $(<span class="hljs-string">'.btn-tab.active'</span>).find(<span class="hljs-string">'span.name'</span>).text();
    <span class="hljs-keyword">var</span> snapshotData = store.get(currentSnapshot);
    <span class="hljs-keyword">if</span>(!snapshotData) snapshotData = {};
    snapshotData.referenceData = referenceData;
    snapshotData.testData = testData;
    store.set(currentSnapshot, snapshotData);

  },

  submitHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    e.preventDefault();
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.validateReferenceAndTestData()) {
      <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'.tab-buttons .btn.active'</span>).find(<span class="hljs-string">'.unsaved-indicator'</span>).length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.toggleTrendingOptions();
        <span class="hljs-keyword">this</span>.saveOptionsToTab();
        <span class="hljs-keyword">this</span>.performChartCalculations();
        <span class="hljs-keyword">this</span>.cacheOptions();
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.parent.createTabWithOptionsAndSubmit();
      }
    }
  },

  __correlationChartOptions: {},
  __correlationData: {},
  __sequenceChartOptions: {},
  __bestPredictorChartOptions: {},
  __bestPredictorModelTableData: {},
  __scenarioData: {},
  __rawResults: {},
  sectionSelector: <span class="hljs-string">'.section-trending'</span>,
  optionsSelector: <span class="hljs-string">'#trendingOptions'</span>,
  panelCount: <span class="hljs-number">0</span>,
  chartContainerCount: <span class="hljs-number">0</span>,
  lastTrendingChartContainerCount: <span class="hljs-number">0</span>,
  setOptionValues: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
    <span class="hljs-keyword">this</span>.clearOptionErrors();
    <span class="hljs-keyword">var</span> $el_trendingOptions = $(<span class="hljs-string">'#trendingOptions'</span>),
      $el_startDate = $(<span class="hljs-string">'.field-start-date'</span>, $el_trendingOptions),
      $el_endDate = $(<span class="hljs-string">'.field-end-date'</span>, $el_trendingOptions),
      $el_testData = $(<span class="hljs-string">'.field-test-data'</span>, $el_trendingOptions),
      $el_referenceData = $(<span class="hljs-string">'.field-reference-data'</span>, $el_trendingOptions),
      $el_offsetLimit = $(<span class="hljs-string">'.field-offset-limit'</span>, $el_trendingOptions),
      $el_offsetType = $(<span class="hljs-string">'.field-offset-type'</span>, $el_trendingOptions);

    $el_startDate.val(data.startDate);
    $el_endDate.val(data.endDate);
    $el_testData.select2(<span class="hljs-string">'val'</span>, data.testIDs);
    $el_referenceData.select2(<span class="hljs-string">'val'</span>, data.referenceData);
    $el_offsetLimit.val(data.shiftRange);
    $el_offsetType.select2(<span class="hljs-string">'val'</span>, data.shiftType);
    dataStreamStart = data.dataStreamStart;
    dataStreamEnd = data.dataStreamEnd;
  },

  setDefaultOptionValues: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.clearOptionErrors();
    <span class="hljs-keyword">var</span> $el_trendingOptions = $(<span class="hljs-string">'#trendingOptions'</span>),
      $el_startDate = $(<span class="hljs-string">'.field-start-date'</span>, $el_trendingOptions),
      $el_endDate = $(<span class="hljs-string">'.field-end-date'</span>, $el_trendingOptions),
      $el_testData = $(<span class="hljs-string">'.field-test-data'</span>, $el_trendingOptions),
      $el_referenceData = $(<span class="hljs-string">'.field-reference-data'</span>, $el_trendingOptions),
      $el_offsetLimit = $(<span class="hljs-string">'.field-offset-limit'</span>, $el_trendingOptions),
      $el_offsetType = $(<span class="hljs-string">'.field-offset-type'</span>, $el_trendingOptions);

    $el_startDate.val(<span class="hljs-string">"2011-01-01"</span>);
    $el_endDate.val(<span class="hljs-string">"2012-01-01"</span>);
    $el_testData.select2(<span class="hljs-string">'val'</span>, <span class="hljs-string">""</span>);
    $el_referenceData.select2(<span class="hljs-string">'val'</span>, <span class="hljs-string">"0"</span>);
    $el_offsetLimit.val(<span class="hljs-string">"6"</span>);
    $el_offsetType.select2(<span class="hljs-string">'val'</span>, <span class="hljs-string">"month"</span>);
  },
  getDefaultOptionValues: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> {
      startDate: <span class="hljs-string">"2011-01-01"</span>,
      endDate: <span class="hljs-string">"2012-01-01"</span>,
      testIDs: [],
      referenceData: <span class="hljs-string">"0"</span>,
      shiftRange: <span class="hljs-string">"6"</span>,
      shiftType: <span class="hljs-string">"month"</span>
    };
  },
  getOptionValues: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> $el_trendingOptions = $(<span class="hljs-string">'#trendingOptions'</span>),
      $el_startDate = $(<span class="hljs-string">'.field-start-date'</span>, $el_trendingOptions),
      $el_endDate = $(<span class="hljs-string">'.field-end-date'</span>, $el_trendingOptions),
      $el_testData = $(<span class="hljs-string">'.field-test-data'</span>, $el_trendingOptions),
      $el_referenceData = $(<span class="hljs-string">'.field-reference-data'</span>, $el_trendingOptions),
      $el_offsetLimit = $(<span class="hljs-string">'.field-offset-limit'</span>, $el_trendingOptions),
      $el_offsetType = $(<span class="hljs-string">'.field-offset-type'</span>, $el_trendingOptions);

    <span class="hljs-keyword">var</span> selectedOptions = $.makeArray($el_testData.find(<span class="hljs-string">'option:selected'</span>)).concat($.makeArray($el_referenceData.find(<span class="hljs-string">'option:selected'</span>))),
      dataStreamStart = _.min(
      selectedOptions.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
        <span class="hljs-keyword">return</span> $(o).attr(<span class="hljs-string">'data-start'</span>);
      })
      ),
      dataStreamEnd = _.max(
      selectedOptions.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
        <span class="hljs-keyword">return</span> $(o).attr(<span class="hljs-string">'data-end'</span>);
      })
      );

    <span class="hljs-keyword">return</span> {
      startDate: $el_startDate.val(),
      endDate: $el_endDate.val(),
      testIDs: $el_testData.select2(<span class="hljs-string">'val'</span>),
      referenceData: $el_referenceData.select2(<span class="hljs-string">'val'</span>),
      shiftRange: $el_offsetLimit.val(),
      shiftType: $el_offsetType.select2(<span class="hljs-string">'val'</span>),
      dataStreamStart: dataStreamStart,
      dataStreamEnd: dataStreamEnd,
      section: <span class="hljs-keyword">this</span>.parent.currentSection
    };
  },

  setOptionValuesFromResponse: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
      <span class="hljs-keyword">var</span> $el_trendingOptions = $(<span class="hljs-string">'#trendingOptions'</span>),
        $el_startDate = $(<span class="hljs-string">'.field-start-date'</span>, $el_trendingOptions),
        $el_endDate = $(<span class="hljs-string">'.field-end-date'</span>, $el_trendingOptions),
        $el_testData = $(<span class="hljs-string">'.field-test-data'</span>, $el_trendingOptions),
        $el_referenceData = $(<span class="hljs-string">'.field-reference-data'</span>, $el_trendingOptions),
        $el_offsetLimit = $(<span class="hljs-string">'.field-offset-limit'</span>, $el_trendingOptions),
        $el_offsetType = $(<span class="hljs-string">'.field-offset-type'</span>, $el_trendingOptions);
      <span class="hljs-keyword">var</span> startDate = moment(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(response.start)).format(<span class="hljs-string">'YYYY-MM-DD'</span>);
      <span class="hljs-keyword">var</span> endDate = moment(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(response.end)).format(<span class="hljs-string">'YYYY-MM-DD'</span>);
      <span class="hljs-keyword">var</span> testData = response.relativeDatasetIds.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(i)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(i, <span class="hljs-number">10</span>);
      });
      $el_startDate.val(startDate);
      $el_endDate.val(endDate);
      $el_testData.select2(<span class="hljs-string">"val"</span>,  testData);
      $el_referenceData.select2(<span class="hljs-string">"val"</span>, response.baseDatasetId);
      $el_offsetLimit.val(response.shiftRange);
      $el_offsetType.val(response.unit);

    },

  saveOptionsToTab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> $tab = $(<span class="hljs-string">'.btn[data-section="'</span> + <span class="hljs-keyword">this</span>.parent.currentSection + <span class="hljs-string">'"]'</span>);
    <span class="hljs-keyword">var</span> options = <span class="hljs-keyword">this</span>.getOptionValues();
    <span class="hljs-built_in">console</span>.log(options);
    $tab.data(<span class="hljs-string">'options'</span>, <span class="hljs-built_in">JSON</span>.stringify(options));
  },

  cacheOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> $tab = $(<span class="hljs-string">'.btn[data-section="'</span> + <span class="hljs-keyword">this</span>.parent.currentSection + <span class="hljs-string">'"]'</span>);
    <span class="hljs-keyword">var</span> data = $tab.data(<span class="hljs-string">'options'</span>);
    <span class="hljs-keyword">var</span> snapshotName = $(<span class="hljs-string">'.btn-tab.active'</span>).find(<span class="hljs-string">'span.name'</span>).text();
    <span class="hljs-keyword">var</span> isUnsaved = $(<span class="hljs-string">'.btn-tab.active'</span>).find(<span class="hljs-string">'.icon-asterisk'</span>).length;
    <span class="hljs-keyword">var</span> worksheetId = <span class="hljs-built_in">parseInt</span>($(<span class="hljs-string">'.btn-tab.active'</span>).find(<span class="hljs-string">'#worksheetId'</span>).val());
    <span class="hljs-keyword">var</span> snapshotData = {
      name: snapshotName,
      isUnsaved: isUnsaved,
      worksheetId: worksheetId,
      data: data
    };
    <span class="hljs-keyword">this</span>.cacheSnapshot(snapshotName);
    store.set(snapshotName, snapshotData);
  },

  cacheSnapshot: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(snapshotName)</span> </span>{
    <span class="hljs-keyword">var</span> snapshots = store.get(<span class="hljs-string">'snapshots'</span>);
    <span class="hljs-keyword">if</span> (!snapshots) {
      snapshots = {};
    }
    snapshots[snapshotName] = <span class="hljs-number">1</span>;
    store.set(<span class="hljs-string">'snapshots'</span>, snapshots);
  },

  saveDataToTab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> $tab = $(<span class="hljs-string">'.btn[data-section="'</span> + <span class="hljs-keyword">this</span>.parent.currentSection + <span class="hljs-string">'"]'</span>);
    $tab.data(<span class="hljs-string">'data_correlation'</span>, <span class="hljs-built_in">JSON</span>.stringify(self.getSavedCorrelationChartOptions()));
    $tab.data(<span class="hljs-string">'data_correlationtable'</span>, <span class="hljs-built_in">JSON</span>.stringify(self.getSavedTopCorrelationData()));
    $tab.data(<span class="hljs-string">'data_sequence'</span>, <span class="hljs-built_in">JSON</span>.stringify(self.getSavedSequenceChartOptions()));
    $tab.data(<span class="hljs-string">'data_sequencetable'</span>, <span class="hljs-built_in">JSON</span>.stringify(self.getSavedTopCorrelationData()));
    $tab.data(<span class="hljs-string">'data_bestpredictor'</span>, <span class="hljs-built_in">JSON</span>.stringify(self.getSavedBestPredictorChartOptions()));
    $tab.data(<span class="hljs-string">'data_bestpredictortable'</span>, <span class="hljs-built_in">JSON</span>.stringify(self.getSavedBestPredictorModelTableData()));
    $tab.data(<span class="hljs-string">'data_raw'</span>, <span class="hljs-built_in">JSON</span>.stringify(self.getSavedRawResults()));
  },

  hideEmptyCalculationMessage: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $(<span class="hljs-string">'.section-'</span> + <span class="hljs-keyword">this</span>.parent.currentSection + <span class="hljs-string">' #emptyCalculationMessage'</span>).hide();
  },

  showChartLoader: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $(<span class="hljs-string">'.section-'</span> + <span class="hljs-keyword">this</span>.parent.currentSection + <span class="hljs-string">' #trendingChartLoader'</span>).show();
  },

  hideChartLoader: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $(<span class="hljs-string">'.section-'</span> + <span class="hljs-keyword">this</span>.parent.currentSection + <span class="hljs-string">' #trendingChartLoader'</span>).hide();
  },

  hideCharts: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $(<span class="hljs-string">'.trending-charts'</span>, <span class="hljs-keyword">this</span>.sectionSelector).hide();
  },

  hideOptionsWindow: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> $dropdown = $(<span class="hljs-keyword">this</span>.optionsSelector);
    <span class="hljs-keyword">if</span> ($dropdown.hasClass(<span class="hljs-string">'open'</span>)) {
      $(<span class="hljs-string">'[data-dropdown="'</span> + $dropdown.attr(<span class="hljs-string">'id'</span>) + <span class="hljs-string">'"]'</span>).trigger(<span class="hljs-string">'click'</span>);
    }
  },

  showCharts: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $(<span class="hljs-string">'.trending-charts'</span>, <span class="hljs-keyword">this</span>.sectionSelector).show();
  },

  resetCharts: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector)</span> </span>{
    $(selector).find(<span class="hljs-string">'.trending-charts'</span>).remove();
    <span class="hljs-keyword">this</span>.buildChartContainer($(selector));
  },

  performChartCalculations: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">this</span>.hideOptionsWindow();
    <span class="hljs-keyword">this</span>.hideEmptyCalculationMessage();
    <span class="hljs-keyword">this</span>.showChartLoader();
    <span class="hljs-keyword">this</span>.parent.ctxSocket.emit(<span class="hljs-string">'CALCULATE_TRENDING_CHARTS'</span>, self.getOptionValues());
  },

  onCalculateTrendingChartsError: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.hideChartLoader();
    toast.notifyError(<span class="hljs-string">'Error'</span>, <span class="hljs-string">'Error performing chart calculation.'</span>);
  },

  onCalculateTrendingChartsComplete: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(results)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[App] calculateTrendingChartsComplete'</span>);

    <span class="hljs-keyword">this</span>.hideChartLoader();
    <span class="hljs-keyword">this</span>.saveRawResults(results);

    <span class="hljs-keyword">var</span> sectionName = results.params.section;
    $(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .trending-charts'</span>).show();

    <span class="hljs-keyword">var</span> chartOptions = <span class="hljs-keyword">this</span>.getBestPredictorChartOptions(results);
    <span class="hljs-keyword">this</span>.saveBestPredictorChartOptions(chartOptions);
    <span class="hljs-keyword">this</span>.renderChart($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .best-predictor-chart'</span>), <span class="hljs-keyword">this</span>.getSavedBestPredictorChartOptions());
    <span class="hljs-keyword">this</span>.saveBestPredictorModelTableData(results);

    <span class="hljs-keyword">var</span> chartOptions = <span class="hljs-keyword">this</span>.getCorrelationChartOptions(results);
    <span class="hljs-keyword">this</span>.saveCorrelationChartOptions(chartOptions);
    <span class="hljs-keyword">this</span>.renderChart($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .correlation-chart'</span>), <span class="hljs-keyword">this</span>.getSavedCorrelationChartOptions());
    <span class="hljs-keyword">this</span>.saveTopCorrelationData(results);

    <span class="hljs-keyword">var</span> chartOptions = self.ctxTrending.getSequenceChartOptions(results);
    <span class="hljs-keyword">this</span>.saveSequenceChartOptions(chartOptions);
    <span class="hljs-keyword">this</span>.renderChart($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .sequence-chart'</span>), <span class="hljs-keyword">this</span>.getSavedSequenceChartOptions());

    <span class="hljs-keyword">var</span> chartOptions = <span class="hljs-keyword">this</span>.getCorrelationChartOptions(results);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>context.renderChart($(‘.forecast-chart’ + lastTrendingChartContainerCount), context.getSavedCorrelationChartOptions());</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">this</span>.renderTopCorrelationTable($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .correlation-table'</span>), <span class="hljs-keyword">this</span>.getSavedTopCorrelationData());
    <span class="hljs-keyword">this</span>.renderTopCorrelationTable($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .sequence-table'</span>), <span class="hljs-keyword">this</span>.getSavedTopCorrelationData());

    <span class="hljs-keyword">if</span> (results.autofactorreduce.error) {</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>display error messages…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> errorMessage = <span class="hljs-string">'Error: '</span> + results.autofactorreduce.error.code + <span class="hljs-string">' - '</span> + results.autofactorreduce.error.message;
      errorMessage += <span class="hljs-string">'&lt;br/&gt;Modify the snapshot parameters to increase the number of data set rows and/or decrease the number of data sets in the analysis.'</span>;
      $(<span class="hljs-string">'#best-predictor-chart-tab'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' #best-predictor-error'</span>).html(errorMessage);
      $(<span class="hljs-string">'#best-predictor-chart-tab'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' .analyze-error'</span>).show();
      $(<span class="hljs-string">'.section-'</span> + <span class="hljs-keyword">this</span>.parent.currentSection).find(<span class="hljs-string">'.trending-charts ul li a[href^="#best-predictor"]'</span>).addClass(<span class="hljs-string">'icon-warning-sign'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>hide any previous best predictor results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="hljs-string">'.best-predictor-chart'</span>).hide();
      $(<span class="hljs-string">'.best-predictor-table'</span>).hide();

      $(<span class="hljs-string">'#forecast-chart-tab'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' #forecast-error'</span>).html(errorMessage);
      $(<span class="hljs-string">'#forecast-chart-tab'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' .analyze-error'</span>).show();
      $(<span class="hljs-string">'.section-'</span> + <span class="hljs-keyword">this</span>.parent.currentSection).find(<span class="hljs-string">'.trending-charts ul li a[href^="#forecast"]'</span>).addClass(<span class="hljs-string">'icon-warning-sign'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>hide any previous forecast results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .forecast-equalizer'</span>).hide();

    } <span class="hljs-keyword">else</span> {
      $(<span class="hljs-string">'#best-predictor-chart-tab'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' .analyze-error'</span>).hide();</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>hide any previous best predictor results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="hljs-string">'.best-predictor-chart'</span>).show();
      $(<span class="hljs-string">'.best-predictor-table'</span>).show();
      $(<span class="hljs-string">'#forecast-chart-tab'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' .analyze-error'</span>).hide();
      $(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .forecast-equalizer'</span>).show();
      $(<span class="hljs-string">'.section-'</span> + <span class="hljs-keyword">this</span>.parent.currentSection).find(<span class="hljs-string">'.trending-charts ul li a[href^="#forecast"]'</span>).removeClass(<span class="hljs-string">'icon-warning-sign'</span>);
      $(<span class="hljs-string">'.section-'</span> + <span class="hljs-keyword">this</span>.parent.currentSection).find(<span class="hljs-string">'.trending-charts ul li a[href^="#best-predictor"]'</span>).removeClass(<span class="hljs-string">'icon-warning-sign'</span>);
      <span class="hljs-keyword">this</span>.renderBestPredictorModelTable($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .best-predictor-table'</span>), <span class="hljs-keyword">this</span>.getSavedBestPredictorModelTableData());
      <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.getSavedBestPredictorModelTableData();
      data.chartOptions = chartOptions;
      <span class="hljs-keyword">this</span>.renderForecastEqualizer($(<span class="hljs-string">'.section-'</span> + sectionName + <span class="hljs-string">' .forecast-equalizer'</span>), data);
    }
    <span class="hljs-keyword">this</span>.saveDataToTab();
    <span class="hljs-comment">/*context.renderChart($('.correlation-chart' + (chartContainerCount - 1)), context.getCorrelationChartOptions(data.data));
     context.renderChart($('.best-predictor-chart' + (chartContainerCount - 1)), context.getBestPredictorChartOptions(data.data));
     context.renderChart($('.sequence-chart' + (chartContainerCount - 1)), context.getSequenceChartOptions(data.data));
     var chartOptions = context.getCorrelationChartOptions(data.data);
     context.renderChart($('.forecast-chart' + (chartContainerCount - 1)), chartOptions);

     context.renderTopCorrelationTable($('.correlation-table' + (chartContainerCount - 1)), data.data);
     context.renderTopCorrelationTable($('.sequence-table' + (chartContainerCount - 1)), data.data);
     context.renderBestPredictorModelTable($('.best-predictor-table' + (chartContainerCount - 1)), data.data);
     data.data.chartOptions = chartOptions;
     context.renderForecastEqualizer($('.forecast-equalizer' + (chartContainerCount - 1)), data.data);*/</span>
  },

  saveTopCorrelationData: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
    <span class="hljs-keyword">this</span>.__correlationData = data;
  },

  getSavedTopCorrelationData: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__correlationData;
  },

  saveBestPredictorModelTableData: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
    <span class="hljs-keyword">this</span>.__bestPredictorModelTableData = data;
  },

  getSavedBestPredictorModelTableData: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__bestPredictorModelTableData;
  },

  saveCorrelationChartOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(chartOptions)</span> </span>{
    <span class="hljs-keyword">this</span>.__correlationChartOptions = jQuery.extend(<span class="hljs-literal">true</span>, {}, chartOptions);
  },

  getSavedCorrelationChartOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> newObj = jQuery.extend(<span class="hljs-literal">true</span>, {}, <span class="hljs-keyword">this</span>.__correlationChartOptions);
    <span class="hljs-keyword">return</span> newObj;
  },

  saveSequenceChartOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(chartOptions)</span> </span>{
    <span class="hljs-keyword">this</span>.__sequenceChartOptions = jQuery.extend(<span class="hljs-literal">true</span>, {}, chartOptions);
  },

  getSavedSequenceChartOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> newObj = jQuery.extend(<span class="hljs-literal">true</span>, {}, <span class="hljs-keyword">this</span>.__sequenceChartOptions);
    <span class="hljs-keyword">return</span> newObj;
  },

  saveBestPredictorChartOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(chartOptions)</span> </span>{
    <span class="hljs-keyword">this</span>.__bestPredictorChartOptions = jQuery.extend(<span class="hljs-literal">true</span>, {}, chartOptions);
  },

  getSavedBestPredictorChartOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> newObj = jQuery.extend(<span class="hljs-literal">true</span>, {}, <span class="hljs-keyword">this</span>.__bestPredictorChartOptions);
    <span class="hljs-keyword">return</span> newObj;
  },

  saveRawResults: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(results)</span> </span>{
    <span class="hljs-keyword">this</span>.__rawResults = results;
  },

  getSavedRawResults: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__rawResults;
  },

  buildChartContainer: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($container)</span> </span>{
    <span class="hljs-keyword">var</span> data = {
      count: <span class="hljs-keyword">this</span>.chartContainerCount
    };
    <span class="hljs-keyword">var</span> html = trendingChartsTpl(data);
    $container.append(html);
    <span class="hljs-keyword">this</span>.chartContainerCount++;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>when a tab is deleted, the chartContainerCount gets out of sync with tabCount</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.panelCount = <span class="hljs-keyword">this</span>.panelCount + <span class="hljs-number">3</span>;
  },

  renderChart: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($container, chartOptions)</span> </span>{
    $container.highcharts(<span class="hljs-string">'StockChart'</span>, chartOptions);
  },

  renderTopCorrelationTable: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($container, data)</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[App] renderTopCorrelationTable'</span>);

    <span class="hljs-keyword">var</span> shifts = _.chain(data.autocorrelate.shifts || []).sortBy(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
      <span class="hljs-keyword">return</span> -o.pecentagecorrelated;
    }).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
      <span class="hljs-keyword">var</span> cloned = _.clone(o);
      cloned.pecentagecorrelated = (cloned.pecentagecorrelated || <span class="hljs-number">0</span>).toFixed(<span class="hljs-number">2</span>) + <span class="hljs-string">'%'</span>;
      <span class="hljs-keyword">return</span> cloned;
    }).value();

    <span class="hljs-keyword">var</span> data = {
      shifts: shifts,
      shiftType: data.params.shiftType
    };
    <span class="hljs-keyword">var</span> html = topCorrelationTableTpl(data);
    $container.html(html);
  },

  renderBestPredictorModelTable: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($container, data)</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[App] renderBestPredictorModelTable'</span>);

    <span class="hljs-keyword">var</span> presentedFactors = {
      factors: _.chain(data.autofactorreduce.factors || []).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
        <span class="hljs-keyword">var</span> cloned = _.clone(o);
        <span class="hljs-keyword">var</span> coefficientFormatted = <span class="hljs-built_in">parseFloat</span>(cloned.coefficient || <span class="hljs-number">0</span>);
        coefficientFormatted = (<span class="hljs-number">1</span> &gt; coefficientFormatted &amp;&amp; coefficientFormatted &gt; -<span class="hljs-number">1</span>) ? coefficientFormatted.toExponential(<span class="hljs-number">3</span>) : coefficientFormatted.toFixed(<span class="hljs-number">3</span>);
        cloned.coefficientFormatted = coefficientFormatted;
        <span class="hljs-keyword">return</span> cloned;
      }).value()
    };
    data.autofactorreduce.factors = presentedFactors.factors;
    data.autofactorreduce.percentagecorrelatedrounded = <span class="hljs-built_in">Math</span>.round(data.autofactorreduce.percentagecorrelated);

    <span class="hljs-keyword">var</span> data = {
      autofactorreduce: data.autofactorreduce,
      shiftType: data.params.shiftType
    };
    <span class="hljs-keyword">var</span> html = bestPredictorModelTableTpl(data);
    $container.html(html);
    $container.find(<span class="hljs-string">'[data-toggle=tooltip]'</span>).tooltip({
      container: <span class="hljs-string">'body'</span>
    }); <span class="hljs-comment">//initialize tooltips</span>
  },

  renderForecastEqualizer: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($forecastContainer, data)</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[App] renderForecastEqualizer '</span>);

    <span class="hljs-keyword">var</span> equationData = {
      factors: _.chain(data.autofactorreduce.factors || []).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o, index)</span> </span>{
        <span class="hljs-keyword">var</span> cloned = _.clone(o);
        <span class="hljs-keyword">return</span> cloned;
      }).value()
    };

    equationData.factors.unshift({
      <span class="hljs-string">'datastreamid'</span>: data.datapoints[<span class="hljs-number">0</span>].datastreamid,
      <span class="hljs-string">'datastreamname'</span>: data.datapoints[<span class="hljs-number">0</span>].datastreamname,
      <span class="hljs-string">'shiftfactor'</span>: <span class="hljs-number">0</span>,
      <span class="hljs-string">'adjustedpercentagecorrelated'</span>: <span class="hljs-string">'100%'</span>
    });

    <span class="hljs-keyword">var</span> scenarioData = {};
    scenarioData.baseline = {
      factors: equationData.factors,
      shiftType: data.params.shiftType,
      intercept: data.autofactorreduce.intercept,
      degreesOfFreedom: data.autofactorreduce.degreesoffreedom,
      residualStandardError: data.autofactorreduce.residualstandarderror
    };
    scenarioData.scenario = [];
    <span class="hljs-keyword">if</span>(data.forecasts){
      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; data.forecasts.length; x++){
        <span class="hljs-keyword">var</span> forecast = data.forecasts[x];
        <span class="hljs-keyword">if</span>(forecast.data){
          <span class="hljs-keyword">var</span> scenario_data = <span class="hljs-built_in">JSON</span>.parse(forecast.data);
          <span class="hljs-keyword">if</span> (scenario_data) {
            <span class="hljs-keyword">var</span> scenario = {};
            scenario.shiftType = data.params.shiftType;
            scenario.id = forecast.id;
            scenario.intercept = data.autofactorreduce.intercept;
            scenario.degreesOfFreedom = data.autofactorreduce.degreesoffreedom;
            scenario.residualStandardError = data.autofactorreduce.residualstandarderror;
            scenario.title = forecast.name;
            scenario.factors = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>scenario.factors = _.clone(equationData.factors);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; scenario_data.factors.length; j++) {
              scenario.factors[j] = _.clone(equationData.factors[j]);
              scenario.factors[j].state = _.clone(scenario_data.factors[j].state[x]);
            }
        scenarioData.scenario[x] = scenario;
          }

        }
      }

    }
    <span class="hljs-keyword">var</span> html = forecastEqualizerTpl(scenarioData);</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>forecastContainer handles interface elements for all scenarios (including baseline)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $forecastContainer.html(html);</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Hide the chart for now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">'.forecast-chart'</span>).hide();
    $forecastContainer.find(<span class="hljs-string">'.btn-save-scenario'</span>).hide();
    $forecastContainer.find(<span class="hljs-string">'.btn-rename-scenario'</span>).hide();</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>baselineContainer handles interface elements for only the baseline scenario which is generated dynamically - not saved</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> $baselineContainer = $($forecastContainer).find(<span class="hljs-string">'#forecast-scenario-baseline'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>First, create the Baseline forecast values that represents the initial default best predictor solution</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> colorIndex = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> avgPoints = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>work through each independent value, then do the dependent value last so we can solve the equation as the default</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; scenarioData.baseline.factors.length; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>get average value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> total = <span class="hljs-number">0.0</span>;
      <span class="hljs-keyword">var</span> streamId = scenarioData.baseline.factors[i].datastreamid;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>NOTE: The datapoints array may not be in the same order as the factors array - so match by datastreamid
todo: the average values of each dataset could be computed in the initial server call rather than doing it here each time</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; data.datapoints_shifted.length; j++) {
        <span class="hljs-keyword">if</span> (data.datapoints_shifted[j].datastreamid == streamId) {
          <span class="hljs-keyword">var</span> points = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; data.datapoints_shifted[j].data.length; k++) {
            total += data.datapoints_shifted[j].data[k].value;
            <span class="hljs-keyword">if</span> (j &gt; <span class="hljs-number">0</span>) {
              points[k] = data.datapoints_shifted[j].data[k].value;
            }
          }
          paramValue = (k == <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : total / k);
          <span class="hljs-keyword">if</span> (j &gt; <span class="hljs-number">0</span>) {
            avgPoints.push(points);
          }
          j = data.datapoints_shifted.length;
        }
      }

      <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>dependent values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (paramValue &gt; <span class="hljs-number">0</span>) {
          minValue = -paramValue;
          maxValue = paramValue * <span class="hljs-number">3</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> (paramValue &lt; <span class="hljs-number">0</span>) {
            minValue = paramValue * <span class="hljs-number">3</span>;
            maxValue = -paramValue;
          } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>          }
        }
      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>independent values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (paramValue &gt; <span class="hljs-number">0</span>) {
          minValue = <span class="hljs-number">0</span>;
          maxValue = paramValue * <span class="hljs-number">2</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> (paramValue &lt; <span class="hljs-number">0</span>) {
            minValue = paramValue * <span class="hljs-number">2</span>;
            maxValue = <span class="hljs-number">0</span>;
          } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>          }
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>determine proper range and decimal places to display</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> places = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">var</span> step = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.abs(paramValue) &lt; <span class="hljs-number">1</span>) {
        places = <span class="hljs-number">2</span>;
        step = <span class="hljs-number">0.01</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.abs(paramValue) &lt; <span class="hljs-number">10</span>) {
          places = <span class="hljs-number">1</span>;
          step = <span class="hljs-number">0.1</span>;
        }
      }

      minValue = <span class="hljs-built_in">Math</span>.round(minValue * <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, places)) / <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, places);
      paramValue = <span class="hljs-built_in">Math</span>.round(paramValue * <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, places)) / <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, places);
      maxValue = <span class="hljs-built_in">Math</span>.round(maxValue * <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, places)) / <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, places);

      <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>these values are set for all scenarios…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $forecastContainer.find(<span class="hljs-string">".forecast-"</span> + i).data(<span class="hljs-string">'baselinematrix'</span>, avgPoints);</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>these values only apply to the baseline…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $baselineContainer.find(<span class="hljs-string">".forecast-"</span> + i)
          .data(<span class="hljs-string">'resetvalue'</span>, paramValue)
          .prop(<span class="hljs-string">"disabled"</span>, <span class="hljs-literal">true</span>);
        colorIndex = <span class="hljs-number">0</span>;
      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>all values…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $forecastContainer.find(<span class="hljs-string">"#forecast-"</span> + i).data(<span class="hljs-string">'coefficient'</span>, data.autofactorreduce.factors[i - <span class="hljs-number">1</span>].coefficient);</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>baseline only…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $baselineContainer.find(<span class="hljs-string">"#forecast-"</span> + i)
          .data(<span class="hljs-string">'resetvalue'</span>, paramValue)
          .val(paramValue);
        colorIndex = <span class="hljs-number">2</span> * i - <span class="hljs-number">1</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>all values…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $forecastContainer.find(<span class="hljs-string">".range-"</span> + i + <span class="hljs-string">" .minValue"</span>).text(minValue);
      $forecastContainer.find(<span class="hljs-string">".range-"</span> + i + <span class="hljs-string">" .avgValue"</span>).text(paramValue); <span class="hljs-comment">//.data('resetvalue',paramValue);</span>
      $forecastContainer.find(<span class="hljs-string">".range-"</span> + i + <span class="hljs-string">" .maxValue"</span>).text(maxValue);
      $baselineContainer.find(<span class="hljs-string">".forecast-slider-"</span> + i).slider({
        <span class="hljs-string">"orientation"</span>: <span class="hljs-string">"horizontal"</span>,
        <span class="hljs-string">"range"</span>: <span class="hljs-string">"min"</span>,
        <span class="hljs-string">"min"</span>: minValue,
        <span class="hljs-string">"max"</span>: maxValue,
        <span class="hljs-string">"value"</span>: paramValue,
        <span class="hljs-string">"disabled"</span>: i == <span class="hljs-number">0</span>,
        <span class="hljs-string">"step"</span>: step
      });
      $forecastContainer.find(<span class="hljs-string">".forecast-slider-"</span> + i).slider({
        <span class="hljs-string">"orientation"</span>: <span class="hljs-string">"horizontal"</span>,
        <span class="hljs-string">"range"</span>: <span class="hljs-string">"min"</span>,
        <span class="hljs-string">"min"</span>: minValue,
        <span class="hljs-string">"max"</span>: maxValue,</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>“value”: value is set in the template for saved user scenarios
“disabled”: i == 0,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"step"</span>: step
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>TODO: The order of the datasets in the graph may be different than the sorted list, correct this when finalizing the graph type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $forecastContainer.find(<span class="hljs-string">".forecast-slider-"</span> + i + <span class="hljs-string">" &gt; div.ui-slider-range"</span>).css(<span class="hljs-string">"background-color"</span>, data.chartOptions.colors[colorIndex]);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>var datasetPeriod = Math.round((data.params.dataStreamEnd-data.params.dataStreamStart)/(1000<em>60</em>60<em>24</em>30));</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> forecastPeriod = <span class="hljs-built_in">Math</span>.round((<span class="hljs-built_in">Date</span>.parse(data.params.endDate) - <span class="hljs-built_in">Date</span>.parse(data.params.startDate)) / (<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">30</span>));
    $forecastContainer.find(<span class="hljs-string">".forecast-period"</span>).text(forecastPeriod);

    <span class="hljs-keyword">var</span> endDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>.parse(data.params.endDate);
    endDate.setMonth(endDate.getMonth() + forecastPeriod);
    <span class="hljs-keyword">var</span> curr_day = endDate.getDate();
    <span class="hljs-keyword">var</span> curr_month = endDate.getMonth() + <span class="hljs-number">1</span>; <span class="hljs-comment">//Months are zero based</span>
    <span class="hljs-keyword">var</span> curr_year = endDate.getFullYear();
    $forecastContainer.find(<span class="hljs-string">".forecast-date"</span>).text(curr_month + <span class="hljs-string">'/'</span> + curr_day + <span class="hljs-string">'/'</span> + curr_year);</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>remember the average values from which to establish baseline calculations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $forecastContainer.find(<span class="hljs-string">".forecast-0"</span>).data(<span class="hljs-string">'baselinematrix'</span>, avgPoints);</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>trigger initial solve for baseline scenario</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $baselineContainer.find(<span class="hljs-string">".forecast-slider-0"</span>).slider(<span class="hljs-string">'value'</span>, <span class="hljs-number">0</span>);
    $forecastContainer.find(<span class="hljs-string">".scenario.user .solving"</span>).click();</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>trigger initial solve for all user scenarios</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $forecastContainer.find(<span class="hljs-string">".scenario.user .forecast"</span>).change();</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>establish tooltips on new elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $forecastContainer.find(<span class="hljs-string">'[data-toggle=tooltip]'</span>).tooltip({
      container: <span class="hljs-string">'body'</span>
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Initialize baseline table configuration
$forecastContainer.find(‘div.scenario.baseline table.test-data’).dataTable( {
Initialize common settings for all table configurations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $forecastContainer.find(<span class="hljs-string">'table.test-data'</span>).dataTable({
      <span class="hljs-string">"bPaginate"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-string">"bLengthChange"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-string">"bFilter"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-string">"bSort"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">"bInfo"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-string">"bAutoWidth"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-string">"aaSorting"</span>: [[<span class="hljs-number">2</span>, <span class="hljs-string">"asc"</span>]], <span class="hljs-comment">//DataTables initialization overwrites attributes established in html template</span>
      <span class="hljs-string">"aoColumns"</span>: [
        <span class="hljs-comment">/* Test Data */</span> <span class="hljs-literal">null</span>,
        <span class="hljs-comment">/* Time Shift */</span> <span class="hljs-literal">null</span>,
        <span class="hljs-comment">/* Forecast Date */</span> <span class="hljs-literal">null</span>,
        <span class="hljs-comment">/* Confidence Interval */</span> <span class="hljs-literal">null</span>,
        <span class="hljs-comment">/* Slider */</span> {
          <span class="hljs-string">"bSearchable"</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-string">"bSortable"</span>: <span class="hljs-literal">false</span>
        },
        <span class="hljs-comment">/* Forecast */</span> {
          <span class="hljs-string">"bSearchable"</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-string">"bSortable"</span>: <span class="hljs-literal">false</span>
        }
      ]
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Initialize user table configurations
todo: establish aaSorting when initializing data structure if this feature is wanted</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/*$forecastContainer.find('div.scenario.user table.test-data').each(function(index){
     this.dataTable().fnSort(
     aaSorting[index] //[[ 2, "asc" ]]
     );
     });*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>todo: we may need to align table column widths manually…
var header = $forecastContainer.find(‘.test-data thead tr th’);
for(i=0;i&lt;header.length;i++){
$(‘.reference-data thead tr th[i]’).
var width = $(header[i]).width();
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  },


<span class="hljs-comment">/*LH*/</span>
  getCorrelationChartOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[App] renderCorrelationChart'</span>);
    <span class="hljs-keyword">var</span> originalData = {};

    <span class="hljs-keyword">var</span> series, combined, shift, values, ref_min, ref_max, val, mean_min=<span class="hljs-number">0</span>, mean_max=<span class="hljs-number">0</span>,
      selections = <span class="hljs-keyword">this</span>.getOptionValues(),
      shifts = _.map(selections.testIDs, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
        <span class="hljs-keyword">return</span> o + <span class="hljs-string">':'</span> + selections.shiftRange;
      }).join(<span class="hljs-string">'|'</span>),
      valuePeaks = {},
      adjustData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, suffix)</span> </span>{
        suffix = suffix || <span class="hljs-string">''</span>;

        <span class="hljs-keyword">return</span> _.map(data, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o, key)</span> </span>{
          valuePeaks[o.datastreamid] = valuePeaks[o.datastreamid] || {};
          <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'datastreamname'</span>: o.datastreamname + suffix,
            <span class="hljs-string">'datastreamid'</span>: o.datastreamid,<span class="hljs-comment">//both non-shifted and shifted share same id</span>
            <span class="hljs-string">'data'</span>: _.map(o.data, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o2)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>find the lowest min and highest max of each series</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              valuePeaks[o.datastreamid].min = valuePeaks[o.datastreamid].min || o2.value;
              valuePeaks[o.datastreamid].max = valuePeaks[o.datastreamid].max || o2.value;
              valuePeaks[o.datastreamid].min = <span class="hljs-built_in">Math</span>.min(o2.value, valuePeaks[o.datastreamid].min);
              valuePeaks[o.datastreamid].max = <span class="hljs-built_in">Math</span>.max(o2.value, valuePeaks[o.datastreamid].max);
              valuePeaks.all_min = valuePeaks[o.datastreamid].min;
              valuePeaks.all_max = valuePeaks[o.datastreamid].max;
              <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'date'</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(o2.date), <span class="hljs-comment">//Date.parseExact(o2.date, 'yyyyMMdd'),</span>
                <span class="hljs-string">'value'</span>: o2.value
              };
            })
          };

        });

      },
      normal = adjustData(data.datapoints, <span class="hljs-string">''</span>),
      shifted = adjustData(data.datapoints_shifted, <span class="hljs-string">' (shifted)'</span>);

    combined = [];

<span class="hljs-comment">/*
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>get min and max of ref data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (key === <span class="hljs-number">0</span> &amp;&amp; suffix != <span class="hljs-string">""</span>) {
            ref_min = valuePeaks[o.datastreamid].min;
            ref_max = valuePeaks[o.datastreamid].max;
          }<span class="hljs-keyword">else</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>check if this needs to be normalize</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            if(valuePeaks[o.datastreamid].min &gt; ref_max || valuePeaks[o.datastreamid].max &lt; ref_min){
              valuePeaks[o.datastreamid].normalize = true;
            }
          }
 */</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>getting the order to display and get mean of mins and maxs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(normal, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o, key)</span> </span>{
      <span class="hljs-keyword">if</span> (key === <span class="hljs-number">0</span>) {<span class="hljs-comment">//reference line</span>
        ref_min = valuePeaks[o.datastreamid].min;
        ref_max = valuePeaks[o.datastreamid].max;</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>mean_min +=ref_min;
mean_max +=ref_max;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        combined.push(o);</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>combined.push(o);//second ref line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      } <span class="hljs-keyword">else</span> {<span class="hljs-comment">//everything else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>check if this needs to be normalize</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>(valuePeaks[o.datastreamid].min &gt; ref_max || valuePeaks[o.datastreamid].max &lt; ref_min){
          valuePeaks[o.datastreamid].normalize = <span class="hljs-literal">true</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>mean_min +=valuePeaks[o.datastreamid].min;
mean_max +=valuePeaks[o.datastreamid].max;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        combined.push(o);
        combined.push(shifted[key]);
      }
    });

      series = _.chain(combined).flatten(<span class="hljs-literal">true</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o, index)</span> </span>{

      values = _.chain(o.data).pluck(<span class="hljs-string">'value'</span>).value();

      _.each(o.data, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj, key)</span> </span>{
        <span class="hljs-keyword">var</span> oKey = values[key]
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> originalData[o.datastreamname] === <span class="hljs-string">'undefined'</span>) {
          originalData[o.datastreamname] = {};
        }
        originalData[o.datastreamname][oKey] = obj.value;
      });

      <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'id'</span>: o.datastreamid,
        <span class="hljs-string">'name'</span>: o.datastreamname,
        <span class="hljs-string">'lineWidth'</span>: (index === <span class="hljs-number">0</span>) ? <span class="hljs-number">5</span> : <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>‘yAxis’: (index === 0) ? 0 : index,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">'dashStyle'</span>: (index === <span class="hljs-number">0</span>) ? <span class="hljs-string">'shortdash'</span> : <span class="hljs-string">'solid'</span>,
        <span class="hljs-string">'data'</span>: _.map(o.data, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o, key)</span> </span>{
          <span class="hljs-keyword">return</span> [o.date.toUTC(), values[key]];
        })
      };
    }).sortBy(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
      <span class="hljs-keyword">if</span> (shifts &amp;&amp; shifts.shifts) {
        shift = _.find(shifts.shifts, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s)</span> </span>{
          <span class="hljs-keyword">return</span> s.datastreamname === o.name;
        });
      }

      <span class="hljs-keyword">return</span> (shift &amp;&amp; shift.shiftfactor) ? shift.shiftfactor + shift.datastreamid : -<span class="hljs-number">1</span>;
    }).value();

    Highcharts.Point.prototype.tooltipFormatter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(useHeader)</span> </span>{
      <span class="hljs-keyword">var</span> point = <span class="hljs-keyword">this</span>,
        series = point.series;</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>console.log(series.name, point.y, “Value”+series.userOptions.yAxis);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> [<span class="hljs-string">'&lt;span style="color:'</span> + series.color + <span class="hljs-string">'"&gt;'</span>, (point.name || series.name), <span class="hljs-string">'&lt;/span&gt;: '</span>,
        (!useHeader ? (<span class="hljs-string">'&lt;b&gt;x = '</span> + (point.name || point.x) + <span class="hljs-string">',&lt;/b&gt; '</span>) : <span class="hljs-string">''</span>),
        <span class="hljs-string">'&lt;b&gt;'</span>, (!useHeader ? <span class="hljs-string">'y = '</span> : <span class="hljs-string">''</span>), Highcharts.numberFormat(originalData[series.name][point.y], <span class="hljs-number">2</span>), <span class="hljs-string">'&lt;/b&gt;&lt;br/&gt;'</span>].join(<span class="hljs-string">''</span>);
    };

    <span class="hljs-keyword">var</span> chartOptions = {
      <span class="hljs-string">'chart'</span>: {
        <span class="hljs-string">'type'</span>: <span class="hljs-string">'spline'</span>,
        backgroundColor: <span class="hljs-literal">null</span>,
        height: <span class="hljs-number">500</span>,
        zoomType: <span class="hljs-string">'xy'</span> <span class="hljs-comment">//add back zoom</span>
      },
      <span class="hljs-string">'title'</span>: {
        <span class="hljs-string">'text'</span>: <span class="hljs-string">''</span>
      },
      <span class="hljs-string">'yAxis'</span>: {
        <span class="hljs-string">'title'</span>: {
          <span class="hljs-string">'text'</span>: <span class="hljs-string">'Value'</span>
        },
        <span class="hljs-string">'labels'</span>: {
          <span class="hljs-string">'enabled'</span>: <span class="hljs-literal">true</span>
        }
      },
      navigator: {
        series: {
          color: <span class="hljs-string">'#1abc9c'</span>,
          lineColor: <span class="hljs-string">'#16a085'</span>
        }
      },</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p><a href="http://api.highcharts.com/highcharts#plotOptions.series.events.legendItemClick">http://api.highcharts.com/highcharts#plotOptions.series.events.legendItemClick</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        plotOptions: {
            series: {<span class="hljs-comment">//for series, vs line, column etc</span>
                events: {
                    legendItemClick: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>var gtoggle = $(“input[name=’my-checkbox’]”).val();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">var</span> gtoggle = $(<span class="hljs-string">"input[name='my-checkbox']"</span>).is(<span class="hljs-string">":checked"</span>);
                        <span class="hljs-keyword">var</span> visibility = <span class="hljs-keyword">this</span>.visible ? <span class="hljs-string">'visible'</span> : <span class="hljs-string">'hidden'</span>;
                        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'The series is currently '</span> + visibility);
                        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"gtoggle: "</span>+gtoggle);</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Step 1. Set the target indexes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">var</span> targetIndex = event.target._i;

                        <span class="hljs-keyword">if</span>(targetIndex === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<span class="hljs-comment">//return if reference is clicked</span>

                        <span class="hljs-keyword">var</span> _min = event.target.dataMin, _max = event.target.dataMax;

                        <span class="hljs-keyword">var</span> targetSibIndex = targetIndex+<span class="hljs-number">1</span>;<span class="hljs-comment">//assume next is sibling</span>
                        <span class="hljs-keyword">if</span>((event.target.name).indexOf(<span class="hljs-string">"(shifted)"</span>) &gt; -<span class="hljs-number">1</span>){<span class="hljs-comment">//contains shifted?</span>
                          targetSibIndex = targetIndex-<span class="hljs-number">1</span>;<span class="hljs-comment">//get previous element (sibling)</span>

                          _min = <span class="hljs-keyword">this</span>.chart.series[targetSibIndex].dataMin;<span class="hljs-comment">//make sure to get original's min&amp;max</span>
                          _max = <span class="hljs-keyword">this</span>.chart.series[targetSibIndex].dataMax;
                        }

                        <span class="hljs-comment">/*if(gtoggle &amp;&amp; this.chart.series[targetSibIndex]){
                          _min = Math.min(event.target.dataMin, this.chart.series[targetSibIndex].dataMin);
                          _max = Math.max(event.target.dataMax, this.chart.series[targetSibIndex].dataMax);
                        }*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Step 2. Reset to make all visible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        $(<span class="hljs-keyword">this</span>.chart.series).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index, value)</span></span>{
                              <span class="hljs-keyword">this</span>.setVisible(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);<span class="hljs-comment">//second false to not redraw each one</span>
                        });
                        <span class="hljs-keyword">this</span>.chart.redraw();<span class="hljs-comment">//redraw all at once</span></pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>if (!confirm(‘The series is currently ‘ +
            visibility + ‘. Do you want to change that?’)) {</p>

            </div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>this.chart.series[event.target._i].name
event.target.name - gives me the current clicked target
event.target.data
event.target.dataMin
event.target.dataMax</p>

            </div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Step 1. Hide all series</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        $(<span class="hljs-keyword">this</span>.chart.series).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index, value)</span></span>{

                            <span class="hljs-keyword">if</span>(gtoggle){ <span class="hljs-comment">//SHOW BOTH</span></pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Do not hide if it’s ref (index=0), the target clicked, or it’s sibling</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                              <span class="hljs-keyword">if</span>(index !== <span class="hljs-number">0</span> &amp;&amp; index !== targetIndex &amp;&amp; index !== targetSibIndex)
                                <span class="hljs-keyword">this</span>.setVisible(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<span class="hljs-comment">//second false to not redraw each one</span>
                            }
                            <span class="hljs-keyword">else</span>{
                              <span class="hljs-comment">/*console.log('index: ', index);
                              console.log('targetIndex: ', targetIndex);
                              console.log('targetSibIndex: ', targetSibIndex);
                              console.log('visibility: ', visibility);*/</span>
                              <span class="hljs-keyword">if</span>(visibility === <span class="hljs-string">'hidden'</span>){<span class="hljs-comment">//current clicked was hidden</span></pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>show both
Do not hide if it’s ref (index=0), the target clicked, or it’s sibling</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                <span class="hljs-keyword">if</span>(index !== <span class="hljs-number">0</span> &amp;&amp; index !== targetIndex &amp;&amp; index !== targetSibIndex)
                                  <span class="hljs-keyword">this</span>.setVisible(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<span class="hljs-comment">//second false to not redraw each one</span>
                              }
                              <span class="hljs-keyword">else</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Do not hide if it’s ref (index=0), the target clicked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                <span class="hljs-keyword">if</span>(index !== <span class="hljs-number">0</span> &amp;&amp; index !== targetIndex){<span class="hljs-comment">//show only targeted</span>
                                  <span class="hljs-keyword">this</span>.setVisible(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<span class="hljs-comment">//second false to not redraw each one</span>
                                }
                              }
                            }
                        });
                        <span class="hljs-keyword">this</span>.chart.redraw();<span class="hljs-comment">//redraw all at once</span></pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Step 2. get new nomalized data set for reference line from min and max of clicked series.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">var</span> newData = _.chain(<span class="hljs-keyword">this</span>.chart.series[<span class="hljs-number">0</span>].data).pluck(<span class="hljs-string">'y'</span>).normalize([_min, _max]).value();</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Step 3. update series[0] - reference line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">this</span>.chart.series[<span class="hljs-number">0</span>].setData(newData);

                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<span class="hljs-comment">//false will not continue with the chart's action - like hidding series</span>
                    }
                }
            }
        },
      <span class="hljs-string">'rangeSelector'</span>: {
        <span class="hljs-string">'enabled'</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">'selected'</span>: <span class="hljs-number">5</span>,
        inputPosition: {
          <span class="hljs-string">'align'</span>: <span class="hljs-string">'right'</span>,
          <span class="hljs-string">'verticalAlign'</span>: <span class="hljs-string">'top'</span>
        },
        inputDateFormat: <span class="hljs-string">'%Y-%m-%d'</span>,
        inputEditDateFormat: <span class="hljs-string">'%Y-%m-%d'</span>
      },
      <span class="hljs-string">'legend'</span>: {
        <span class="hljs-string">'enabled'</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">'borderWidth'</span>: <span class="hljs-number">0</span>,
        <span class="hljs-string">'width'</span>: <span class="hljs-number">300</span>,
        verticalAlign: <span class="hljs-string">'top'</span>,
        adjustChartSize: <span class="hljs-literal">true</span>,
        itemWidth: <span class="hljs-number">300</span>,
        align: <span class="hljs-string">'right'</span>,
        y: <span class="hljs-number">50</span>
      },
      credits: {
        enabled: <span class="hljs-literal">true</span>
      },

      colors: [
        <span class="hljs-string">'#1abc9c'</span>, <span class="hljs-comment">// turqoise</span>
        <span class="hljs-string">'#3498db'</span>, <span class="hljs-comment">// peter-river</span>
        <span class="hljs-string">'#2980b9'</span>, <span class="hljs-comment">// belize-hole</span>
        <span class="hljs-string">'#9b59b6'</span>, <span class="hljs-comment">// amethyst</span>
        <span class="hljs-string">'#8e44ad'</span>, <span class="hljs-comment">// wisteria</span>
        <span class="hljs-string">'#f1c40f'</span>, <span class="hljs-comment">// sun-flower</span>
        <span class="hljs-string">'#f39c12'</span>, <span class="hljs-comment">// orange</span>
        <span class="hljs-string">'#2ecc71'</span>, <span class="hljs-comment">// emerald</span>
        <span class="hljs-string">'#27ae60'</span>, <span class="hljs-comment">// nephritis</span>
        <span class="hljs-string">'#e74c3c'</span>, <span class="hljs-comment">// alizarin</span>
        <span class="hljs-string">'#c0392b'</span>, <span class="hljs-comment">// pomegranate</span>
        <span class="hljs-string">'#1abc9c'</span>, <span class="hljs-comment">// turqoise</span>
        <span class="hljs-string">'#16a085'</span>, <span class="hljs-comment">// green-sea</span>
        <span class="hljs-string">'#e67e22'</span>, <span class="hljs-comment">// carrot</span>
        <span class="hljs-string">'#d35400'</span>, <span class="hljs-comment">// pumpkin</span>
        <span class="hljs-string">'#34495e'</span>, <span class="hljs-comment">// wet-asphalt</span>
        <span class="hljs-string">'#2c3e50'</span> <span class="hljs-comment">// mignight-blue</span>
      ],

      <span class="hljs-string">'series'</span>: series
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>activate the bootstrap-switch</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">"[name='my-checkbox']"</span>).bootstrapSwitch();

    <span class="hljs-keyword">return</span> chartOptions;
  },

  getSequenceChartOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[App] renderSequenceChart'</span>);

    <span class="hljs-keyword">var</span> colors = [
      <span class="hljs-string">'#1abc9c'</span>, <span class="hljs-comment">// turqoise</span>
      <span class="hljs-string">'#3498db'</span>, <span class="hljs-comment">// peter-river</span>
      <span class="hljs-string">'#9b59b6'</span>, <span class="hljs-comment">// amethyst</span>
      <span class="hljs-string">'#e67e22'</span>, <span class="hljs-comment">// carrot</span>
      <span class="hljs-string">'#34495e'</span>, <span class="hljs-comment">// wet-asphalt</span>
      <span class="hljs-string">'#e74c3c'</span>, <span class="hljs-comment">// alizarin</span>
      <span class="hljs-string">'#16a085'</span>, <span class="hljs-comment">// green-sea</span>
      <span class="hljs-string">'#2980b9'</span>, <span class="hljs-comment">// belize-hole</span>
      <span class="hljs-string">'#8e44ad'</span>, <span class="hljs-comment">// wisteria</span>
      <span class="hljs-string">'#d35400'</span>, <span class="hljs-comment">// pumpkin</span>
      <span class="hljs-string">'#2c3e50'</span>, <span class="hljs-comment">// mignight-blue</span>
      <span class="hljs-string">'#c0392b'</span>, <span class="hljs-comment">// pomegranate</span>
      <span class="hljs-string">'#f1c40f'</span>, <span class="hljs-comment">// sun-flower</span>
      <span class="hljs-string">'#27ae60'</span>, <span class="hljs-comment">// nephritis</span>
      <span class="hljs-string">'#f39c12'</span> <span class="hljs-comment">// orange</span>
    ];


    <span class="hljs-keyword">var</span> reference = {
        <span class="hljs-string">'datastreamid'</span>: data.datapoints[<span class="hljs-number">0</span>].datastreamid,
        <span class="hljs-string">'datastreamname'</span>: data.datapoints[<span class="hljs-number">0</span>].datastreamname,
        <span class="hljs-string">'pecentagecorrelated'</span>: <span class="hljs-number">100</span>,
        <span class="hljs-string">'shiftfactor'</span>: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>‘borderColor’: ‘#000’,
‘borderWidth’: 2,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">'pointWidth'</span>: <span class="hljs-number">20</span>
      },
      sequencedata = _.chain([data.autocorrelate.shifts, reference]).flatten().sortBy(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
        <span class="hljs-keyword">return</span> o.shiftfactor;
      }).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o, index)</span> </span>{
        <span class="hljs-keyword">var</span> color = colors[index];

        <span class="hljs-keyword">var</span> y = <span class="hljs-built_in">parseFloat</span>(o.pecentagecorrelated.toFixed(<span class="hljs-number">2</span>), <span class="hljs-number">10</span>);
        <span class="hljs-keyword">if</span> (o.negativecorrelation)
          y *= -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">var</span> ret = {
          <span class="hljs-string">'category'</span>: o.shiftfactor,
          <span class="hljs-string">'series'</span>: {
            <span class="hljs-string">'name'</span>: o.datastreamname,
            <span class="hljs-string">'color'</span>: color,
            <span class="hljs-string">'pointWidth'</span>: reference.pointWidth,
            <span class="hljs-string">'y'</span>: y,
            <span class="hljs-string">'borderColor'</span>: o.borderColor || color <span class="hljs-comment">// Outline any bars with red if negatively correlated</span>
          }
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>if (o.negativecorrelation) ret.series.borderWidth = 2;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> ret;
      }).value(),
      categories = _.range(
      _.min(sequencedata, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
        <span class="hljs-keyword">return</span> o.category;
      }).category,
      _.max(sequencedata, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
          <span class="hljs-keyword">return</span> o.category;
        }).category + <span class="hljs-number">1</span>,
      <span class="hljs-number">1</span>
      ),
      series = _.chain(sequencedata).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
        <span class="hljs-keyword">var</span> data = _.map(categories, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
          <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        });
        data[categories.indexOf(o.category)] = o.series;

        <span class="hljs-keyword">return</span> {
          <span class="hljs-string">'name'</span>: o.series.name,
          <span class="hljs-string">'data'</span>: data,
          <span class="hljs-string">'pointWidth'</span>: o.series.pointWidth
        };
      }).value();

    <span class="hljs-keyword">if</span> (!categories.length) {
      categories = [<span class="hljs-number">0</span>];
    }

    <span class="hljs-comment">/* Reverse the order. This can be optimized later. */</span>
    categories = _.sortBy(categories, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o, key)</span> </span>{
      <span class="hljs-keyword">return</span> -key;
    });
    series = _.map(series, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(oSeries, kSeries)</span> </span>{
      oSeries.data = _.sortBy(oSeries.data, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(oData, kData)</span> </span>{
        <span class="hljs-keyword">return</span> -kData;
      });
      <span class="hljs-keyword">return</span> oSeries;
    });

    <span class="hljs-keyword">var</span> chartOptions = {
      <span class="hljs-string">'chart'</span>: {
        <span class="hljs-string">'type'</span>: <span class="hljs-string">'column'</span>,
        backgroundColor: <span class="hljs-literal">null</span>
      },
      colors: colors,
      <span class="hljs-string">'title'</span>: {
        <span class="hljs-string">'text'</span>: <span class="hljs-string">''</span>
      },
      <span class="hljs-string">'xAxis'</span>: {
        categories: categories,
        <span class="hljs-string">'title'</span>: {
          <span class="hljs-string">'text'</span>: <span class="hljs-string">'Event Sequence ('</span> + data.params.shiftType + <span class="hljs-string">')'</span>
        },
        labels: {
          formatter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> categories[<span class="hljs-keyword">this</span>.value];
          }
        }
      },
      <span class="hljs-string">'yAxis'</span>: {
        <span class="hljs-string">'title'</span>: {
          <span class="hljs-string">'text'</span>: <span class="hljs-string">'Percentage Correlated'</span>
        },
        <span class="hljs-string">'max'</span>: <span class="hljs-number">100</span>
      },
      tooltip: {
        shared: <span class="hljs-literal">false</span>,
        <span class="hljs-string">'formatter'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;b&gt;'</span> + <span class="hljs-keyword">this</span>.series.name + <span class="hljs-string">'&lt;/b&gt;: '</span> + <span class="hljs-keyword">this</span>.y;
        }
      },
      scrollbar: {
        enabled: <span class="hljs-literal">false</span>
      },
      <span class="hljs-string">'useStockChart'</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">'navigator'</span>: {
        enabled: <span class="hljs-literal">false</span>
      },
      rangeSelector: {
        enabled: <span class="hljs-literal">false</span>
      },
      <span class="hljs-string">'legend'</span>: {
        <span class="hljs-string">'enabled'</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">'layout'</span>: <span class="hljs-string">'vertical'</span>,
        <span class="hljs-string">'align'</span>: <span class="hljs-string">'center'</span>,
        <span class="hljs-string">'verticalAlign'</span>: <span class="hljs-string">'bottom'</span>,
        <span class="hljs-string">'borderWidth'</span>: <span class="hljs-number">0</span>,
        <span class="hljs-string">'width'</span>: <span class="hljs-number">300</span>,
        y: <span class="hljs-number">0</span>
      },
      credits: {
        enabled: <span class="hljs-literal">false</span>
      },
      <span class="hljs-string">'series'</span>: series
    };

    <span class="hljs-keyword">return</span> chartOptions;
  },

  getBestPredictorChartOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[App] renderBestResultsChart'</span>);

    <span class="hljs-keyword">var</span> colors = [
      <span class="hljs-string">'#1abc9c'</span>, <span class="hljs-comment">// turqoise</span>
      <span class="hljs-string">'#3498db'</span>, <span class="hljs-comment">// peter-river</span>
      <span class="hljs-string">'#9b59b6'</span>, <span class="hljs-comment">// amethyst</span>
      <span class="hljs-string">'#e67e22'</span>, <span class="hljs-comment">// carrot</span>
      <span class="hljs-string">'#34495e'</span>, <span class="hljs-comment">// wet-asphalt</span>
      <span class="hljs-string">'#e74c3c'</span>, <span class="hljs-comment">// alizarin</span>
      <span class="hljs-string">'#16a085'</span>, <span class="hljs-comment">// green-sea</span>
      <span class="hljs-string">'#2980b9'</span>, <span class="hljs-comment">// belize-hole</span>
      <span class="hljs-string">'#8e44ad'</span>, <span class="hljs-comment">// wisteria</span>
      <span class="hljs-string">'#d35400'</span>, <span class="hljs-comment">// pumpkin</span>
      <span class="hljs-string">'#2c3e50'</span>, <span class="hljs-comment">// mignight-blue</span>
      <span class="hljs-string">'#c0392b'</span>, <span class="hljs-comment">// pomegranate</span>
      <span class="hljs-string">'#f1c40f'</span>, <span class="hljs-comment">// sun-flower</span>
      <span class="hljs-string">'#27ae60'</span>, <span class="hljs-comment">// nephritis</span>
      <span class="hljs-string">'#f39c12'</span> <span class="hljs-comment">// orange</span>
    ];

    <span class="hljs-keyword">var</span> factors, arr, categories, series;

    <span class="hljs-keyword">var</span> chartOptions = jQuery.extend(<span class="hljs-literal">true</span>, {}, {
      <span class="hljs-string">'chart'</span>: {
        <span class="hljs-string">'type'</span>: <span class="hljs-string">'column'</span>,
        backgroundColor: <span class="hljs-literal">null</span>
      },
      colors: colors,
      <span class="hljs-string">'title'</span>: {
        <span class="hljs-string">'text'</span>: <span class="hljs-string">''</span>
      },
      xAxis: {
        <span class="hljs-string">'title'</span>: {
          <span class="hljs-string">'text'</span>: <span class="hljs-string">'Time Shift ('</span> + data.params.shiftType + <span class="hljs-string">')'</span>
        },
        labels: {
          formatter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> categories[<span class="hljs-keyword">this</span>.value];
          }
        }
      },
      <span class="hljs-string">'yAxis'</span>: {
        <span class="hljs-string">'title'</span>: {
          <span class="hljs-string">'text'</span>: <span class="hljs-string">'Percentage Correlated'</span>
        },
        <span class="hljs-string">'max'</span>: <span class="hljs-number">100</span>
      },
      <span class="hljs-string">'tooltip'</span>: {
        shared: <span class="hljs-literal">false</span>,
        <span class="hljs-string">'formatter'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;b&gt;'</span> + <span class="hljs-keyword">this</span>.series.name + <span class="hljs-string">'&lt;/b&gt;: '</span> + <span class="hljs-keyword">this</span>.y;
        }
      },
      scrollbar: {
        enabled: <span class="hljs-literal">false</span>
      },
      <span class="hljs-string">'useStockChart'</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">'navigator'</span>: {
        enabled: <span class="hljs-literal">false</span>
      },
      rangeSelector: {
        enabled: <span class="hljs-literal">false</span>
      },
      <span class="hljs-string">'legend'</span>: {
        <span class="hljs-string">'enabled'</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">'layout'</span>: <span class="hljs-string">'vertical'</span>,
        <span class="hljs-string">'align'</span>: <span class="hljs-string">'center'</span>,
        <span class="hljs-string">'verticalAlign'</span>: <span class="hljs-string">'bottom'</span>,
        <span class="hljs-string">'borderWidth'</span>: <span class="hljs-number">0</span>,
        <span class="hljs-string">'width'</span>: <span class="hljs-number">300</span>,
        y: <span class="hljs-number">0</span>
      },
      credits: {
        enabled: <span class="hljs-literal">false</span>
      }
    });

    <span class="hljs-keyword">if</span> (data &amp;&amp; data.autofactorreduce &amp;&amp; data.autofactorreduce.factors) {
      factors = _.clone(data.autofactorreduce.factors);
      factors.push({
        <span class="hljs-string">'datastreamid'</span>: data.datapoints[<span class="hljs-number">0</span>].datastreamid,
        <span class="hljs-string">'datastreamname'</span>: data.datapoints[<span class="hljs-number">0</span>].datastreamname + <span class="hljs-string">' (Reference)'</span>,
        <span class="hljs-string">'negativecorrelation'</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">'percentagecorrelated'</span>: <span class="hljs-number">100</span>,
        <span class="hljs-string">'rank'</span>: <span class="hljs-number">0</span>,
        <span class="hljs-string">'shiftfactor'</span>: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>‘color’: ‘#1abc9c’,
‘borderColor’: ‘#000’,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">'borderWidth'</span>: <span class="hljs-number">0</span>,
        <span class="hljs-string">'pointWidth'</span>: <span class="hljs-number">20</span>
      });

      factors = _.sortBy(factors, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> </span>{
        <span class="hljs-keyword">return</span> o.shiftfactor;
      });

      arr = _.map(_.range(factors.length), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
      });

      categories = _.pluck(factors, <span class="hljs-string">'shiftfactor'</span>);
      series = _.map(factors, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o, key)</span> </span>{
        <span class="hljs-keyword">var</span> ret,
          data = _.clone(arr);

        data[key] = <span class="hljs-built_in">parseFloat</span>(<span class="hljs-built_in">Math</span>.abs(o.percentagecorrelated).toFixed(<span class="hljs-number">2</span>), <span class="hljs-number">10</span>);

        <span class="hljs-keyword">if</span> (o.negativecorrelation) {
          data[key] *= -<span class="hljs-number">1</span>;
        }

        ret = {
          <span class="hljs-string">'name'</span>: o.datastreamname,
          <span class="hljs-string">'data'</span>: data
        };

        <span class="hljs-keyword">if</span> (o.negativecorrelation) {</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>ret.borderColor = ‘#e74c3c’;
ret.borderWidth = 2</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }

        ret.color = colors[key];
        ret.pointWidth = <span class="hljs-number">20</span>;

        <span class="hljs-keyword">return</span> ret;
      });

      <span class="hljs-comment">/* Reverse the order. This can be optimized later. */</span>
      categories = _.sortBy(categories, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o, key)</span> </span>{
        <span class="hljs-keyword">return</span> -key;
      });
      series = _.map(series, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(oSeries, kSeries)</span> </span>{
        oSeries.data = _.sortBy(oSeries.data, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(oData, kData)</span> </span>{
          <span class="hljs-keyword">return</span> -kData;
        });
        <span class="hljs-keyword">return</span> oSeries;
      });
      chartOptions.xAxis.categories = categories;
      chartOptions.series = series;

    } <span class="hljs-keyword">else</span> {
      chartOptions.xAxis.categories = [];
      chartOptions.series = [];
    }

    <span class="hljs-keyword">return</span> chartOptions;
  },

  buildWorksheetInTab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, tabSelector)</span> </span>{
    $(tabSelector + <span class="hljs-string">' .trending-charts'</span>).show();
    $(tabSelector + <span class="hljs-string">' #trendingChartLoader'</span>).hide();

    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> data.data === <span class="hljs-string">'string'</span>){
      data.data = <span class="hljs-built_in">JSON</span>.parse(data);
    }
    <span class="hljs-keyword">this</span>.renderChart($(tabSelector + <span class="hljs-string">' .correlation-chart'</span>), <span class="hljs-keyword">this</span>.getCorrelationChartOptions(data.data));
    <span class="hljs-keyword">this</span>.renderChart($(tabSelector + <span class="hljs-string">' .sequence-chart'</span>), <span class="hljs-keyword">this</span>.getSequenceChartOptions(data.data));
    <span class="hljs-keyword">this</span>.renderTopCorrelationTable($(tabSelector + <span class="hljs-string">' .correlation-table'</span>), data.data);
    <span class="hljs-keyword">this</span>.renderTopCorrelationTable($(tabSelector + <span class="hljs-string">' .sequence-table'</span>), data.data);

    <span class="hljs-built_in">console</span>.log(data.data.autofactorreduce);

    <span class="hljs-keyword">if</span> (data.data.autofactorreduce.error) {</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>display error messages…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> errorMessage = <span class="hljs-string">'Error: '</span> + data.data.autofactorreduce.error.code + <span class="hljs-string">' - '</span> + data.data.autofactorreduce.error.message;
      errorMessage += <span class="hljs-string">'&lt;br/&gt;Modify the snapshot parameters to increase the number of data set rows and/or decrease the number of data sets in the analysis.'</span>;
      $(<span class="hljs-string">'#best-predictor-chart-tab'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' #best-predictor-error'</span>).html(errorMessage);
      $(<span class="hljs-string">'#best-predictor-chart-tab'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' .analyze-error'</span>).show();
      $(tabSelector).find(<span class="hljs-string">'.trending-charts ul li a[href^="#best-predictor"]'</span>).addClass(<span class="hljs-string">'icon-warning-sign'</span>);

      $(<span class="hljs-string">'#forecast-chart-tab'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' #forecast-error'</span>).html(errorMessage);
      $(<span class="hljs-string">'#forecast-chart-tab'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>) + <span class="hljs-string">' .analyze-error'</span>).show();
      $(tabSelector).find(<span class="hljs-string">'.trending-charts ul li a[href^="#forecast"]'</span>).addClass(<span class="hljs-string">'icon-warning-sign'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">this</span>.renderChart($(tabSelector + <span class="hljs-string">' .best-predictor-chart'</span>), <span class="hljs-keyword">this</span>.getBestPredictorChartOptions(data.data));
      <span class="hljs-keyword">var</span> chartOptions = <span class="hljs-keyword">this</span>.getCorrelationChartOptions(data.data);
      <span class="hljs-keyword">this</span>.renderChart($(tabSelector + <span class="hljs-string">' .forecast-chart'</span>), chartOptions);
      <span class="hljs-keyword">this</span>.renderBestPredictorModelTable($(tabSelector + <span class="hljs-string">' .best-predictor-table'</span>), data.data);
      data.data.chartOptions = chartOptions;
      <span class="hljs-keyword">this</span>.renderForecastEqualizer($(tabSelector + <span class="hljs-string">' .forecast-equalizer'</span>), data.data);
    }
  },

  copyChartsToTab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tabSelector)</span> </span>{
    $(tabSelector).find(<span class="hljs-string">'.trending-charts'</span>).show();

    <span class="hljs-keyword">this</span>.renderChart($(<span class="hljs-string">'.correlation-chart'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>)), <span class="hljs-keyword">this</span>.getSavedCorrelationChartOptions());
    <span class="hljs-keyword">this</span>.renderChart($(<span class="hljs-string">'.best-predictor-chart'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>)), <span class="hljs-keyword">this</span>.getSavedBestPredictorChartOptions());
    <span class="hljs-keyword">this</span>.renderChart($(<span class="hljs-string">'.sequence-chart'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>)), <span class="hljs-keyword">this</span>.getSavedSequenceChartOptions());

    <span class="hljs-keyword">this</span>.renderTopCorrelationTable($(<span class="hljs-string">'.correlation-table'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>)), <span class="hljs-keyword">this</span>.getSavedTopCorrelationData());
    <span class="hljs-keyword">this</span>.renderTopCorrelationTable($(<span class="hljs-string">'.sequence-table'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>)), <span class="hljs-keyword">this</span>.getSavedTopCorrelationData());
    <span class="hljs-keyword">this</span>.renderBestPredictorModelTable($(<span class="hljs-string">'.best-predictor-table'</span> + (<span class="hljs-keyword">this</span>.chartContainerCount - <span class="hljs-number">1</span>)), <span class="hljs-keyword">this</span>.getSavedBestPredictorModelTableData());

  },

  onDateChange: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.calculateAdjustedDates();
    <span class="hljs-keyword">this</span>.validateForm();
    <span class="hljs-keyword">var</span> startDate = $(<span class="hljs-string">'.field-start-date'</span>).val();
    <span class="hljs-keyword">var</span> endDate = $(<span class="hljs-string">'.field-end-date'</span>).val();
    <span class="hljs-keyword">var</span> currentSnapshot = $(<span class="hljs-string">'.btn-tab.active'</span>).find(<span class="hljs-string">'span.name'</span>).text();
    <span class="hljs-keyword">var</span> snapshotData = store.get(currentSnapshot);
    <span class="hljs-keyword">if</span> (!snapshotData) {
      snapshotData = {};
    }
    snapshotData.startDate = startDate;
    snapshotData.endDate = endDate;
    store.set(currentSnapshot, snapshotData);
  },

  onOffsetChange: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{

    <span class="hljs-keyword">this</span>.calculateAdjustedDates();
    <span class="hljs-keyword">this</span>.validateForm();
  },

  calculateAdjustedDates: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> start = <span class="hljs-built_in">Date</span>.parseExact($(<span class="hljs-string">'.field-start-date'</span>).val(), <span class="hljs-string">'yyyy-MM-dd'</span>);
    <span class="hljs-keyword">var</span> end = <span class="hljs-built_in">Date</span>.parseExact($(<span class="hljs-string">'.field-end-date'</span>).val(), <span class="hljs-string">'yyyy-MM-dd'</span>);

    <span class="hljs-keyword">var</span> offset = $(<span class="hljs-string">'.field-offset-limit'</span>).val();
    <span class="hljs-keyword">var</span> offsetType = $(<span class="hljs-string">'.field-offset-type'</span>).select2(<span class="hljs-string">'val'</span>);

    <span class="hljs-keyword">if</span> (start !== <span class="hljs-literal">null</span> &amp;&amp; end !== <span class="hljs-literal">null</span> &amp;&amp; $.isNumeric(offset)) {

      offset = <span class="hljs-built_in">parseInt</span>(offset);

      <span class="hljs-keyword">if</span> (offset != <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (offsetType === <span class="hljs-string">'day'</span>) {
          start.add({
            days: offset * -<span class="hljs-number">1</span>
          });
          end.add({
            days: offset
          });
        }
        <span class="hljs-keyword">if</span> (offsetType === <span class="hljs-string">'week'</span>) {
          start.add({
            days: offset * <span class="hljs-number">7</span> * -<span class="hljs-number">1</span>
          });
          end.add({
            days: offset * <span class="hljs-number">7</span>
          });
        }
        <span class="hljs-keyword">if</span> (offsetType === <span class="hljs-string">'month'</span>) {
          start.add({
            months: offset * -<span class="hljs-number">1</span>
          });
          end.add({
            months: offset
          });
        }
        <span class="hljs-keyword">if</span> (offsetType === <span class="hljs-string">'year'</span>) {
          start.add({
            years: offset * -<span class="hljs-number">1</span>
          });
          end.add({
            years: offset
          });
        }
      }

      <span class="hljs-keyword">var</span> startString = start.toString(<span class="hljs-string">'yyyy-MM-dd'</span>);
      <span class="hljs-keyword">var</span> endString = end.toString(<span class="hljs-string">'yyyy-MM-dd'</span>);

      $(<span class="hljs-string">'.adjusted-start-date'</span>, <span class="hljs-keyword">this</span>.optionsSelector).val(startString);
      $(<span class="hljs-string">'.adjusted-end-date'</span>, <span class="hljs-keyword">this</span>.optionsSelector).val(endString);
    }
  },

  validateForm: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">this</span>.clearOptionErrors();

    <span class="hljs-keyword">var</span> start = <span class="hljs-built_in">Date</span>.parseExact($(<span class="hljs-string">'.field-start-date'</span>).val(), <span class="hljs-string">'yyyy-MM-dd'</span>);
    <span class="hljs-keyword">var</span> end = <span class="hljs-built_in">Date</span>.parseExact($(<span class="hljs-string">'.field-end-date'</span>).val(), <span class="hljs-string">'yyyy-MM-dd'</span>);
    <span class="hljs-keyword">var</span> effectiveStart = <span class="hljs-built_in">Date</span>.parseExact($(<span class="hljs-string">'.adjusted-start-date'</span>).val(), <span class="hljs-string">'yyyy-MM-dd'</span>);
    <span class="hljs-keyword">var</span> effectiveEnd = <span class="hljs-built_in">Date</span>.parseExact($(<span class="hljs-string">'.adjusted-end-date'</span>).val(), <span class="hljs-string">'yyyy-MM-dd'</span>);

    <span class="hljs-keyword">if</span> (start === <span class="hljs-literal">null</span>) {
      $(<span class="hljs-string">'.field-start-date'</span>).addClass(<span class="hljs-string">'error'</span>).after(<span class="hljs-string">'&lt;small class="label label-important error error-message"&gt;Invalid Date&lt;/small&gt;'</span>);
    }

    <span class="hljs-keyword">if</span> (end === <span class="hljs-literal">null</span>) {
      $(<span class="hljs-string">'.field-end-date'</span>).addClass(<span class="hljs-string">'error'</span>).after(<span class="hljs-string">'&lt;small class="label label-important error error-message"&gt;Invalid Date&lt;/small&gt;'</span>);
    }

    <span class="hljs-keyword">if</span> (!$.isNumeric($(<span class="hljs-string">'.field-offset-limit'</span>).customspinner(<span class="hljs-string">'value'</span>))) {
      $(<span class="hljs-string">'.field-offset-limit'</span>).addClass(<span class="hljs-string">'error'</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>validate reference data ranges</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">'.field-reference-data'</span>).find(<span class="hljs-string">'option:selected'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(i, el)</span> </span>{
      <span class="hljs-keyword">if</span> ($(el).val() === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">var</span> optionStart = <span class="hljs-built_in">Date</span>.parse(dateToUTC(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($(el).data(<span class="hljs-string">'start'</span>))).toString(<span class="hljs-string">'yyyy-MM-dd'</span>), <span class="hljs-string">'yyyy-MM-dd'</span>);
      <span class="hljs-keyword">var</span> optionEnd = <span class="hljs-built_in">Date</span>.parse(dateToUTC(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($(el).data(<span class="hljs-string">'end'</span>))).toString(<span class="hljs-string">'yyyy-MM-dd'</span>), <span class="hljs-string">'yyyy-MM-dd'</span>);

      <span class="hljs-keyword">if</span> (start.compareTo(optionStart) &lt; <span class="hljs-number">0</span>) {
        _this.addOptionWarning($(el).text() + <span class="hljs-string">' data begins on '</span> + optionStart.toString(<span class="hljs-string">'yyyy-MM-dd'</span>));
      }
      <span class="hljs-keyword">if</span> (end.compareTo(optionEnd) &gt; <span class="hljs-number">0</span>) {
        _this.addOptionWarning($(el).text() + <span class="hljs-string">' data ends on '</span> + optionEnd.toString(<span class="hljs-string">'yyyy-MM-dd'</span>));
      }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>validate test-data ranges</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">'.field-test-data'</span>).find(<span class="hljs-string">'option:selected'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(i, el)</span> </span>{
      <span class="hljs-keyword">if</span> ($(el).val() === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">var</span> optionStart = <span class="hljs-built_in">Date</span>.parse(dateToUTC(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($(el).data(<span class="hljs-string">'start'</span>))).toString(<span class="hljs-string">'yyyy-MM-dd'</span>), <span class="hljs-string">'yyyy-MM-dd'</span>);
      <span class="hljs-keyword">var</span> optionEnd = <span class="hljs-built_in">Date</span>.parse(dateToUTC(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($(el).data(<span class="hljs-string">'end'</span>))).toString(<span class="hljs-string">'yyyy-MM-dd'</span>), <span class="hljs-string">'yyyy-MM-dd'</span>);

      <span class="hljs-keyword">if</span> (effectiveStart.compareTo(optionStart) &lt; <span class="hljs-number">0</span>) {
        _this.addOptionWarning($(el).text() + <span class="hljs-string">' data begins on '</span> + optionStart.toString(<span class="hljs-string">'yyyy-MM-dd'</span>));
      }
      <span class="hljs-keyword">if</span> (effectiveEnd.compareTo(optionEnd) &gt; <span class="hljs-number">0</span>) {
        _this.addOptionWarning($(el).text() + <span class="hljs-string">' data ends on '</span> + optionEnd.toString(<span class="hljs-string">'yyyy-MM-dd'</span>));
      }
    });

    <span class="hljs-keyword">if</span> (start.compareTo(end) &gt;= <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.addOptionError(<span class="hljs-string">'Analysis Start Date must occur before Analysis End Date'</span>);
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hasOptionErrors()) {
      $(<span class="hljs-string">'.btn-submit'</span>, <span class="hljs-keyword">this</span>.optionsSelector).addClass(<span class="hljs-string">'disabled'</span>).attr(<span class="hljs-string">'disabled'</span>, <span class="hljs-string">'disabled'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    } <span class="hljs-keyword">else</span> {
      $(<span class="hljs-string">'.btn-submit'</span>, <span class="hljs-keyword">this</span>.optionsSelector).removeClass(<span class="hljs-string">'disabled'</span>).removeAttr(<span class="hljs-string">'disabled'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
  },

  validateReferenceAndTestData: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.validateForm();

    <span class="hljs-keyword">var</span> valid = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'.field-test-data'</span>).find(<span class="hljs-string">'option:selected'</span>).length == <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.addOptionError(<span class="hljs-string">'You must select Test Data to Analyze.'</span>);
      valid = <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'.field-reference-data'</span>).find(<span class="hljs-string">'option:selected'</span>).val() == <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.addOptionError(<span class="hljs-string">'You must select Reference Data to Analyze.'</span>);
      valid = <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">return</span> valid;
  },

  addOptionError: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(msg)</span> </span>{
    $(<span class="hljs-string">'.errors'</span>, <span class="hljs-keyword">this</span>.optionsSelector).append(<span class="hljs-string">'&lt;div class="flat-alert flat-alert-error flat-alert-thin"&gt;&lt;i class="icon-ban-circle"&gt;&lt;/i&gt; '</span> + msg + <span class="hljs-string">'&lt;/div&gt;'</span>);
  },

  addOptionWarning: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(msg)</span> </span>{
    $(<span class="hljs-string">'.errors'</span>, <span class="hljs-keyword">this</span>.optionsSelector).append(<span class="hljs-string">'&lt;div class="flat-alert flat-alert-thin"&gt;&lt;i class="icon-warning-sign"&gt;&lt;/i&gt; '</span> + msg + <span class="hljs-string">'&lt;/div&gt;'</span>);
  },

  clearOptionErrors: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $(<span class="hljs-string">'.field-start-date'</span>, <span class="hljs-keyword">this</span>.optionsSelector).removeClass(<span class="hljs-string">'error'</span>).parent().find(<span class="hljs-string">'.error-message'</span>).remove();
    $(<span class="hljs-string">'.field-end-date'</span>, <span class="hljs-keyword">this</span>.optionsSelector).removeClass(<span class="hljs-string">'error'</span>).parent().find(<span class="hljs-string">'.error-message'</span>).remove();
    $(<span class="hljs-string">'.field-offset-limit'</span>, <span class="hljs-keyword">this</span>.optionsSelector).removeClass(<span class="hljs-string">'error'</span>);
    $(<span class="hljs-string">'.errors'</span>, <span class="hljs-keyword">this</span>.optionsSelector).html(<span class="hljs-string">''</span>);
  },

  hasOptionErrors: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> $(<span class="hljs-keyword">this</span>.optionsSelector).find(<span class="hljs-string">'.error, .flat-alert-error'</span>).length &gt; <span class="hljs-number">0</span>;
  },

  getQuarter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{
    <span class="hljs-keyword">var</span> d = d || <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
    <span class="hljs-keyword">var</span> q = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];
    <span class="hljs-keyword">return</span> q[<span class="hljs-built_in">Math</span>.floor(d.getMonth() / <span class="hljs-number">3</span>)];
  },

  getFirstMonthOfQuarter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(q)</span> </span>{
    <span class="hljs-keyword">return</span> ((q - <span class="hljs-number">1</span>) * <span class="hljs-number">3</span>);
  },

  onPresetDateClick: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> preset = $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'preset'</span>);

    <span class="hljs-keyword">var</span> $start = $(<span class="hljs-string">'.field-start-date'</span>);
    <span class="hljs-keyword">var</span> $end = $(<span class="hljs-string">'.field-end-date'</span>);
    <span class="hljs-keyword">var</span> start = <span class="hljs-built_in">Date</span>.parseExact($start.val(), <span class="hljs-string">'yyyy-MM-dd'</span>);
    <span class="hljs-keyword">var</span> end = <span class="hljs-built_in">Date</span>.parseExact($end.val(), <span class="hljs-string">'yyyy-MM-dd'</span>);

    <span class="hljs-keyword">if</span> (preset === <span class="hljs-string">'today'</span>) {
      start = <span class="hljs-built_in">Date</span>.today();
      end = <span class="hljs-built_in">Date</span>.today();
    }
    <span class="hljs-keyword">if</span> (preset === <span class="hljs-string">'ytd'</span>) {
      start = <span class="hljs-built_in">Date</span>.today().set({
        month: <span class="hljs-number">0</span>,
        day: <span class="hljs-number">1</span>
      });
      end = <span class="hljs-built_in">Date</span>.today();
    }
    <span class="hljs-keyword">if</span> (preset === <span class="hljs-string">'qtd'</span>) {
      start = <span class="hljs-built_in">Date</span>.today().set({
        month: <span class="hljs-keyword">this</span>.getFirstMonthOfQuarter(<span class="hljs-keyword">this</span>.getQuarter()),
        day: <span class="hljs-number">1</span>
      });
      end = <span class="hljs-built_in">Date</span>.today();
    }
    <span class="hljs-keyword">if</span> (preset === <span class="hljs-string">'mtd'</span>) {
      start = <span class="hljs-built_in">Date</span>.today().moveToFirstDayOfMonth();
      end = <span class="hljs-built_in">Date</span>.today();
    }
    <span class="hljs-keyword">if</span> (preset === <span class="hljs-string">'wtd'</span>) {
      start = <span class="hljs-built_in">Date</span>.today().moveToDayOfWeek(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);
      end = <span class="hljs-built_in">Date</span>.today();
    }

    <span class="hljs-keyword">if</span> (preset === <span class="hljs-string">'last-year'</span>) {
      start = <span class="hljs-built_in">Date</span>.today().add({
        years: -<span class="hljs-number">1</span>
      }).set({
        month: <span class="hljs-number">0</span>,
        day: <span class="hljs-number">1</span>
      });
      end = <span class="hljs-built_in">Date</span>.today().add({
        years: -<span class="hljs-number">1</span>
      }).set({
        month: <span class="hljs-number">11</span>
      }).moveToLastDayOfMonth();
    }
    <span class="hljs-keyword">if</span> (preset === <span class="hljs-string">'last-quarter'</span>) {
      <span class="hljs-keyword">var</span> firstMonthOfCurrentQuarter = <span class="hljs-keyword">this</span>.getFirstMonthOfQuarter(<span class="hljs-keyword">this</span>.getQuarter());
      <span class="hljs-keyword">var</span> dateInLastQuarter = <span class="hljs-built_in">Date</span>.today().set({
        month: firstMonthOfCurrentQuarter,
        day: <span class="hljs-number">1</span>
      }).add({
        days: -<span class="hljs-number">1</span>
      });
      <span class="hljs-keyword">var</span> firstMonthOfLastQuarter = <span class="hljs-keyword">this</span>.getFirstMonthOfQuarter(<span class="hljs-keyword">this</span>.getQuarter(dateInLastQuarter));
      <span class="hljs-keyword">var</span> lastMonthOfLastQuarter = firstMonthOfLastQuarter + <span class="hljs-number">2</span>;
      start = <span class="hljs-built_in">Date</span>.today().set({
        month: firstMonthOfLastQuarter,
        day: <span class="hljs-number">1</span>
      });
      end = <span class="hljs-built_in">Date</span>.today().set({
        month: lastMonthOfLastQuarter
      }).moveToLastDayOfMonth();
    }
    <span class="hljs-keyword">if</span> (preset === <span class="hljs-string">'last-month'</span>) {
      start = <span class="hljs-built_in">Date</span>.today().add({
        months: -<span class="hljs-number">1</span>
      }).set({
        day: <span class="hljs-number">1</span>
      });
      end = <span class="hljs-built_in">Date</span>.today().add({
        months: -<span class="hljs-number">1</span>
      }).moveToLastDayOfMonth();
    }
    <span class="hljs-keyword">if</span> (preset === <span class="hljs-string">'last-week'</span>) {
      start = <span class="hljs-built_in">Date</span>.today().moveToDayOfWeek(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>).add({
        days: -<span class="hljs-number">1</span>
      }).moveToDayOfWeek(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);
      end = <span class="hljs-built_in">Date</span>.today().moveToDayOfWeek(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>).add({
        days: -<span class="hljs-number">1</span>
      }).moveToDayOfWeek(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>).add({
        days: <span class="hljs-number">6</span>
      });
    }

    $start.val(start.toString(<span class="hljs-string">'yyyy-MM-dd'</span>));
    $end.val(end.toString(<span class="hljs-string">'yyyy-MM-dd'</span>));

    <span class="hljs-keyword">this</span>.calculateAdjustedDates();
    <span class="hljs-keyword">this</span>.validateForm();

    <span class="hljs-keyword">var</span> $dropdown = $(<span class="hljs-string">'#preset-dates'</span>, <span class="hljs-keyword">this</span>.optionsSelector);
    <span class="hljs-keyword">if</span> ($dropdown.hasClass(<span class="hljs-string">'open'</span>)) {
      $(<span class="hljs-string">'a[data-dropdown="'</span> + $dropdown.attr(<span class="hljs-string">'id'</span>) + <span class="hljs-string">'"]'</span>).trigger(<span class="hljs-string">'click'</span>);
    }
  },

  toggleTrendingOptions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">if</span>(e &amp;&amp; e.preventDefault){
      e.preventDefault();
    }
    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#trendingOptions'</span>).hasClass(<span class="hljs-string">'open'</span>)) {
      $(<span class="hljs-string">'#trendingOptions'</span>).removeClass(<span class="hljs-string">'open'</span>);
      setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        $(<span class="hljs-string">'#trendingOptions'</span>).css(<span class="hljs-string">'visibility'</span>, <span class="hljs-string">'hidden'</span>);
      }, <span class="hljs-number">250</span>);
    } <span class="hljs-keyword">else</span> {
      $(<span class="hljs-string">'#trendingOptions'</span>).css(<span class="hljs-string">'visibility'</span>, <span class="hljs-string">'visible'</span>).addClass(<span class="hljs-string">'open'</span>);
    }
  }
});


<span class="hljs-keyword">var</span> ForecastView = Backbone.View.extend({

    el: $(<span class="hljs-string">'#container'</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>template: hbs.handlebars.compile($(‘#forecast-equalizer-template’)),</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    events: {
      <span class="hljs-string">'click .solve'</span>: <span class="hljs-string">'solveHandler'</span>,
      <span class="hljs-string">'change .forecast'</span>: <span class="hljs-string">'forecastChangeHandler'</span>,
      <span class="hljs-string">'keyup .forecast'</span> : <span class="hljs-string">'forecastKeyUpHandler'</span>,
      <span class="hljs-string">'keydown .forecast'</span>: <span class="hljs-string">'forecastKeyDownHandler'</span>,
      <span class="hljs-string">'click .btn-scenario'</span>: <span class="hljs-string">'scenarioBtnHandler'</span>,
      <span class="hljs-string">'slide .forecast-slider'</span>: <span class="hljs-string">'forecastSlideHandler'</span>,
      <span class="hljs-string">'slidechange .forecast-slider'</span>: <span class="hljs-string">'forecastSlideChangeHandler'</span>,
      <span class="hljs-string">'click .btn-reset-scenario'</span>: <span class="hljs-string">'resetScenarioHandler'</span>,
      <span class="hljs-string">'click .btn-save-scenario'</span> : <span class="hljs-string">'saveScenarioHandler'</span>,
      <span class="hljs-string">'click .btn-rename-scenario'</span>: <span class="hljs-string">'renameScenarioHandler'</span>,
      <span class="hljs-string">'click .btn-copy-scenario'</span> : <span class="hljs-string">'copyScenarioHandler'</span>,
      <span class="hljs-string">'click .btn-scenario .icon-remove-sign'</span>: <span class="hljs-string">'removeScenarioHandler'</span>
    },

    initialize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> </span>{
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Forecast options'</span>, options);
      <span class="hljs-keyword">this</span>.parent = options.parent;
      _.bindAll(<span class="hljs-keyword">this</span>, <span class="hljs-string">'render'</span>);
      <span class="hljs-keyword">this</span>.render();
    },

    render: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'forecast ready'</span>);

    },

    removeScenarioHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
      e.stopPropagation();

      <span class="hljs-keyword">var</span> $scenarioTab = $(e.currentTarget).closest(<span class="hljs-string">'button'</span>);
      <span class="hljs-keyword">if</span> ($scenarioTab.hasClass(<span class="hljs-string">'active'</span>)) {
        <span class="hljs-keyword">var</span> $scenarioContent = $($scenarioTab.data(<span class="hljs-string">'section'</span>));
        <span class="hljs-keyword">var</span> $scenarioToolbar = $(e.currentTarget).closest(<span class="hljs-string">'.btn-toolbar'</span>);

        <span class="hljs-keyword">var</span> $scenarioContainer = $(e.currentTarget).closest(<span class="hljs-string">'.scenarioContainer'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>remove</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        self.deleteScenario($scenarioContainer, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
          <span class="hljs-keyword">if</span> (response.success) {
            $scenarioTab.remove();
            $scenarioContent.remove();</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>default action displays the baseline when a scenario is removed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $scenarioToolbar.find(<span class="hljs-string">"button[data-section='#forecast-scenario-baseline']"</span>).click();
            toast.notifySuccess(<span class="hljs-string">'Success'</span>, <span class="hljs-string">'Scenario removed successfully.'</span>);
          } <span class="hljs-keyword">else</span> {
            toast.notifyError(<span class="hljs-string">'Error'</span>, <span class="hljs-string">'Unable to remove scenario.'</span>);
          }
        });
      }
    },

    copyScenarioHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>create the new tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> $scenarioContainer = $(e.currentTarget).closest(<span class="hljs-string">'.scenarioContainer'</span>);
      <span class="hljs-keyword">var</span> tabId = $scenarioContainer.find(<span class="hljs-string">'.btn-group.scenario button:last'</span>).data(<span class="hljs-string">'section'</span>);
      <span class="hljs-keyword">if</span> (tabId == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">this</span>.parent.tabCount = <span class="hljs-number">0</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.parent.tabCount = <span class="hljs-built_in">parseInt</span>(tabId.replace(<span class="hljs-string">'#forecast-scenario-tab'</span>, <span class="hljs-string">''</span>));
        <span class="hljs-keyword">this</span>.parent.tabCount++;
      }

      <span class="hljs-keyword">var</span> tabName = $scenarioContainer.find(<span class="hljs-string">'.btn-scenario.active span.name'</span>).text();
      <span class="hljs-keyword">var</span> newTabName = <span class="hljs-string">'New Scenario '</span> + (<span class="hljs-keyword">this</span>.parent.tabCount + <span class="hljs-number">1</span>);
      <span class="hljs-keyword">var</span> $scenarioTab = $(<span class="hljs-string">'&lt;button class="btn btn-scenario" data-section="#forecast-scenario-tab'</span> + <span class="hljs-keyword">this</span>.parent.tabCount + <span class="hljs-string">'"&gt;&lt;i class="status"&gt;&lt;/i&gt;&amp;nbsp;&lt;span class="name"&gt;'</span> + newTabName + <span class="hljs-string">'&lt;/span&gt; &amp;nbsp;&amp;nbsp; &lt;i class="icon-remove-sign"&gt;&lt;/i&gt;&lt;/button&gt;'</span>);
      $scenarioContainer.find(<span class="hljs-string">'.btn-group.scenario'</span>).append($scenarioTab);</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>deep copy the content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> $existingScenario = $scenarioContainer.find(<span class="hljs-string">'.tab-pane.active.scenario'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>cloning event handlers does not work successfully so clone without events and data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> $newScenario = $scenarioContainer.find(<span class="hljs-string">'.tab-pane.active.scenario'</span>).clone();
      $existingScenario.removeClass(<span class="hljs-string">'active'</span>);
      $newScenario.attr(<span class="hljs-string">'id'</span>, <span class="hljs-string">'forecast-scenario-tab'</span> + <span class="hljs-keyword">this</span>.parent.tabCount);
      $newScenario.removeClass(<span class="hljs-string">'baseline'</span>);
      $newScenario.addClass(<span class="hljs-string">'user'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>remove existing slider range element, it will be recreated when initializing the slider</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $newScenario.find(<span class="hljs-string">'.forecast-slider div.ui-slider-range'</span>).remove();
      $scenarioContainer.find(<span class="hljs-string">'#scenario-content'</span>).append($newScenario);</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>restore properties and data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> $insertedScenario = $scenarioContainer.find(<span class="hljs-string">'.tab-pane.active.scenario'</span>);
      <span class="hljs-keyword">var</span> $slider = $insertedScenario.find(<span class="hljs-string">'.forecast-slider'</span>);
      <span class="hljs-keyword">var</span> $forecast = $insertedScenario.find(<span class="hljs-string">'.forecast'</span>);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; $newScenario.find(<span class="hljs-string">'.forecast-slider'</span>).length; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>initialize slider</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> minValue = $($existingScenario.find(<span class="hljs-string">'.forecast-slider'</span>)[i]).slider(<span class="hljs-string">'option'</span>, <span class="hljs-string">'min'</span>);
        <span class="hljs-keyword">var</span> paramValue = $($existingScenario.find(<span class="hljs-string">'.forecast-slider'</span>)[i]).slider(<span class="hljs-string">'option'</span>, <span class="hljs-string">'value'</span>);
        <span class="hljs-keyword">var</span> maxValue = $($existingScenario.find(<span class="hljs-string">'.forecast-slider'</span>)[i]).slider(<span class="hljs-string">'option'</span>, <span class="hljs-string">'max'</span>);
        <span class="hljs-keyword">var</span> step = $($existingScenario.find(<span class="hljs-string">'.forecast-slider'</span>)[i]).slider(<span class="hljs-string">'option'</span>, <span class="hljs-string">'step'</span>);
        <span class="hljs-keyword">var</span> disabled = $($existingScenario.find(<span class="hljs-string">'.forecast-slider'</span>)[i]).slider(<span class="hljs-string">'option'</span>, <span class="hljs-string">'disabled'</span>);
        $($slider[i]).slider({
          <span class="hljs-string">"orientation"</span>: <span class="hljs-string">"horizontal"</span>,
          <span class="hljs-string">"range"</span>: <span class="hljs-string">"min"</span>,
          <span class="hljs-string">"min"</span>: minValue,
          <span class="hljs-string">"max"</span>: maxValue,
          <span class="hljs-string">"value"</span>: paramValue,
          <span class="hljs-string">"disabled"</span>: disabled,
          <span class="hljs-string">"step"</span>: step
        });
        <span class="hljs-keyword">var</span> color = $($existingScenario.find(<span class="hljs-string">'.forecast-slider'</span>)[i]).find(<span class="hljs-string">"div.ui-slider-range"</span>).css(<span class="hljs-string">"background-color"</span>);
        $($slider[i]).find(<span class="hljs-string">"div.ui-slider-range"</span>).css(<span class="hljs-string">"background-color"</span>, color);</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>initialize forecast input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">var</span> intercept = $($existingScenario.find(<span class="hljs-string">'.forecast'</span>)[i]).data(<span class="hljs-string">'intercept'</span>);
          <span class="hljs-keyword">var</span> residualStandardError = $($existingScenario.find(<span class="hljs-string">'.forecast'</span>)[i]).data(<span class="hljs-string">'residualstandarderror'</span>);
          <span class="hljs-keyword">var</span> degreesOfFreedom = $($existingScenario.find(<span class="hljs-string">'.forecast'</span>)[i]).data(<span class="hljs-string">'degreesoffreedom'</span>);
          <span class="hljs-keyword">var</span> baselineMatrix = $($existingScenario.find(<span class="hljs-string">'.forecast'</span>)[i]).data(<span class="hljs-string">'baselinematrix'</span>);
          $($forecast[i]).data(<span class="hljs-string">'intercept'</span>, intercept);
          $($forecast[i]).data(<span class="hljs-string">'residualstandarderror'</span>, residualStandardError);
          $($forecast[i]).data(<span class="hljs-string">'degreesoffreedom'</span>, degreesOfFreedom);
          $($forecast[i]).data(<span class="hljs-string">'baselinematrix'</span>, baselineMatrix);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">var</span> coefficient = $($existingScenario.find(<span class="hljs-string">'.forecast'</span>)[i]).data(<span class="hljs-string">'coefficient'</span>);
          $($forecast[i]).data(<span class="hljs-string">'coefficient'</span>, coefficient);
        }
        <span class="hljs-keyword">var</span> resetValue = $($existingScenario.find(<span class="hljs-string">'.forecast'</span>)[i]).data(<span class="hljs-string">'resetvalue'</span>);
        $($forecast[i]).data(<span class="hljs-string">'resetvalue'</span>, resetValue);
      }

      $insertedScenario.find(<span class="hljs-string">'[data-toggle=tooltip]'</span>).tooltip({
        container: <span class="hljs-string">'body'</span>
      });
      <span class="hljs-comment">/*$insertedScenario.find(".test-data").tablesorter({
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>sort by rank - third column, order asc</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>       sortList: [[2,0]],
       headers: {
       4: {sorter: false},
       5: {sorter: false},
       6: {sorter: false}
       }
       });*/</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Initialize scenario table manipulation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> sort = [];
      $existingScenario.find(<span class="hljs-string">'table.test-data th'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index)</span> </span>{
        <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).hasClass(<span class="hljs-string">'sorting_asc'</span>)) {
          sort.push([index, <span class="hljs-string">'asc'</span>]);
        }
        <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).hasClass(<span class="hljs-string">'sorting_desc'</span>)) {
          sort.push([index, <span class="hljs-string">'desc'</span>]);
        }
      });
      $insertedScenario.find(<span class="hljs-string">'.table.test-data'</span>).dataTable({
        <span class="hljs-string">"bPaginate"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">"bLengthChange"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">"bFilter"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">"bSort"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">"bInfo"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">"bAutoWidth"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">"aaSorting"</span>: sort, <span class="hljs-comment">//[[ 2, "asc" ]],</span>
        <span class="hljs-string">"aoColumns"</span>: [
          <span class="hljs-comment">/* Test Data */</span> <span class="hljs-literal">null</span>,
          <span class="hljs-comment">/* Time Shift */</span> <span class="hljs-literal">null</span>,
          <span class="hljs-comment">/* Forecast Date */</span> <span class="hljs-literal">null</span>,
          <span class="hljs-comment">/* Confidence Interval */</span> <span class="hljs-literal">null</span>,
          <span class="hljs-comment">/* Slider */</span> {
            <span class="hljs-string">"bSearchable"</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">"bSortable"</span>: <span class="hljs-literal">false</span>
          },
          <span class="hljs-comment">/* Forecast */</span> {
            <span class="hljs-string">"bSearchable"</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">"bSortable"</span>: <span class="hljs-literal">false</span>
          }
        ]
      });

      $scenarioContainer.find(<span class="hljs-string">"button[data-section='#forecast-scenario-tab"</span> + <span class="hljs-keyword">this</span>.parent.tabCount + <span class="hljs-string">"']"</span>).click();

      <span class="hljs-keyword">var</span> $scenarioTab = $scenarioContainer.find(<span class="hljs-string">'.btn-scenario'</span>);
      <span class="hljs-keyword">var</span> scenarioNames = $scenarioTab.find(<span class="hljs-string">'span.name'</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> $(<span class="hljs-keyword">this</span>).text();
      }).get();
      scenarioNames.pop();

      <span class="hljs-keyword">if</span> (_.contains(scenarioNames, newTabName)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>todo: the initial create is needy…cannot revert back to existing name because it exists…hmmmm</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $scenarioContainer.find(<span class="hljs-string">'.btn-rename-scenario'</span>).click();
      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>create new</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.createScenario($scenarioContainer, newTabName, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
          <span class="hljs-keyword">if</span> (response.created) {
            toast.notifySuccess(<span class="hljs-string">'Success'</span>, <span class="hljs-string">'Scenario created successfully.'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>place id on scenario tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="hljs-string">'.btn-scenario.active'</span>).append(<span class="hljs-string">'&lt;input id="forecastId" type="hidden" value="'</span>+response.id+<span class="hljs-string">'"&gt;'</span>);
          } <span class="hljs-keyword">else</span> {
            toast.notifyError(<span class="hljs-string">'Error'</span>, <span class="hljs-string">'Unable to save new scenario.'</span>);
          }
        });
      }
    },

    renameScenarioHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">var</span> $scenarioContainer = $(e.currentTarget).closest(<span class="hljs-string">'.scenarioContainer'</span>);
      <span class="hljs-keyword">var</span> $currentTab = $scenarioContainer.find(<span class="hljs-string">'.btn-scenario.active'</span>);
      <span class="hljs-keyword">var</span> currentTabName = $currentTab.find(<span class="hljs-string">'span.name'</span>).text();
      <span class="hljs-keyword">var</span> $scenarioTab = $scenarioContainer.find(<span class="hljs-string">'.btn-scenario'</span>);
      <span class="hljs-keyword">var</span> scenarioNames = $scenarioTab.find(<span class="hljs-string">'span.name'</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> $(e.currentTarget).text();
      }).get();

      bootbox.prompt(<span class="hljs-string">'Rename Scenario'</span>, <span class="hljs-string">'Cancel'</span>, <span class="hljs-string">'Ok'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tabName)</span> </span>{
        <span class="hljs-keyword">if</span> (_.contains(scenarioNames, tabName)) {
          toastr.error(<span class="hljs-string">"Scenario Name Already Exists"</span>, <span class="hljs-string">'&lt;i class="icon-ban-circle"&gt;&lt;/i&gt; &lt;span&gt;'</span> + <span class="hljs-string">"Error"</span> + <span class="hljs-string">'&lt;/span&gt;'</span>);
          <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (tabName === <span class="hljs-literal">null</span>) {
          tabName = currentTabName;
        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>update (rename)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.updateScenarios($scenarioContainer, tabName, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
            <span class="hljs-keyword">if</span> (response.success) {
              $currentTab.find(<span class="hljs-string">'span.name'</span>).text(tabName);</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>$scenarioContainer.find(‘.btn.btn-scenario.active i.status’).addClass(‘icon-asterisk unsaved-indicator’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              toast.notifySuccess(<span class="hljs-string">'Success'</span>, <span class="hljs-string">'Scenario renamed successfully.'</span>);
            } <span class="hljs-keyword">else</span> {
              toast.notifyError(<span class="hljs-string">'Error'</span>, <span class="hljs-string">'Unable to rename scenario.'</span>);
            }
          });
        }
      }, currentTabName);
    },

    saveScenarioHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e, behavior)</span> </span>{
      <span class="hljs-keyword">var</span> $scenarioContainer = $(e.currentTarget).closest(<span class="hljs-string">'.scenarioContainer'</span>);
      <span class="hljs-keyword">var</span> $scenario = $(e.currentTarget).closest(<span class="hljs-string">'#scenario-content'</span>).find(<span class="hljs-string">'.active.scenario'</span>);
      <span class="hljs-keyword">var</span> $currentTab = $scenarioContainer.find(<span class="hljs-string">'.btn-scenario.active'</span>);
      <span class="hljs-keyword">var</span> currentTabName = $currentTab.find(<span class="hljs-string">'span.name'</span>).text();</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.updateScenarios($scenarioContainer, currentTabName, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
        <span class="hljs-keyword">if</span> (response.success) {</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>update resetvalue attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          $scenario.find(<span class="hljs-string">".solve"</span>).data(<span class="hljs-string">'resetvalue'</span>, <span class="hljs-string">''</span>).attr(<span class="hljs-string">'data-resetvalue'</span>, <span class="hljs-string">''</span>);
          $scenario.find(<span class="hljs-string">".solving"</span>).data(<span class="hljs-string">'resetvalue'</span>, <span class="hljs-string">'true'</span>).attr(<span class="hljs-string">'data-resetvalue'</span>, <span class="hljs-string">'true'</span>);
          <span class="hljs-keyword">var</span> elemForecast = $scenario.find(<span class="hljs-string">'.forecast'</span>);
          <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; elemForecast.length; i++) {
            $(elemForecast[i]).data(<span class="hljs-string">'resetvalue'</span>, $(elemForecast[i]).val());
          }
          toast.notifySuccess(<span class="hljs-string">'Success'</span>, <span class="hljs-string">'Scenario saved successfully.'</span>);
          $scenarioContainer.find(<span class="hljs-string">'.btn.btn-scenario.active i.status'</span>).removeClass(<span class="hljs-string">'icon-asterisk unsaved-indicator'</span>);
          <span class="hljs-keyword">this</span>.updateStatus($scenarioContainer);
        } <span class="hljs-keyword">else</span> {
          toast.notifyError(<span class="hljs-string">'Error'</span>, <span class="hljs-string">'Unable to save scenario.'</span>);
        }
      });
    },

    resetScenarioHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
      <span class="hljs-keyword">var</span> $scenario = $(e.currentTarget).closest(<span class="hljs-string">'#scenario-content'</span>).find(<span class="hljs-string">'.active.scenario'</span>);
      $scenario.find(<span class="hljs-string">".solve[data-resetvalue='true']"</span>).click();
      <span class="hljs-keyword">var</span> elemForecast = $scenario.find(<span class="hljs-string">'.forecast'</span>);
      <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; elemForecast.length; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>reset the slider and input field value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(elemForecast[i]).val($(elemForecast[i]).data(<span class="hljs-string">'resetvalue'</span>));
        $(elemForecast[i]).change();
      }

      <span class="hljs-keyword">var</span> $scenarioContainer = $(e.currentTarget).closest(<span class="hljs-string">'.scenarioContainer'</span>);
      $scenarioContainer.find(<span class="hljs-string">'.btn.btn-scenario.active i.status'</span>).removeClass(<span class="hljs-string">'icon-asterisk unsaved-indicator'</span>);
      <span class="hljs-keyword">this</span>.updateStatus($scenarioContainer);
    },

    forecastSlideChangeHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e, ui)</span> </span>{
      <span class="hljs-keyword">var</span> $scenario = $(e.currentTarget).closest(<span class="hljs-string">'#scenario-content .tab-pane.scenario'</span>);
      <span class="hljs-keyword">var</span> $solveRow = $scenario.find(<span class="hljs-string">'.solving'</span>).closest(<span class="hljs-string">'tr'</span>);
      <span class="hljs-keyword">var</span> existingResult = <span class="hljs-built_in">parseFloat</span>($solveRow.find(<span class="hljs-string">'.forecast'</span>).val());</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>todo: use the data object rather than the container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">this</span>.solve($scenario);
      <span class="hljs-keyword">if</span> (result != existingResult) {</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>update with the new solution</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $solveRow.find(<span class="hljs-string">'.forecast'</span>).val(result);
        $solveRow.find(<span class="hljs-string">'.forecast-slider'</span>).slider(<span class="hljs-string">'value'</span>, result);</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>update the ui confidence interval</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> range = $scenario.find(<span class="hljs-string">'.forecast-slider:first'</span>).slider(<span class="hljs-string">'option'</span>, <span class="hljs-string">'max'</span>);
        <span class="hljs-keyword">var</span> min = $scenario.find(<span class="hljs-string">'.forecast-slider:first'</span>).slider(<span class="hljs-string">'option'</span>, <span class="hljs-string">'min'</span>);
        <span class="hljs-keyword">var</span> offset = <span class="hljs-built_in">parseFloat</span>(min + (range - min) / <span class="hljs-number">2</span>);
        range += (range / <span class="hljs-number">3</span>);
        <span class="hljs-keyword">var</span> bound = <span class="hljs-keyword">this</span>.getBounds();
        <span class="hljs-keyword">var</span> interval = bound.upper - bound.lower;

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(interval)) {
          $scenario.find(<span class="hljs-string">'.confidenceWindow'</span>).hide();
        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>get percentage of range represented by the conf window</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">var</span> widthPercentage = <span class="hljs-number">100</span> * (interval) / range;
          <span class="hljs-keyword">var</span> dependent = <span class="hljs-keyword">this</span>.getDependent();
          <span class="hljs-keyword">var</span> leftPercentage = <span class="hljs-number">100</span> * (dependent + offset) / range - .<span class="hljs-number">5</span> * widthPercentage;

          <span class="hljs-keyword">var</span> places = <span class="hljs-number">0</span>;
          <span class="hljs-keyword">if</span> ((result % <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>) {
            places = result.toString().split(<span class="hljs-string">"."</span>)[<span class="hljs-number">1</span>].length + <span class="hljs-number">1</span>;
          }

          $scenario.find(<span class="hljs-string">'.confidenceWindow'</span>).css(<span class="hljs-string">'width'</span>, widthPercentage + <span class="hljs-string">'%'</span>)
            .css(<span class="hljs-string">'left'</span>, leftPercentage + <span class="hljs-string">'%'</span>)
            .attr(<span class="hljs-string">'data-original-title'</span>, bound.lower.toFixed(places) + <span class="hljs-string">' ... [\u00b1'</span> + (interval / <span class="hljs-number">2</span>).toFixed(places) + <span class="hljs-string">'] ... '</span> + bound.upper.toFixed(places))
            .show();
        }
        <span class="hljs-keyword">var</span> $scenarioContainer = $(e.currentTarget).closest(<span class="hljs-string">'.scenarioContainer'</span>);
        $scenarioContainer.find(<span class="hljs-string">'.btn.btn-scenario.active i.status'</span>).addClass(<span class="hljs-string">'icon-asterisk unsaved-indicator'</span>);
        <span class="hljs-keyword">this</span>.updateStatus($scenarioContainer);
      }
    },

    forecastSlideHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e, ui)</span> </span>{
      $(e.currentTarget).closest(<span class="hljs-string">'tr'</span>).find(<span class="hljs-string">'.forecast'</span>).val(ui.value);
    },

    scenarioBtnHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
      <span class="hljs-keyword">var</span> thisName = $(e.currentTarget).data(<span class="hljs-string">'section'</span>);
      <span class="hljs-keyword">var</span> $scenarioContainer = $(e.currentTarget).closest(<span class="hljs-string">'.scenarioContainer'</span>);
      $scenarioContainer.find(<span class="hljs-string">'#scenario-content .scenario'</span>)
        .removeClass(<span class="hljs-string">'active'</span>)
        .hide();
      $scenarioContainer.find(<span class="hljs-string">'#scenario-content '</span> + thisName)
        .addClass(<span class="hljs-string">'active'</span>)
        .show();
      $scenarioContainer.find(<span class="hljs-string">'.btn-scenario'</span>).removeClass(<span class="hljs-string">'active'</span>);
      $scenarioContainer.find(<span class="hljs-string">'.btn-scenario[data-section="'</span> + thisName + <span class="hljs-string">'"]'</span>).addClass(<span class="hljs-string">'active'</span>);
      <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).closest(<span class="hljs-string">'.baseline'</span>).length &gt; <span class="hljs-number">0</span>) {
        $scenarioContainer.find(<span class="hljs-string">'#scenario-content .btn-save-scenario'</span>).hide()
        $scenarioContainer.find(<span class="hljs-string">'#scenario-content .btn-rename-scenario'</span>).hide()
      } <span class="hljs-keyword">else</span> {
        $scenarioContainer.find(<span class="hljs-string">'#scenario-content .btn-save-scenario'</span>).show()
        $scenarioContainer.find(<span class="hljs-string">'#scenario-content .btn-rename-scenario'</span>).show()
      }
    },

    forecastKeyDownHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
      <span class="hljs-keyword">if</span> ($.inArray(e.keyCode, [<span class="hljs-number">46</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">27</span>, <span class="hljs-number">13</span>, <span class="hljs-number">190</span>]) !== -<span class="hljs-number">1</span> ||</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Allow: Ctrl+A</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        (e.keyCode == <span class="hljs-number">65</span> &amp;&amp; e.ctrlKey === <span class="hljs-literal">true</span>) ||</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Allow: home, end, left, right</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        (e.keyCode &gt;= <span class="hljs-number">35</span> &amp;&amp; e.keyCode &lt;= <span class="hljs-number">39</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>let it happen, don’t do anything</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span>;
      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Ensure that it is a number and stop the keypress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (e.shiftKey || (e.keyCode &lt; <span class="hljs-number">48</span> || e.keyCode &gt; <span class="hljs-number">57</span>) &amp;&amp; (e.keyCode &lt; <span class="hljs-number">96</span> || e.keyCode &gt; <span class="hljs-number">105</span>)) {
          e.preventDefault();
        }
      }
    },

    forecastKeyUpHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
      $(e.currentTarget).change();
    },

    forecastChangeHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
      $(e.currentTarget).closest(<span class="hljs-string">'tr'</span>).find(<span class="hljs-string">'.forecast-slider'</span>).slider(<span class="hljs-string">"value"</span>, $(e.currentTarget).prop(<span class="hljs-string">'value'</span>));
    },

    solveHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
      <span class="hljs-keyword">var</span> $scenario = $(e.currentTarget).closest(<span class="hljs-string">'.scenario'</span>);
      $scenario.find(<span class="hljs-string">'tr'</span>).removeClass(<span class="hljs-string">'warning'</span>);
      $scenario.find(<span class="hljs-string">'.solve'</span>).removeClass(<span class="hljs-string">'icon-star'</span>)
        .removeClass(<span class="hljs-string">'solving'</span>)
        .addClass(<span class="hljs-string">'icon-star-empty'</span>)
        .attr(<span class="hljs-string">'data-original-title'</span>, <span class="hljs-string">'Click to solve for this test value'</span>);
      $scenario.find(<span class="hljs-string">'.solve.dependent'</span>).attr(<span class="hljs-string">'data-original-title'</span>, <span class="hljs-string">'Click to solve for the reference value'</span>);
      $scenario.find(<span class="hljs-string">'.forecast'</span>).prop(<span class="hljs-string">"disabled"</span>, <span class="hljs-literal">false</span>);
      $scenario.find(<span class="hljs-string">'.forecast-slider'</span>).slider(<span class="hljs-string">"enable"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>modify this member</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> $row = $(e.currentTarget).closest(<span class="hljs-string">'tr'</span>);
      $row.addClass(<span class="hljs-string">'warning'</span>);
      $row.find(<span class="hljs-string">'.forecast-slider'</span>).slider(<span class="hljs-string">"disable"</span>);
      $row.find(<span class="hljs-string">'.forecast'</span>).prop(<span class="hljs-string">"disabled"</span>, <span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>$(this).closest(‘tr’).find(‘.forecast-slider’).slider(“disable”);
$(this).closest(‘tr’).find(‘.forecast’).prop(“disabled”, true);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(e.currentTarget).removeClass(<span class="hljs-string">'icon-star-empty'</span>);
      $(e.currentTarget).addClass(<span class="hljs-string">'icon-star'</span>);
      $(e.currentTarget).addClass(<span class="hljs-string">'solving'</span>);
      <span class="hljs-keyword">if</span> ($(e.currentTarget).hasClass(<span class="hljs-string">'dependent'</span>)) {
        $(e.currentTarget).attr(<span class="hljs-string">'data-original-title'</span>, <span class="hljs-string">'Currently solving for the reference value'</span>);
      } <span class="hljs-keyword">else</span> {
        $(e.currentTarget).attr(<span class="hljs-string">'data-original-title'</span>, <span class="hljs-string">'Currently solving for this test value'</span>);
      }
      <span class="hljs-keyword">var</span> $scenarioContainer = $(e.currentTarget).closest(<span class="hljs-string">'.scenarioContainer'</span>);
      $scenarioContainer.find(<span class="hljs-string">'.btn.btn-scenario.active i.status'</span>).addClass(<span class="hljs-string">'icon-asterisk unsaved-indicator'</span>);
      <span class="hljs-keyword">this</span>.updateStatus($scenarioContainer);
    },

    alphaLevel: <span class="hljs-number">0.025</span>,
    residualStandardError: <span class="hljs-number">0.0</span>,
    intercept: <span class="hljs-number">0.0</span>,
    degreesOfFreedom: <span class="hljs-number">0</span>,
    startMatrix: [],
    startTransposeMatrix: [],
    sscpMatrix: [],
    sscpInverseMatrix: [],
    newMatrix: [],
    newTransposeMatrix: [],
    insideSquareRoot: <span class="hljs-number">0.0</span>,
    meanSquare: <span class="hljs-number">0.0</span>,
    tStatInv: <span class="hljs-number">0.0</span>,
    yPredicted: <span class="hljs-number">0.0</span>,
    upperBound: <span class="hljs-number">0.0</span>,
    lowerBound: <span class="hljs-number">0.0</span>,

    getBounds: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'lower'</span>: <span class="hljs-keyword">this</span>.lowerBound,
        <span class="hljs-string">'upper'</span>: <span class="hljs-keyword">this</span>.upperBound
      };
    },

    getDependent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.yPredicted;
    },

    setBaselineMatrices: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(matrix)</span> </span>{
      <span class="hljs-keyword">if</span> (matrix.length) {
        <span class="hljs-keyword">var</span> baselineMatrix = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; matrix.length; i++) {
          baselineMatrix[i] = matrix[i];
        }
        <span class="hljs-keyword">var</span> intercept = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; matrix[<span class="hljs-number">0</span>].length; i++) {
          intercept.push(<span class="hljs-number">1</span>);
        }
        baselineMatrix.unshift(intercept);
        <span class="hljs-keyword">this</span>.startTransposeMatrix = baselineMatrix;</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>step 5 - Transpose</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.startMatrix = jStat.transpose(<span class="hljs-keyword">this</span>.startTransposeMatrix);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
    },

    insertIntercept: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(matrix)</span> </span>{
      <span class="hljs-keyword">var</span> intercept = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; matrix.length; i++) {
        matrix[i].unshift(<span class="hljs-number">1</span>);
      }
    },

    setConfidenceInterval: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>purpose: Step through process to compute confidence interval</p>

            </div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>step 6 - Sum of Squares and Cross Products (SSCP)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.sscpMatrix = jStat.multiply(<span class="hljs-keyword">this</span>.startTransposeMatrix, <span class="hljs-keyword">this</span>.startMatrix);</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>step 7 - Inverse of the SSCP Matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.sscpInverseMatrix = jStat.inv(<span class="hljs-keyword">this</span>.sscpMatrix);</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>step 8a - Create matrix of new variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.newTransposeMatrix = jStat.transpose(<span class="hljs-keyword">this</span>.newMatrix);</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>step 8b - Calculate inside square root</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> insideStepA = jStat.multiply(<span class="hljs-keyword">this</span>.sscpInverseMatrix, <span class="hljs-keyword">this</span>.newTransposeMatrix);
      <span class="hljs-keyword">var</span> insideStepATranspose = jStat.transpose(insideStepA);
      <span class="hljs-keyword">this</span>.insideSquareRoot = jStat.dot(insideStepATranspose, <span class="hljs-keyword">this</span>.newMatrix);</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>step 9 - Calculate Mean Square Error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.meanSquareError = <span class="hljs-keyword">this</span>.residualStandardError * <span class="hljs-keyword">this</span>.residualStandardError;</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>step 10 - Calculate value inside square root</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.insideSquareRootValue = <span class="hljs-built_in">Math</span>.sqrt(<span class="hljs-keyword">this</span>.meanSquareError * <span class="hljs-keyword">this</span>.insideSquareRoot);</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>step 11 - Calculate t-statistic</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.tStatInv = jStat.studentt.inv(<span class="hljs-keyword">this</span>.alphaLevel, <span class="hljs-keyword">this</span>.degreesOfFreedom);</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>step 12 - Calculate Prediction Value
yPredicted = 0; // should be previously solved
step 13 - Calculate lower bound</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> plusMinus = <span class="hljs-keyword">this</span>.tStatInv * <span class="hljs-keyword">this</span>.insideSquareRootValue;
      <span class="hljs-keyword">this</span>.lowerBound = <span class="hljs-keyword">this</span>.yPredicted - plusMinus;</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>step 14 - Calculate upper bound</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.upperBound = <span class="hljs-keyword">this</span>.yPredicted + plusMinus;
    },

    solve: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scenario)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>accepts a jQuery object
creates a linear equation by iterating through forecast values
returns a value representing the solved linear equation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> dependent = <span class="hljs-number">0.0</span>;
      <span class="hljs-keyword">var</span> coefficient = [];
      <span class="hljs-keyword">var</span> independents = <span class="hljs-number">0.0</span>;
      <span class="hljs-keyword">var</span> error = <span class="hljs-number">0.0</span>;
      <span class="hljs-keyword">var</span> forecast = $scenario.find(<span class="hljs-string">'.forecast'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>var intercept = 0.0;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      <span class="hljs-keyword">var</span> result = <span class="hljs-number">0.0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>TODO: use better data package than ui elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.setBaselineMatrices($(forecast[<span class="hljs-number">0</span>]).data(<span class="hljs-string">'baselinematrix'</span>))) {

        <span class="hljs-keyword">this</span>.intercept = $(forecast[<span class="hljs-number">0</span>]).data(<span class="hljs-string">'intercept'</span>);
        <span class="hljs-keyword">this</span>.residualStandardError = $(forecast[<span class="hljs-number">0</span>]).data(<span class="hljs-string">'residualstandarderror'</span>);
        <span class="hljs-keyword">this</span>.degreesOfFreedom = $(forecast[<span class="hljs-number">0</span>]).data(<span class="hljs-string">'degreesoffreedom'</span>);


        <span class="hljs-keyword">var</span> independent = [<span class="hljs-number">1</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; forecast.length; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>independent.push(parseFloat($(forecast[i]).val()));</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          independent.push(<span class="hljs-built_in">parseFloat</span>($scenario.find(<span class="hljs-string">'#forecast-'</span> + i).val()));
        }
        <span class="hljs-keyword">this</span>.newMatrix = independent;</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>TODO: Could jstat linear algebra library solve this more generically?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">var</span> independent = [];
        <span class="hljs-keyword">if</span> ($scenario.find(<span class="hljs-string">'#solve-0'</span>).hasClass(<span class="hljs-string">'solving'</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>solve for the dependent variable (reference data set)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; forecast.length; i++) {
            coefficient[i - <span class="hljs-number">1</span>] = $(forecast[i]).data(<span class="hljs-string">'coefficient'</span>);
            independent[i - <span class="hljs-number">1</span>] = <span class="hljs-built_in">parseFloat</span>($(forecast[i]).val());
            independents += coefficient[i - <span class="hljs-number">1</span>] * independent[i - <span class="hljs-number">1</span>];
          }
          result = <span class="hljs-keyword">this</span>.yPredicted = <span class="hljs-keyword">this</span>.intercept + independents + error;
        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>solve for an independent variable (test data sets)
TODO: use the high precision value rather than the integer display value as default.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          dependent = <span class="hljs-keyword">this</span>.yPredicted = <span class="hljs-built_in">parseFloat</span>($(forecast[<span class="hljs-number">0</span>]).val());
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">1</span>; k &lt; forecast.length; k++) {
            <span class="hljs-keyword">if</span> ($scenario.find(<span class="hljs-string">'#solve-'</span> + k).hasClass(<span class="hljs-string">'solving'</span>)) {
              <span class="hljs-keyword">var</span> coefDivisor = $(forecast[k]).data(<span class="hljs-string">'coefficient'</span>);
            } <span class="hljs-keyword">else</span> {
              independents += $(forecast[k]).data(<span class="hljs-string">'coefficient'</span>) * $(forecast[k]).val();
            }
          }
          result = (dependent - error - <span class="hljs-keyword">this</span>.intercept - independents) / coefDivisor;
        }

        <span class="hljs-keyword">var</span> places = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.setConfidenceInterval();
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.abs(result) &lt; <span class="hljs-number">1</span>) {
          places = <span class="hljs-number">2</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.abs(result) &lt; <span class="hljs-number">10</span>) {
            places = <span class="hljs-number">1</span>;
          }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.round(result * <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, places)) / <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, places);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
      }
    },

    getScenarioState: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scenarioContainer, action)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>return all current data of the active scenario as well as all the reset value data of all other scenarios
action is optional and can be ‘rename’ or ‘remove’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      <span class="hljs-keyword">var</span> $scenarioTab = $($scenarioContainer).find(<span class="hljs-string">'.scenario-buttons.scenario'</span>);
      <span class="hljs-keyword">var</span> scenarioNames = $scenarioTab.find(<span class="hljs-string">'span.name'</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (action == <span class="hljs-string">'remove'</span> &amp;&amp; $(<span class="hljs-keyword">this</span>).closest(<span class="hljs-string">'button'</span>).hasClass(<span class="hljs-string">'active'</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>ignore to remove it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> {
            title: $(<span class="hljs-keyword">this</span>).text()
          };
        }
      }).get();
      <span class="hljs-keyword">var</span> data_scenario = {};
      data_scenario.titles = scenarioNames;
      data_scenario.factors = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>todo: save the table sort order for each scenario
scrape each scenario interface to get current values of the active scenario and reset values of other scenarios</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $factorRows = $scenarioContainer.find(<span class="hljs-string">'.tab-pane.scenario.baseline .factorRow'</span>);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> factorIndex = <span class="hljs-number">0</span>; factorIndex &lt; $factorRows.length; factorIndex++) {
        <span class="hljs-keyword">var</span> thisFactor = {};
        thisFactor.state = [];

        $scenarioContainer.find(<span class="hljs-string">'.tab-pane.scenario.user #factorRow-'</span> + factorIndex).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(scenarioIndex)</span> </span>{
          <span class="hljs-keyword">var</span> scenarioPane = $(<span class="hljs-keyword">this</span>).closest(<span class="hljs-string">'.tab-pane.scenario.user'</span>);
          <span class="hljs-keyword">if</span> (action == <span class="hljs-string">'remove'</span> &amp;&amp; $(scenarioPane).hasClass(<span class="hljs-string">'active'</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>skip this one to delete it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> thisState = {};
            thisState.datasetId = $(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">'.forecast'</span>).data(<span class="hljs-string">'stream-id'</span>);
            <span class="hljs-keyword">if</span> (action == <span class="hljs-string">''</span> &amp;&amp; $(scenarioPane).hasClass(<span class="hljs-string">'active'</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>this is the one we are saving, use current values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span> (factorIndex == <span class="hljs-number">0</span>) {
                thisState.alpha = $(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">'.alpha'</span>).data(<span class="hljs-string">'resetvalue'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>thisState.alpha = $(this).find(‘.alpha’).val();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              }
              thisState.value = $(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">'.forecast'</span>).val();
              <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">'.solve'</span>).hasClass(<span class="hljs-string">'solving'</span>)) {
                thisState.solveId = <span class="hljs-literal">true</span>;
              }
            } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>use reset values for all other scenarios</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span> (factorIndex == <span class="hljs-number">0</span>) {
                thisState.alpha = $(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">'.alpha'</span>).data(<span class="hljs-string">'resetvalue'</span>);
              }
              thisState.value = $(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">'.forecast'</span>).data(<span class="hljs-string">'resetvalue'</span>);
              <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">'.solve'</span>).data(<span class="hljs-string">'resetvalue'</span>)) {
                thisState.solveId = <span class="hljs-literal">true</span>;
              }
            }
            thisFactor.state.push(thisState);
          }
        });
        <span class="hljs-keyword">if</span> (thisFactor.state.length &gt; <span class="hljs-number">0</span>) {
          data_scenario.factors.push(thisFactor);
        }
      }
      <span class="hljs-keyword">return</span> data_scenario
    },

    updateScenarios: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scenarioContainer, tabName, cb)</span> </span>{

      <span class="hljs-keyword">var</span> data_scenario = <span class="hljs-keyword">this</span>.getScenarioState($scenarioContainer, <span class="hljs-string">''</span>);

      <span class="hljs-keyword">var</span> $currentTab = $scenarioContainer.find(<span class="hljs-string">'.btn-scenario.active'</span>);
      <span class="hljs-keyword">var</span> forecastId = $currentTab.find(<span class="hljs-string">'#forecastId'</span>).val();
      <span class="hljs-keyword">var</span> snapshotId = <span class="hljs-keyword">this</span>.parent.getCurrentTab().find(<span class="hljs-string">'input#worksheetId'</span>).val();

      <span class="hljs-keyword">var</span> data = {
        name: tabName,
        data: <span class="hljs-built_in">JSON</span>.stringify(data_scenario)
      }

      $.ajax({
        url: <span class="hljs-string">'/api/snapshots/'</span>+snapshotId+<span class="hljs-string">'/forecasts/update/'</span>+forecastId,
        data: data,
        method: <span class="hljs-string">'post'</span>,
        dataType: <span class="hljs-string">'json'</span>,
        success: cb
      });

    },

    deleteScenario: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scenarioContainer, cb)</span></span>{
      <span class="hljs-keyword">var</span> $currentTab = $scenarioContainer.find(<span class="hljs-string">'.btn-scenario.active'</span>);
      <span class="hljs-keyword">var</span> forecastId = $currentTab.find(<span class="hljs-string">'#forecastId'</span>).val();

      <span class="hljs-keyword">var</span> snapshotId = <span class="hljs-keyword">this</span>.parent.getCurrentTab().find(<span class="hljs-string">'input#worksheetId'</span>).val();

      $.ajax({
        url: <span class="hljs-string">'/api/snapshots/'</span>+snapshotId+<span class="hljs-string">'/forecasts/delete/'</span>+forecastId,
        method: <span class="hljs-string">'get'</span>,
        dataType: <span class="hljs-string">'json'</span>,
        success: cb
      });

    },

    createScenario: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scenarioContainer, tabName, cb)</span></span>{
      <span class="hljs-keyword">var</span> data_scenario = <span class="hljs-keyword">this</span>.getScenarioState($scenarioContainer, <span class="hljs-string">''</span>);
      <span class="hljs-keyword">var</span> $tab = $(<span class="hljs-string">'.tab-buttons .btn.active'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>make sure $tab has a length of 1
var rawData = JSON.parse($tab.data(‘data_raw’));
rawData.scenario = data_scenario;
var rawDataText = JSON.stringify(rawData);
$tab.data(‘data_raw’, rawDataText);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> data = {
        name: tabName,
        data: <span class="hljs-built_in">JSON</span>.stringify(data_scenario)
      }

      <span class="hljs-keyword">var</span> snapshotId = <span class="hljs-keyword">this</span>.parent.getCurrentTab().find(<span class="hljs-string">'input#worksheetId'</span>).val();

      $.ajax({
        url: <span class="hljs-string">'/api/snapshots/'</span>+snapshotId+<span class="hljs-string">'/forecasts/add'</span>,
        data: data,
        method: <span class="hljs-string">'post'</span>,
        dataType: <span class="hljs-string">'json'</span>,
        success: cb
      });

    },

    updateStatus: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scenarioContainer)</span> </span>{
      <span class="hljs-keyword">var</span> $changedScenario = $scenarioContainer.find(<span class="hljs-string">'.btn-scenario i.icon-asterisk.unsaved-indicator'</span>);
      <span class="hljs-keyword">var</span> sectionName = $scenarioContainer.closest(<span class="hljs-string">'.trending-charts'</span>).find(<span class="hljs-string">'li.active a'</span>).attr(<span class="hljs-string">'href'</span>);

      <span class="hljs-keyword">if</span> ($changedScenario.length &gt; <span class="hljs-number">0</span>) {
        $scenarioContainer.closest(<span class="hljs-string">'.trending-charts'</span>).find(<span class="hljs-string">'li.active a i'</span>).addClass(<span class="hljs-string">'icon-asterisk unsaved-indicator'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>$(‘#analyzeToolbar’).find(‘[data-section=”‘ + sectionName.replace(‘#forecast-chart-‘,’’) + ‘“]’).prepend(‘<i class="icon-asterisk unsaved-indicator"></i>‘);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      } <span class="hljs-keyword">else</span> {
        $scenarioContainer.closest(<span class="hljs-string">'.trending-charts'</span>).find(<span class="hljs-string">'li.active a i'</span>).removeClass(<span class="hljs-string">'icon-asterisk unsaved-indicator'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>$(‘#analyzeToolbar’).find(‘[data-section=”‘ + sectionName.replace(‘#forecast-chart-‘,’’) + ‘“]’).removeClass(‘icon-asterisk unsaved-indicator’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      }
    }
  });

<span class="hljs-built_in">module</span>.exports = AnalyzeView;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
