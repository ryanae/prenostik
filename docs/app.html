<!DOCTYPE html>

<html>
<head>
  <title>app.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="app.html">
                  app.js
                </a>
              
                
                <a class="source" href="PrenostikUser.html">
                  PrenostikUser.js
                </a>
              
                
                <a class="source" href="accounts.html">
                  accounts.js
                </a>
              
                
                <a class="source" href="accountsCommon.html">
                  accountsCommon.js
                </a>
              
                
                <a class="source" href="categories.html">
                  categories.js
                </a>
              
                
                <a class="source" href="corpaccounts.html">
                  corpaccounts.js
                </a>
              
                
                <a class="source" href="login.html">
                  login.js
                </a>
              
                
                <a class="source" href="analyze.html">
                  analyze.js
                </a>
              
                
                <a class="source" href="category.html">
                  category.js
                </a>
              
                
                <a class="source" href="categoryUpdate.html">
                  categoryUpdate.js
                </a>
              
                
                <a class="source" href="dataset.html">
                  dataset.js
                </a>
              
                
                <a class="source" href="home.html">
                  home.js
                </a>
              
                
                <a class="source" href="snapshot.html">
                  snapshot.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>app.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Main Client-side javascript file</p>
<hr>

            </div>
            
            <div class="content"><div class='highlight'><pre>$ = global.jQuery = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Import all third party dependencies
using browserify.
Some dependencies may have to be modified.
This makes dependencies global to the entire application 
In the future refactors, these should only be used in files
that need them. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/spin.min"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/jquery.cookie"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/foundation.datepicker"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/select2.min"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/date.format"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/dateutil"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/date"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/highstock-2.0.4/js/highstock"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/highstock-2.0.4/js/modules/exporting"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/jquery/jquery.dataTables"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/tabletools/TableTools"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/tabletools/ZeroClipboard"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./vendor/jquery.isloading.min"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-transition'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-alert'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-modal'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-tooltip'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-affix'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-dropdown'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-scrollspy'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-tab'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-popover'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-button'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-collapse'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-carousel'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-typeahead'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-contextmenu.custom'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-switch'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootstrap/bootstrap-select'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/bootbox/bootbox'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/flat-ui/flatui-checkbox.custom'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/flat-ui/flatui-radio'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/jquery/jquery.ui'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/jquery/jquery.select2'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/jquery/jquery.sprintf'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/jquery/jquery.toastr'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/jquery/jquery.helpers'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./vendor/jquery.tablesorter.min'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Marionette and their dependencies imported.
Along with the <code>localStorage</code> wrapper <a href="https://github.com/marcuswestin/store.js/">store.js</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore.normalize'</span>);
<span class="hljs-keyword">var</span> Backbone = <span class="hljs-built_in">require</span>(<span class="hljs-string">'backbone'</span>);
<span class="hljs-keyword">var</span> store = <span class="hljs-built_in">require</span>(<span class="hljs-string">'store'</span>);
Backbone.$ = $;
<span class="hljs-keyword">var</span> Marionette = <span class="hljs-built_in">require</span>(<span class="hljs-string">'backbone.marionette'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>The application depends heavily on jQuery. So, we
enclose the application in a self-invoking function
that is called when the page is loaded and jQuery
is ready. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Import custom libraries and handlebars</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> moment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'moment'</span>);
  <span class="hljs-keyword">var</span> socket = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./lib/socket'</span>);
  <span class="hljs-keyword">var</span> toast = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./lib/toast'</span>);
  <span class="hljs-keyword">var</span> form = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./lib/form'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Bind handlebars to the window for easy access</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-built_in">window</span>.Handlebars = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hbsfy/runtime'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Register titlecase template helper </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Handlebars.registerHelper(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">titleCase</span> <span class="hljs-params">(str)</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> str === <span class="hljs-string">'undefined'</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;

    <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/\w\S*/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(txt)</span></span>{<span class="hljs-keyword">return</span> txt.charAt(<span class="hljs-number">0</span>).toUpperCase() + txt.substr(<span class="hljs-number">1</span>).toLowerCase();});
  });

  Handlebars.registerHelper(<span class="hljs-string">'YYYY-MM-DD'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(date)</span> </span>{
      <span class="hljs-keyword">return</span> moment(date).utc().format(<span class="hljs-string">'YYYY-MM-DD'</span>);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>load all templates here
require(‘./app/partials’);</p>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Instantiate Bootstrap’s tooltip plugin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="hljs-string">'[data-toggle=tooltip]'</span>).tooltip({
    container: <span class="hljs-string">'body'</span>
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Import account related js files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> PrenostikUser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/PrenostikUser'</span>);
  <span class="hljs-keyword">var</span> accountsCommon = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/accountsCommon'</span>);
  <span class="hljs-keyword">var</span> controller = $(<span class="hljs-string">'html'</span>).attr(<span class="hljs-string">'class'</span>).match(<span class="hljs-regexp">/(.*)-controller/</span>)[<span class="hljs-number">1</span>];
  <span class="hljs-keyword">var</span> Analyze, Dataset, Worksheet, analyzeController,
    datasetController, worksheetController;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Import Backbone views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> SnapshotsView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/views/snapshot'</span>);
  <span class="hljs-keyword">var</span> AnalyzeView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/views/analyze'</span>);
  <span class="hljs-keyword">var</span> HomeView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/views/home'</span>);
  <span class="hljs-keyword">var</span> DatasetsView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/views/dataset'</span>);
  <span class="hljs-keyword">var</span> CategoryUpdateView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/views/categoryUpdate'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><code>closeDropdown</code> ensures the dropdown is not
to be left open after view changes from
<code>SnapshotsView</code> to <code>DatasetsView</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> closeDropdown = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
      <span class="hljs-keyword">var</span> manageDropdown = $(<span class="hljs-string">'#manage-dropdown'</span>);
      <span class="hljs-keyword">if</span> (manageDropdown.parent().hasClass(<span class="hljs-string">'open'</span>)) {
        $(<span class="hljs-string">'#manage-dropdown'</span>).dropdown(<span class="hljs-string">'toggle'</span>);
      }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Approuter extended to manage all frontend routes
that are supported by Backbone (ie. has Backbone View)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> AppRouter = Marionette.AppRouter.extend({
    routes: {
      <span class="hljs-string">"(/)"</span>: <span class="hljs-string">"home"</span>,
      <span class="hljs-string">"analyze/trending(/:snapshotId)"</span>: <span class="hljs-string">"trending"</span>,
      <span class="hljs-string">"manage/snapshots(/:categoryId)"</span>: <span class="hljs-string">"snapshot"</span>,
      <span class="hljs-string">"manage/datasets(/:categoryId)"</span>: <span class="hljs-string">"dataset"</span>,
      <span class="hljs-string">"manage/categories/update/:categoryType/:id"</span>: <span class="hljs-string">"updateCategory"</span>
    },

    home: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">var</span> analyzeView = $(<span class="hljs-string">'.analyze-view'</span>);
      <span class="hljs-keyword">if</span> (analyzeView.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.view.prepareRemove(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(result)</span></span>{
          <span class="hljs-keyword">if</span>(result){
            analyzeView.hide();
            analyzeView.siblings().remove();
            self.loadView(<span class="hljs-keyword">new</span> HomeView(socket));
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">window</span>.router.navigate(<span class="hljs-string">'analyze/trending'</span>);
          }
        });
      } <span class="hljs-keyword">else</span> {
        $(<span class="hljs-string">'#container'</span>).empty();
        <span class="hljs-keyword">this</span>.loadView(<span class="hljs-keyword">new</span> HomeView(socket));
      }
    },

    trending: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(snapshotId)</span> </span>{
      <span class="hljs-keyword">var</span> support = <span class="hljs-keyword">new</span> accountsCommon();
      <span class="hljs-keyword">var</span> currentUser = support.getAuthUser();
      <span class="hljs-keyword">if</span>(!currentUser.canDo(<span class="hljs-string">'SN_OPEN'</span>)){
        snapshotId = <span class="hljs-literal">null</span>;
      }

      <span class="hljs-keyword">this</span>.loadView(<span class="hljs-keyword">new</span> AnalyzeView(socket, snapshotId));
    },

    snapshot: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(categoryId)</span> </span>{
      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">var</span> analyzeView = $(<span class="hljs-string">'.analyze-view'</span>);
      <span class="hljs-keyword">if</span> (analyzeView.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.view.prepareRemove(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(result)</span></span>{
          <span class="hljs-keyword">if</span>(result){
            analyzeView.hide();
            analyzeView.siblings().remove();
            self.loadView(<span class="hljs-keyword">new</span> SnapshotsView(socket, categoryId));
            closeDropdown();
          } <span class="hljs-keyword">else</span>{
            <span class="hljs-built_in">window</span>.router.navigate(<span class="hljs-string">'analyze/trending'</span>);
          }
        });
      } <span class="hljs-keyword">else</span> {
        $(<span class="hljs-string">'#container'</span>).empty();
        <span class="hljs-keyword">this</span>.loadView(<span class="hljs-keyword">new</span> SnapshotsView(socket, categoryId));
        closeDropdown();
      }
    },

    dataset: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(categoryId)</span> </span>{
      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">var</span> analyzeView = $(<span class="hljs-string">'.analyze-view'</span>);
      <span class="hljs-keyword">if</span> (analyzeView.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.view.prepareRemove(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(result)</span></span>{
          <span class="hljs-keyword">if</span>(result){
            analyzeView.hide();
            analyzeView.siblings().remove();
            self.loadView(<span class="hljs-keyword">new</span> DatasetsView(socket, categoryId));
            closeDropdown();
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">window</span>.router.navigate(<span class="hljs-string">'analyze/trending'</span>);
          }
        });
      } <span class="hljs-keyword">else</span> {
        $(<span class="hljs-string">'#container'</span>).empty();
        <span class="hljs-keyword">this</span>.loadView(<span class="hljs-keyword">new</span> DatasetsView(socket, categoryId));
        closeDropdown();
      }
    },

    updateCategory: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(categoryType, id)</span> </span>{
      <span class="hljs-keyword">this</span>.loadView(<span class="hljs-keyword">new</span> CategoryUpdateView(socket, id, categoryType));
    },


    loadView: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(view)</span> </span>{
      $(<span class="hljs-string">'#flashContainer'</span>).empty();
      <span class="hljs-keyword">this</span>.view &amp;&amp; <span class="hljs-keyword">this</span>.view.unbind() &amp;&amp; <span class="hljs-keyword">this</span>.view.remove();
      <span class="hljs-keyword">this</span>.view = view;
    }
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>instatiate the AppRouter subclass and bind
to window under name <code>router</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-built_in">window</span>.router = <span class="hljs-keyword">new</span> AppRouter();</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Make sure Controller files are still being used
for non-Backbone supported views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (controller === <span class="hljs-string">'categories'</span>) <span class="hljs-keyword">new</span> (<span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/categories'</span>))(socket);
	<span class="hljs-keyword">if</span> (controller === <span class="hljs-string">'accounts'</span>) <span class="hljs-keyword">new</span> (<span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/accounts'</span>))(socket);
	<span class="hljs-keyword">if</span> (controller === <span class="hljs-string">'corporate'</span>) <span class="hljs-keyword">new</span> (<span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/corpaccounts'</span>))(socket);
	<span class="hljs-keyword">if</span> (controller === <span class="hljs-string">'users'</span>) <span class="hljs-keyword">new</span> (<span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/login'</span>))(socket);

  <span class="hljs-keyword">if</span> (controller === <span class="hljs-string">'datasets'</span> &amp;&amp;
    <span class="hljs-built_in">window</span>.location.pathname.indexOf(<span class="hljs-string">'/manage/datasets/add/preview'</span>) &gt;= <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">new</span> (<span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/datasets'</span>))(socket);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>clear snapshot cache on logout</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="hljs-string">'a[href="/users/logout"]'</span>).off().on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    e.preventDefault();
    <span class="hljs-keyword">var</span> support = <span class="hljs-keyword">new</span> accountsCommon();
    <span class="hljs-keyword">var</span> currentUser = support.getAuthUser();
    cachedSnapshots = store.get(<span class="hljs-string">'snapshots:'</span>+currentUser.id);
    <span class="hljs-keyword">if</span>(cachedSnapshots){
      <span class="hljs-keyword">for</span> (k <span class="hljs-keyword">in</span> cachedSnapshots){
        key = k + <span class="hljs-string">':'</span> + cachedSnapshots[k];
        store.remove(key)
      }
    }
    store.remove(<span class="hljs-string">'snapshots:'</span>+currentUser.id);
    <span class="hljs-built_in">window</span>.location = <span class="hljs-string">"/users/logout"</span>;
  });

  <span class="hljs-keyword">var</span> forceModalClose = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $(<span class="hljs-string">'#openWorksheetModal'</span>).modal(<span class="hljs-string">'hide'</span>);
    $(<span class="hljs-string">'body'</span>).removeClass(<span class="hljs-string">'modal-open'</span>);
    $(<span class="hljs-string">'.modal-backdrop'</span>).remove();
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>make sure backbone ignores any links that are
<em>NOT</em> supported by the app’s router</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="hljs-built_in">document</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">"a[href^='/']"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">var</span> href, passThrough, isRoot;
    href = $(e.currentTarget).attr(<span class="hljs-string">'href'</span>);
    passThrough = href.indexOf(<span class="hljs-string">'users/'</span>) &gt;= <span class="hljs-number">0</span> || href.indexOf(<span class="hljs-string">'manage/categories/add'</span>) &gt;= <span class="hljs-number">0</span> || href.indexOf(<span class="hljs-string">'corporate/'</span>) &gt;= <span class="hljs-number">0</span> || href.indexOf(<span class="hljs-string">'manage/datasets/append'</span>) &gt;= <span class="hljs-number">0</span>|| href.indexOf(<span class="hljs-string">'manage/datasets/add'</span>) &gt;= <span class="hljs-number">0</span>;
    isRoot = href == <span class="hljs-string">"/"</span>;
    <span class="hljs-keyword">if</span> (!isRoot &amp;&amp; !passThrough &amp;&amp; !e.altKey &amp;&amp; !e.ctrlKey &amp;&amp; !e.metaKey &amp;&amp; !e.shiftKey) {
      e.preventDefault();
      <span class="hljs-keyword">var</span> url = href.replace(<span class="hljs-regexp">/^\//</span>, <span class="hljs-string">''</span>);
      router.navigate(url, {
        trigger: <span class="hljs-literal">true</span>
      });
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h3 id="hack">HACK</h3>
<pre><code>  <span class="hljs-keyword">var</span> routeUrl = <span class="hljs-built_in">window</span>.location.pathname.slice(<span class="hljs-number">1</span>);
  <span class="hljs-keyword">if</span>(routeUrl.split(<span class="hljs-string">'/'</span>).length === <span class="hljs-number">3</span> &amp;&amp; routeUrl.indexOf(<span class="hljs-string">'analyze/trending/'</span>) &gt;= <span class="hljs-number">0</span>){
    router.navigate(routeUrl, {trigger: <span class="hljs-literal">true</span>});
  }
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Instantiate the Marionette Application</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> Prenostik = <span class="hljs-keyword">new</span> Marionette.Application();</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Set <code>div#container</code> element as the app’s region</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Prenostik.addRegions({
    appRegion: <span class="hljs-string">'#container'</span>
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Add pushstate for clean url routes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Prenostik.on(<span class="hljs-string">'start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    Backbone.history.start({
      pushState: <span class="hljs-literal">true</span>,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Finally start the application</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Prenostik.start();

})(jQuery);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
