<!DOCTYPE html>

<html>
<head>
  <title>corpaccounts.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="app.html">
                  app.js
                </a>
              
                
                <a class="source" href="PrenostikUser.html">
                  PrenostikUser.js
                </a>
              
                
                <a class="source" href="accounts.html">
                  accounts.js
                </a>
              
                
                <a class="source" href="accountsCommon.html">
                  accountsCommon.js
                </a>
              
                
                <a class="source" href="categories.html">
                  categories.js
                </a>
              
                
                <a class="source" href="corpaccounts.html">
                  corpaccounts.js
                </a>
              
                
                <a class="source" href="login.html">
                  login.js
                </a>
              
                
                <a class="source" href="analyze.html">
                  analyze.js
                </a>
              
                
                <a class="source" href="category.html">
                  category.js
                </a>
              
                
                <a class="source" href="categoryUpdate.html">
                  categoryUpdate.js
                </a>
              
                
                <a class="source" href="dataset.html">
                  dataset.js
                </a>
              
                
                <a class="source" href="home.html">
                  home.js
                </a>
              
                
                <a class="source" href="snapshot.html">
                  snapshot.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>corpaccounts.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> toast = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/toast'</span>);
<span class="hljs-keyword">var</span> hbs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hbs'</span>);
<span class="hljs-keyword">var</span> PrenostikUser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./PrenostikUser'</span>);
<span class="hljs-keyword">var</span> accountsCommon = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./accountsCommon'</span>);

<span class="hljs-keyword">var</span> ctxSocket = {};
<span class="hljs-keyword">var</span> Corporate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(socket)</span> </span>{
	<span class="hljs-keyword">this</span>.ctx = <span class="hljs-string">'.corporate-controller'</span>;
	<span class="hljs-keyword">this</span>.socket = socket;

	ctxSocket = socket;
	<span class="hljs-keyword">this</span>.init();
}

Corporate.prototype.init = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
};

<span class="hljs-built_in">module</span>.exports = Corporate;

$(<span class="hljs-built_in">document</span>).ready(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> 
</span>{
	<span class="hljs-keyword">var</span> commonLib = <span class="hljs-keyword">new</span> accountsCommon;
	<span class="hljs-keyword">var</span> currentUser = commonLib.getAuthUser();</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Set the company name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">'#coName'</span>).text(<span class="hljs-string">"Prenostik"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Main index page links</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">'#add_account'</span>).attr(<span class="hljs-string">'href'</span>, <span class="hljs-string">'mnu_add_account'</span>);
	$(<span class="hljs-string">'#deactivate_account'</span>).attr(<span class="hljs-string">'href'</span>, <span class="hljs-string">'mnu_deactivate_account'</span>);	
	$(<span class="hljs-string">'#edit_account'</span>).attr(<span class="hljs-string">'href'</span>, <span class="hljs-string">'mnu_add_account'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Enforce permissions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(currentUser.canDo(<span class="hljs-string">'CU_CREATE'</span>))
		$(<span class="hljs-string">'#add_account'</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">""</span>);
	<span class="hljs-keyword">if</span>(currentUser.canDo(<span class="hljs-string">'CU_EDIT'</span>))
		$(<span class="hljs-string">'#edit_account'</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">""</span>);
	<span class="hljs-keyword">if</span>(currentUser.canDo(<span class="hljs-string">'CU_DELETE'</span>) )
		$(<span class="hljs-string">'#deactivate_account'</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">""</span>); 
	<span class="hljs-keyword">if</span>(currentUser.canDo(<span class="hljs-string">"AP_DELETE"</span>))
		addCheckbox();
	<span class="hljs-keyword">if</span>(currentUser.canDoMenu(<span class="hljs-string">"MNU_MANAGE_COMPANIES"</span>) == <span class="hljs-literal">true</span>){						
		$(<span class="hljs-string">"#selCompany"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">""</span>);}
	<span class="hljs-keyword">else</span>{
		$(<span class="hljs-string">"#selCompany"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">"hidden"</span>);}</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Register popup for account errors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> popOptions = {<span class="hljs-string">'placement'</span>: <span class="hljs-string">'left'</span>, <span class="hljs-string">'html'</span>: <span class="hljs-literal">true</span>, <span class="hljs-string">'trigger'</span>:<span class="hljs-string">'manual'</span>, <span class="hljs-string">'animation'</span>:<span class="hljs-literal">false</span>};
	$(<span class="hljs-string">'.blueWhitebluePop'</span>).popover(registerPopover(<span class="hljs-string">'blueWhiteblue'</span>, popOptions));</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>$(‘#userList’).append(“<select id='selUserList' style='list-style-type:disc'></select>“);<br>Change the emperor’s clothes on the account add page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(<span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">"AccountMode"</span>) == <span class="hljs-string">"edit"</span>)
	{	
		$(<span class="hljs-string">'#edit_add_account_submit'</span>).text(<span class="hljs-string">"Save Changes"</span>);		
		$(<span class="hljs-string">'#action_title'</span>).text(<span class="hljs-string">"Edit Account"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Show the account select, but start in add mode now.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="hljs-string">'#selAccountEdit'</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">""</span>);
		$(<span class="hljs-string">'#selFilter'</span>).css(<span class="hljs-string">"visibility"</span>, <span class="hljs-string">""</span>);
		$(<span class="hljs-string">'#edit_add_account_submit'</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">"hidden"</span>);
		$(<span class="hljs-string">'#changeRole'</span>).css(<span class="hljs-string">"visibility"</span>, <span class="hljs-string">""</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Uncomment the following line to enable add account from edit mode
window.sessionStorage.setItem(“AccountMode”, “add”);        </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="hljs-string">"#liSiteAdmin"</span>).attr(<span class="hljs-string">"title"</span> , <span class="hljs-string">"Customer admin cannot be created for existing accounts"</span>);		
		enableTabs(<span class="hljs-literal">false</span>);
		enableNavButtons(<span class="hljs-literal">false</span>);	
		$(<span class="hljs-string">'#accountNotes'</span>).addClass(<span class="hljs-string">"disabled"</span>);		
	}
	<span class="hljs-keyword">else</span> <span class="hljs-comment">// Account mode "add"</span>
	{	
		$(<span class="hljs-string">'#edit_add_account_submit'</span>).text(<span class="hljs-string">"Create Account"</span>);
		$(<span class="hljs-string">'#action_title'</span>).html(<span class="hljs-string">"Add New Account"</span>);
		$(<span class="hljs-string">'#selAccountEdit'</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">"hidden"</span>);
		$(<span class="hljs-string">'#selFilter'</span>).css(<span class="hljs-string">"visibility"</span>, <span class="hljs-string">"hidden"</span>);
		$(<span class="hljs-string">'#changeRole'</span>).css(<span class="hljs-string">"visibility"</span>, <span class="hljs-string">"hidden"</span>);		
		$(<span class="hljs-string">"#siteAdminTab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);	
		$(<span class="hljs-string">'#accountNotes'</span>).removeClass(<span class="hljs-string">"disabled"</span>);		
		$(<span class="hljs-string">"#prevtab"</span>).addClass(<span class="hljs-string">"disabled"</span>);		
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Customize the Account editing page
The selects on this page should adjust dynamically
with the width of the web page for graceful degradation
as the window is resized. Overide the width dynamically.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">"#selState"</span>).css(<span class="hljs-string">"width"</span>, <span class="hljs-string">"100%"</span>);
	$(<span class="hljs-string">"#selCountry"</span>).css(<span class="hljs-string">"width"</span>, <span class="hljs-string">"100%"</span>);
	$(<span class="hljs-string">"#selAccountStatus"</span>).css(<span class="hljs-string">"width"</span>, <span class="hljs-string">"100%"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Set the height of the tabs to the height of the largest
tab, thus keeping them all the same size.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> tabHeight = $(<span class="hljs-string">'#tabAddress'</span>).css(<span class="hljs-string">'height'</span>); 	
	$(<span class="hljs-string">'.tab-content'</span>).css(<span class="hljs-string">'height'</span>,tabHeight);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Default to enabled account on creation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> selAccountStatus = $(<span class="hljs-string">'#selAccountStatus'</span>).get(<span class="hljs-number">0</span>);
	<span class="hljs-keyword">if</span>(selAccountStatus != <span class="hljs-literal">null</span>)
		selAccountStatus.selectedIndex = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Store account data for later use by filtering
Need an array to hold the list of accounts</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> arrAccounts = [];
	<span class="hljs-keyword">var</span> selAcc = $(<span class="hljs-string">'#selAccountEdit'</span>).get(<span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Dump the list in to the array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(selAcc != <span class="hljs-literal">null</span>){
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; selAcc.options.length; i++) 
		{
			<span class="hljs-keyword">var</span> opt = selAcc.options[i];
			arrAccounts.push(opt);
		}
	}
  
	$(<span class="hljs-string">"#accountName"</span>).focusout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>If the search popover was showing, hide it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="hljs-string">'#dynpop'</span>).popover(<span class="hljs-string">'hide'</span>);
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Handle filter changes in edit accounts</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'change'</span>, <span class="hljs-string">'#selFilter'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Get the index of the currently selected filter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> index = <span class="hljs-keyword">this</span>.options.selectedIndex;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Use the index to get the option selected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> selected = <span class="hljs-keyword">this</span>.options.item(index);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Get the filter from the option        </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> filter = selected.value;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Store the currently selected account</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> current = $(<span class="hljs-string">"#selAccountEdit option:selected"</span>).text();</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Apply the filter.        </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		filterAccounts(filter);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>If the filter causes the selected account to change, clear error indicators</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span>(current != $(<span class="hljs-string">"#selAccountEdit option:selected"</span>).text())
		{
			resetBorders();		
			clearFields();
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Handle clicks directly on tabs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-built_in">document</span>).on( <span class="hljs-string">'show.bs.tab'</span>, <span class="hljs-string">'a[data-toggle="tab"]'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(t)</span> </span>{				
		
		<span class="hljs-keyword">var</span> audit = validateTab(t.relatedTarget.id);
		<span class="hljs-keyword">if</span>(audit.valid == <span class="hljs-literal">false</span>)		
			displayErrors(audit);		
		<span class="hljs-keyword">return</span> audit.valid;
	})	
	
	$(<span class="hljs-built_in">document</span>).on( <span class="hljs-string">'shown.bs.tab'</span>, <span class="hljs-string">'a[data-toggle="tab"]'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(t)</span> </span>{
		<span class="hljs-keyword">var</span> tab = t.target;	
		
		<span class="hljs-keyword">var</span> mode = <span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">"AccountMode"</span>);	
		<span class="hljs-keyword">if</span>(mode == <span class="hljs-string">"add"</span>)
		{	<span class="hljs-comment">// In add mode, hide the save button until the last tab.				</span>
			<span class="hljs-keyword">if</span>(tab!=<span class="hljs-literal">null</span>)
			{ 	<span class="hljs-comment">// If this is the last tab, show the submit button.</span>
				<span class="hljs-keyword">if</span>(tab.id == <span class="hljs-string">'dbTab'</span>)				
					$(<span class="hljs-string">"#edit_add_account_submit"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">""</span>);				
				<span class="hljs-keyword">else</span> <span class="hljs-comment">// Otherwise, hide it.</span>
					$(<span class="hljs-string">"#edit_add_account_submit"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">"hidden"</span>);
			}
		}
		
		<span class="hljs-keyword">if</span>(tab!=<span class="hljs-literal">null</span>)
		{ 	<span class="hljs-comment">// If this is the last tab, synchronize nav button states.</span>
			<span class="hljs-keyword">if</span>(tab.id == <span class="hljs-string">'dbTab'</span>)
			{trimAllFields();
				$(<span class="hljs-string">"#nexttab"</span>).addClass(<span class="hljs-string">"disabled"</span>);		
				$(<span class="hljs-string">"#prevtab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);				
			}
			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(tab.id == <span class="hljs-string">'anTab'</span>)
			{					
				$(<span class="hljs-string">"#prevtab"</span>).addClass(<span class="hljs-string">"disabled"</span>);	
				$(<span class="hljs-string">"#nexttab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);				
			}
			<span class="hljs-keyword">else</span>
			{
				$(<span class="hljs-string">"#prevtab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);		
				$(<span class="hljs-string">"#nexttab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);				
			}
		}
	})</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Handle the clicks for the “next” and “previous” buttons on the page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> $tabs = $(<span class="hljs-string">'.tabbable li'</span>);	
	$(<span class="hljs-string">'#prevtab'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">var</span> mode = <span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">"AccountMode"</span>);	
		<span class="hljs-keyword">if</span>(mode == <span class="hljs-string">"add"</span>)
		{	<span class="hljs-comment">// When moving backward, always hide the submit button because</span></pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>the dialog is no longer on the last tab in the sequence.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$(<span class="hljs-string">"#edit_add_account_submit"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">"hidden"</span>);			
		}
		
		<span class="hljs-keyword">var</span> audit = validateTab($tabs.filter(<span class="hljs-string">'.active'</span>).find(<span class="hljs-string">'a[data-toggle="tab"]'</span>).get(<span class="hljs-number">0</span>).id);
		<span class="hljs-keyword">if</span>(audit.valid == <span class="hljs-literal">true</span>)
		{</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Get the next tab that should be shown.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> tab = $tabs.filter(<span class="hljs-string">'.active'</span>).prev(<span class="hljs-string">'li'</span>).find(<span class="hljs-string">'a[data-toggle="tab"]'</span>);		
			<span class="hljs-comment">/*
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Skip the “CustomerAdmin” tab if in edit mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			if((tab[0].id == "siteAdminTab") &amp;&amp; (mode == "edit") )
			{			
				var skip = $tabs.filter('.active').prev('li')			
				.prev('li').find('a[data-toggle="tab"]');
				skip.tab('show');
			}
			else */
			{
				tab.tab('show');
			}
		}
		else
			displayErrors(audit);
	});
	
	$('#nexttab').on('click', function() {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>“Next” button was clicked.  See if there is a tab to move to.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> tab = $tabs.filter(<span class="hljs-string">'.active'</span>).next(<span class="hljs-string">'li'</span>).find(<span class="hljs-string">'a[data-toggle="tab"]'</span>).get(<span class="hljs-number">0</span>);
		<span class="hljs-keyword">var</span> mode = <span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">"AccountMode"</span>);
		
		<span class="hljs-keyword">if</span>(mode == <span class="hljs-string">"add"</span>)
		{
			<span class="hljs-keyword">if</span>(tab!=<span class="hljs-literal">null</span>)
			{ 	<span class="hljs-comment">// If this is the last tab, show the submit button.</span>
				<span class="hljs-keyword">if</span>(tab.id == <span class="hljs-string">'dbTab'</span>)
					$(<span class="hljs-string">"#edit_add_account_submit"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">""</span>);					
				<span class="hljs-keyword">else</span>
					$(<span class="hljs-string">"#edit_add_account_submit"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">"hidden"</span>);
			}				
		}

		<span class="hljs-keyword">var</span> audit = validateTab($tabs.filter(<span class="hljs-string">'.active'</span>).find(<span class="hljs-string">'a[data-toggle="tab"]'</span>).get(<span class="hljs-number">0</span>).id);
		<span class="hljs-keyword">if</span>(audit.valid == <span class="hljs-literal">true</span>)
		{</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Get the next tab that should be shown.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> tab = $tabs.filter(<span class="hljs-string">'.active'</span>).next(<span class="hljs-string">'li'</span>).find(<span class="hljs-string">'a[data-toggle="tab"]'</span>);		
			<span class="hljs-comment">/*
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Skip the “CustomerAdmin” tab if in edit mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			if( (tab[0].id == "siteAdminTab")&amp;&amp; (mode == "edit") )
			{			
				var skip = $tabs.filter('.active').next('li')
				.next('li').find('a[data-toggle="tab"]');
				skip.tab('show');
			}
			else */
			{
				tab.tab('show');
			}		
		}
		else	
			displayErrors(audit);		
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Start with the account deactivate button disabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">'#mcDeleteBtn'</span>).prop(<span class="hljs-string">'disabled'</span>, <span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Editing an account and adding an account are effectively 
the same thing, so only one page is used for both functions.
When the menu item is chosen, the mode is set here.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#edit_account'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
		<span class="hljs-built_in">window</span>.sessionStorage.setItem(<span class="hljs-string">"AccountMode"</span>, <span class="hljs-string">"edit"</span>);			
	});

	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#add_account'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{		
		<span class="hljs-built_in">window</span>.sessionStorage.setItem(<span class="hljs-string">"AccountMode"</span>, <span class="hljs-string">"add"</span>);				
	});

	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'keyup'</span>, <span class="hljs-string">'#accountName'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
	</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Check for “<enter>“</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	    <span class="hljs-keyword">var</span> code = e.which;		
		<span class="hljs-keyword">var</span> mode = <span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">"AccountMode"</span>);	
		<span class="hljs-keyword">if</span>(code==<span class="hljs-number">13</span>)
		{
			<span class="hljs-keyword">if</span>(mode == <span class="hljs-string">"edit"</span>)
			{	<span class="hljs-comment">// Switch to the current account that was found</span>
				$(<span class="hljs-string">'#selAccountEdit'</span>).change();
				$(<span class="hljs-string">'#accountNotes'</span>).removeClass(<span class="hljs-string">"disabled"</span>);
				$(<span class="hljs-string">'#dynpop'</span>).popover(<span class="hljs-string">'hide'</span>);
				<span class="hljs-keyword">return</span>;
			}
			<span class="hljs-keyword">else</span>
			{</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>stub for save mode tasks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			}
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Search for existing accounts as account name is entered</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> matchOpt = <span class="hljs-literal">null</span>;
		<span class="hljs-keyword">var</span> optAccount = <span class="hljs-literal">null</span>;
		<span class="hljs-keyword">var</span> optText = <span class="hljs-literal">null</span>;
		
		
		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;arrAccounts.length; i++)
		{</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Get an account from the list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			optAccount = arrAccounts[i];
			optText = optAccount.text.trim().toLowerCase();</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Search for the current string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> p = optText.indexOf(<span class="hljs-keyword">this</span>.value.trim().toLowerCase());
			<span class="hljs-keyword">if</span>(p == <span class="hljs-number">0</span>)
			{				
				matchOpt = optAccount;
				<span class="hljs-keyword">break</span>;
			}
		}
		
		<span class="hljs-keyword">if</span>(mode == <span class="hljs-string">"edit"</span>)
		{
			<span class="hljs-keyword">if</span>(matchOpt!=<span class="hljs-literal">null</span>) <span class="hljs-comment">// Found a matching account</span>
			{		
				<span class="hljs-keyword">var</span> newopt = selAccountEdit.options.namedItem(matchOpt.id);
				<span class="hljs-keyword">if</span>(newopt != <span class="hljs-literal">null</span>)
					newopt.selected = <span class="hljs-literal">true</span>;
				$(<span class="hljs-string">'#dynpop'</span>).data(<span class="hljs-string">'popover'</span>).options.title = <span class="hljs-string">"Select Account"</span>
				$(<span class="hljs-string">'#dynpop'</span>).data(<span class="hljs-string">'popover'</span>).options.content = <span class="hljs-string">"Press enter to select this account: "</span>
					+ getPopContent(optAccount);				
				$(<span class="hljs-string">'#dynpop'</span>).popover(<span class="hljs-string">'show'</span>);

				<span class="hljs-keyword">if</span>((matchOpt.id == <span class="hljs-string">"-1"</span>))<span class="hljs-comment">//||(this.value.toLowerCase() != optText) )</span>
				{</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>If no account is selected, lock up</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					enableTabs(<span class="hljs-literal">false</span>);
					enableNavButtons(<span class="hljs-literal">false</span>);
					$(<span class="hljs-string">'#edit_add_account_submit'</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">"hidden"</span>);
					$(<span class="hljs-string">'#accountNotes'</span>).val(<span class="hljs-string">""</span>);
					$(<span class="hljs-string">'#accountNotes'</span>).addClass(<span class="hljs-string">"disabled"</span>);
					$(<span class="hljs-string">'#dynpop'</span>).popover(<span class="hljs-string">'hide'</span>);					
				}
			}		
		}
		<span class="hljs-keyword">else</span>
		{</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>In add mode, if a match is found, hilight the box and show an error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span>((matchOpt!=<span class="hljs-literal">null</span>)&amp;&amp;(<span class="hljs-keyword">this</span>.value.trim().toLowerCase() == optText))			
			{				
				$(<span class="hljs-string">'#dynpop'</span>).data(<span class="hljs-string">'popover'</span>).options.title = <span class="hljs-string">"Existing Account"</span>
				$(<span class="hljs-string">'#dynpop'</span>).data(<span class="hljs-string">'popover'</span>).options.content = getPopContent(optAccount);				
				$(<span class="hljs-string">'#dynpop'</span>).popover(<span class="hljs-string">'show'</span>);
				$(<span class="hljs-string">'#accountName'</span>).get(<span class="hljs-number">0</span>).style.borderColor = <span class="hljs-string">"red"</span>;
				enableTabs(<span class="hljs-literal">false</span>);
				$(<span class="hljs-string">"#nexttab"</span>).addClass(<span class="hljs-string">"disabled"</span>);
				}
			<span class="hljs-keyword">else</span>
			{
				$(<span class="hljs-string">'#accountName'</span>).get(<span class="hljs-number">0</span>).style.borderColor = <span class="hljs-string">""</span>;
				$(<span class="hljs-string">'#dynpop'</span>).popover(<span class="hljs-string">'hide'</span>);
				enableTabs(<span class="hljs-literal">true</span>);
				$(<span class="hljs-string">"#nexttab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);
			}
		}
	})
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'change'</span>, <span class="hljs-string">'#selState'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>If a state is chosen, the country should default to US        </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> selState = $(<span class="hljs-string">"#selState"</span>).get(<span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Get the index of the currently selected state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> index = selState.options.selectedIndex;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Use the index to get the country option object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> selected = selState.options.item(index);</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Get the data from the option</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> data = selected.value;
		
		<span class="hljs-keyword">if</span>(data == <span class="hljs-string">"-1"</span>)
		{		
			<span class="hljs-keyword">var</span> selCountry = $(<span class="hljs-string">"#selCountry"</span>).get(<span class="hljs-number">0</span>);	
			<span class="hljs-keyword">var</span> opt = selCountry.options.namedItem(<span class="hljs-string">'-1'</span>);	
			<span class="hljs-keyword">if</span>(opt != <span class="hljs-literal">null</span>)
			{
				opt.selected = <span class="hljs-literal">true</span>;
				<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"selCountry"</span>).disabled=<span class="hljs-literal">false</span>;				
			}		
		}
		<span class="hljs-keyword">else</span>
		{		
			<span class="hljs-keyword">var</span> selCountry = $(<span class="hljs-string">"#selCountry"</span>).get(<span class="hljs-number">0</span>);	
			<span class="hljs-keyword">var</span> opt = selCountry.options.namedItem(<span class="hljs-string">'US'</span>);	
			<span class="hljs-keyword">if</span>(opt != <span class="hljs-literal">null</span>)
			{
				opt.selected = <span class="hljs-literal">true</span>;				
				<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"selCountry"</span>).disabled=<span class="hljs-literal">true</span>;
			}		
		}			
	});
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'change'</span>, <span class="hljs-string">'#selCountry'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>If a non-US country is chosen, the state should default to not selected        </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> selCountry = getSelectedOption($(<span class="hljs-string">"#selCountry"</span>).get(<span class="hljs-number">0</span>));
		<span class="hljs-keyword">if</span>(selCountry != <span class="hljs-literal">null</span>)
		{
			<span class="hljs-keyword">if</span>(selCountry.value != <span class="hljs-string">"US"</span>)
			{</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Set the state to unspecified</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> opt = $(<span class="hljs-string">"#selState"</span>).get(<span class="hljs-number">0</span>).options.namedItem(<span class="hljs-string">'-1'</span>);	
				<span class="hljs-keyword">if</span>(opt != <span class="hljs-literal">null</span>)
				{
					opt.selected = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Set color to black if it was changed by audit.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					$(<span class="hljs-string">'#selState'</span>).get(<span class="hljs-number">0</span>).style.borderColor = <span class="hljs-string">""</span>;	
					<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"selState"</span>).disabled=<span class="hljs-literal">true</span>;				
				}					
			}
			<span class="hljs-keyword">else</span>
			{
				<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"selState"</span>).disabled=<span class="hljs-literal">false</span>;
			}
		}
	});
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#edit_department_submit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Handle a click on the “edit departments” button        </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> args = { title : <span class="hljs-string">"Edit Departments"</span>, <span class="hljs-comment">// Dialog title</span>
					assignedList : <span class="hljs-string">"department"</span>, <span class="hljs-comment">// Switch for GetCharacterizationList()</span>
					instructions : <span class="hljs-string">"Enter the new department name:"</span>,
					placeholder : <span class="hljs-string">"&lt;new department name&gt;"</span>,
					cloneSel : <span class="hljs-string">'selDepartment'</span>, <span class="hljs-comment">// ID of select to edit</span>
					selInstructions : <span class="hljs-string">"(Create New Department)"</span> <span class="hljs-comment">// Selection zero</span>
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Prepare and display the modal edit dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		prepDialog(args);		
		$(<span class="hljs-string">'#listEdit'</span>).modal();		
	});	
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#edit_industry_submit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Handle a click on the “edit industries” button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> args = { title : <span class="hljs-string">"Edit Industries"</span>,
					assignedList : <span class="hljs-string">"industry"</span>,
					instructions : <span class="hljs-string">"Enter the new industry:"</span>,
					placeholder : <span class="hljs-string">'&lt;new industry name&gt;'</span>,
					cloneSel : <span class="hljs-string">'selIndustry'</span>,
					selInstructions : <span class="hljs-string">"(Create New Industry)"</span>
					}
		prepDialog(args);
		$(<span class="hljs-string">"#listEdit"</span>).modal(); 			
	});	

	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#edit_account_submit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Handle a click on the “edit account types” button            </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> args = { title : <span class="hljs-string">"Edit Account Types"</span>,
					assignedList : <span class="hljs-string">"account"</span>,
					instructions : <span class="hljs-string">"Enter the new account type:"</span>,
					placeholder : <span class="hljs-string">'&lt;new account type&gt;'</span>,
					cloneSel : <span class="hljs-string">'selAccountType'</span>,
					selInstructions : <span class="hljs-string">"(Create New Account Type)"</span>
					}
		prepDialog(args);		
		$(<span class="hljs-string">"#listEdit"</span>).modal();
	});	

	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#edit_license_submit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Handle a click on the “edit license types” button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> args = { title : <span class="hljs-string">"Edit Contract Types"</span>,
					assignedList : <span class="hljs-string">"contract"</span>,
					instructions : <span class="hljs-string">"Enter the new contract type:"</span>,
					placeholder : <span class="hljs-string">'&lt;new contract type&gt;'</span>,
					cloneSel : <span class="hljs-string">'selContractType'</span>,
					selInstructions : <span class="hljs-string">"(Create New Contract Type)"</span>
					}
		prepDialog(args);	
		$(<span class="hljs-string">"#listEdit"</span>).modal();
	});	

	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'change'</span>, <span class="hljs-string">'#selEditList'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Handles a change in the selected item in the 
list edit modal dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> sel = <span class="hljs-keyword">this</span>.options[<span class="hljs-keyword">this</span>.selectedIndex];
		<span class="hljs-keyword">if</span>(sel.id != <span class="hljs-string">"-1"</span>)
		{
			$(<span class="hljs-string">'#newListValue'</span>).get(<span class="hljs-number">0</span>).value = sel.value;			
			$(<span class="hljs-string">"#listDel"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">""</span>);
		}
		<span class="hljs-keyword">else</span>
		{
			$(<span class="hljs-string">'#newListValue'</span>).get(<span class="hljs-number">0</span>).value = <span class="hljs-string">""</span>;		
			$(<span class="hljs-string">"#listDel"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">"hidden"</span>);
		}
	})
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#listDel'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Get the name of the list that is being edited
The names are assigned by the button that was clicked
to show the modal dialog.  See
$(‘body’).on(‘click’, ‘#edit_department_submit’ for example</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> listName = $(<span class="hljs-string">'#assignedList'</span>).get(<span class="hljs-number">0</span>).value;
		<span class="hljs-keyword">var</span> res = GetCharacterizationList(listName);
		<span class="hljs-keyword">var</span> crudName = res.name;
		<span class="hljs-keyword">var</span> list = res.selList;<span class="hljs-comment">// This is the actual list, not the dialog list</span>
		<span class="hljs-keyword">var</span> editList = $(<span class="hljs-string">'#selEditList'</span>).get(<span class="hljs-number">0</span>); <span class="hljs-comment">// This is the dialog copy list</span>
				
		<span class="hljs-keyword">if</span>(list != <span class="hljs-literal">null</span>) <span class="hljs-comment">// null is a "never happen"</span>
		{</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Use the index to get the user option object    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> selected = getSelectedOption(editList);</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Make sure button wasn’t clicked with nothing selected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span>(selected != <span class="hljs-literal">null</span>)
			{				
				<span class="hljs-keyword">var</span> method = <span class="hljs-string">'delete'</span>;				
				<span class="hljs-keyword">var</span> editID = selected.id;
				<span class="hljs-keyword">var</span> update={url: <span class="hljs-string">'account'</span>,
							list: crudName,
							item: <span class="hljs-string">""</span>,
							method: method,
							id: editID <span class="hljs-comment">// ID of entity to delete</span>
							}
							
				<span class="hljs-keyword">var</span> newID = UpdateCharacterization(update);</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>If the ID is not null, the DELETE failed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span>(newID == <span class="hljs-literal">null</span>)
				{	<span class="hljs-comment">// Success.  Remove the item from the current lists.</span>
					list.removeChild(list.options.namedItem(editID));
					editList.removeChild(editList.options.namedItem(editID));</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Clear the dialog text box</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					$(<span class="hljs-string">'#newListValue'</span>).get(<span class="hljs-number">0</span>).value = <span class="hljs-string">""</span>;					
				}
			}
		}
	})
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#listSave'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Handle the “save changes” button in the list edit dialog </p>

            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Get the name of the list that is being edited</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> listName = $(<span class="hljs-string">'#assignedList'</span>).get(<span class="hljs-number">0</span>).value;
		<span class="hljs-keyword">var</span> res = GetCharacterizationList(listName);
		<span class="hljs-keyword">var</span> list = res.selList; <span class="hljs-comment">// This is the actual list, not the dialog list</span>
		<span class="hljs-keyword">var</span> editList = $(<span class="hljs-string">'#selEditList'</span>).get(<span class="hljs-number">0</span>); <span class="hljs-comment">// This is the dialog copy list</span>
		<span class="hljs-keyword">var</span> crudName = res.name;
		
		<span class="hljs-keyword">if</span>(list != <span class="hljs-literal">null</span>) <span class="hljs-comment">// null is a "never happen"</span>
		{</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Assume a new item is being added (post)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> method = <span class="hljs-string">'post'</span>;
			<span class="hljs-keyword">var</span> editID = <span class="hljs-literal">null</span>; <span class="hljs-comment">// Server will provide the ID</span></pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Check if an item has been selected for editing instead of creation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> selected = getSelectedOption(editList);
			<span class="hljs-keyword">if</span>(selected != <span class="hljs-literal">null</span>)
			{
				method = <span class="hljs-string">'put'</span>; <span class="hljs-comment">// This will be an edit of an existing item	</span>
				editID = selected.id; <span class="hljs-comment">// Need the ID for the PUT</span>
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Prepare the information for AJAX</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> update={url: <span class="hljs-string">'account'</span>, <span class="hljs-comment">// Where the list is</span>
						list: crudName, <span class="hljs-comment">// Which list the item belongs to</span>
						item: $(<span class="hljs-string">'#newListValue'</span>).get(<span class="hljs-number">0</span>).value, <span class="hljs-comment">// Text for the item</span>
						method: method,	<span class="hljs-comment">// PUT or POST</span>
						id: editID <span class="hljs-comment">// Required for PUT, id of the item </span>
						}</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Update the list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> newID = UpdateCharacterization(update);
			<span class="hljs-keyword">if</span>(newID != <span class="hljs-literal">null</span>)
			{</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>On a PUT, the id is pre-set, and doesn’t change.<br>On a POST, the id goes in null, but comes back assigned.<br>Remove previous item from the current lists if it was edited</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span>(update.method == <span class="hljs-string">"put"</span>){

					list.removeChild(list.options.namedItem(editID));
					editList.removeChild(editList.options.namedItem(editID));
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Create a new option from the text entered by the user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> option = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"option"</span>);
				option.text = update.item;			
				option.selected = <span class="hljs-literal">true</span>;
				option.id = newID; <span class="hljs-comment">// new or existing</span></pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Add it to the lists and sort the lists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				list.add(option);
				<span class="hljs-keyword">var</span> commonLib = <span class="hljs-keyword">new</span> accountsCommon;
				commonLib.sortSelect(list);
				
				<span class="hljs-keyword">var</span> option2 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"option"</span>);
				option2.text = update.item;			
				option2.selected = <span class="hljs-literal">true</span>;
				option2.id = newID; <span class="hljs-comment">// new or existing</span></pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Add it to the lists and sort the lists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				editList.add(option2);
				commonLib.sortSelect(editList);				
			}
		}
	});
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#edit_add_account_cancel'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">"corpaccounts"</span>;
	});
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#siteRole'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
		$(<span class="hljs-string">'#roleChange'</span>).modal();
	});
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#roleOK'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>A (possibly) new user has been selected as the site admin.
Check the current one        </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> currentID = $(<span class="hljs-string">'#adminUserID'</span>).val();		
		<span class="hljs-keyword">var</span> optAdmin = getSelectedOption($(<span class="hljs-string">'#selUserList'</span>).get(<span class="hljs-number">0</span>));
		
		<span class="hljs-keyword">if</span>(optAdmin!=<span class="hljs-literal">null</span>)
		{	
			<span class="hljs-keyword">var</span> admin = <span class="hljs-built_in">JSON</span>.parse(optAdmin.value);</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>console.log(“\nHere’s the value of the option: “, admin);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span>(currentID != admin.id)
			{	<span class="hljs-comment">// Admin user has change.  Sigh.  Update the display.										</span>
				$(<span class="hljs-string">'#firstname'</span>).val(admin.firstname);
				$(<span class="hljs-string">'#middlename'</span>).val(admin.middlename);
				$(<span class="hljs-string">'#lastname'</span>).val(admin.lastname);
				$(<span class="hljs-string">'#username'</span>).val(admin.username);
				$(<span class="hljs-string">'#email'</span>).val(admin.email);
				$(<span class="hljs-string">'#emailc'</span>).val(admin.email);
				$(<span class="hljs-string">'#adminUserID'</span>).val(admin.id);</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>The role change will not happen until commit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			}
		}
	});
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#edit_add_account_submit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Handle a click on the “Save Changes” button in Add/Edit account        </p>

            </div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Sanity check audit for all tabs in both add and edit modes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> audit = isValidAccount();		
		<span class="hljs-keyword">if</span>(audit.valid == <span class="hljs-literal">true</span>)
		{</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Save data and submit page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			commitAccount(); <span class="hljs-comment">// Commits either add or edit data			</span>
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"add_account_form"</span>).submit();			
		}
		<span class="hljs-keyword">else</span>
		{</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Oops.  Validation failed.  Inform the user of the problem.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			displayErrors(audit);</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Move to the tab with errors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$(<span class="hljs-string">'#'</span>+audit.tabID).tab(<span class="hljs-string">'show'</span>);
		}
	});
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'change'</span>, <span class="hljs-string">'#selAccountEdit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>This is the “select account” on the Edit Account tab.
When the selected account changes, the displayed fields
must be updated.  That happens here.        </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> selAccount = $(<span class="hljs-string">"#selAccountEdit"</span>).get(<span class="hljs-number">0</span>);		
		<span class="hljs-keyword">var</span> accountData = getSelectedAccountData(selAccount);</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>In all cases, a change to the current account
means errors should be cleared</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		resetBorders();
		clearFields();
 		<span class="hljs-keyword">if</span>(accountData != -<span class="hljs-number">1</span>)
		{
			<span class="hljs-keyword">var</span> siteAdmin = getSelectedSiteAdmin(accountData.id);	
			enableTabs(<span class="hljs-literal">true</span>);
			$(<span class="hljs-string">"#nexttab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);
			$(<span class="hljs-string">'#accountNotes'</span>).removeClass(<span class="hljs-string">"disabled"</span>);
			$(<span class="hljs-string">'#selAccountStatus'</span>).removeClass(<span class="hljs-string">"disabled"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>User has selected an account to edit.  Switch modes.
Change page appearance for edit mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-built_in">window</span>.sessionStorage.setItem(<span class="hljs-string">"AccountMode"</span>, <span class="hljs-string">"edit"</span>);
			$(<span class="hljs-string">'#edit_add_account_submit'</span>).text(<span class="hljs-string">"Save Changes"</span>);
			$(<span class="hljs-string">'#action_title'</span>).text(<span class="hljs-string">"Edit Account"</span>);
			$(<span class="hljs-string">"#edit_add_account_submit"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">""</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>$(“#siteAdminTab”).addClass(“disabled”);
Change hidden account information</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-built_in">window</span>.sessionStorage.setItem(<span class="hljs-string">"CurrentAccountID"</span>, accountData.id);</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>document.getElementById(“id”).value = accountData.id;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-built_in">window</span>.sessionStorage.setItem(<span class="hljs-string">"AccountStatus"</span>, accountData.status);</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Display the newly selected account information
Account name Tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"accountName"</span>).value = accountData.name;			
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"accountNotes"</span>).value = accountData.notes;
			<span class="hljs-keyword">var</span> selAccountStatus = $(<span class="hljs-string">'#selAccountStatus'</span>).get(<span class="hljs-number">0</span>);
			
			<span class="hljs-keyword">if</span>(selAccountStatus != <span class="hljs-literal">null</span>)
			{
				<span class="hljs-keyword">if</span>(accountData.status == <span class="hljs-number">0</span>)
						selAccountStatus.selectedIndex = <span class="hljs-number">0</span>;
					<span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Any other value is some sort of disabled account.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						selAccountStatus.selectedIndex = <span class="hljs-number">1</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Address Tab            </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"accountAddress"</span>).value = accountData.address;			
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"accountAddress2"</span>).value = accountData.address2;
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"accountCity"</span>).value = accountData.city;	
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"accountZip"</span>).value = accountData.zip;</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Site Admin Tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span>(siteAdmin != <span class="hljs-literal">null</span>){
			$(<span class="hljs-string">'#firstname'</span>).val(siteAdmin.firstname);
			$(<span class="hljs-string">'#middlename'</span>).val(siteAdmin.middlename);
			$(<span class="hljs-string">'#lastname'</span>).val(siteAdmin.lastname);
			$(<span class="hljs-string">'#username'</span>).val(siteAdmin.username);
			$(<span class="hljs-string">'#email'</span>).val(siteAdmin.email);
			$(<span class="hljs-string">'#emailc'</span>).val(siteAdmin.email);
			$(<span class="hljs-string">'#adminUserID'</span>).val(siteAdmin.id);
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Load the list of all users at the selected company</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$(<span class="hljs-string">"#selUserList"</span>).empty();	
			LoadUserList(accountData.id, $(<span class="hljs-string">"#selUserList"</span>).get(<span class="hljs-number">0</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Handle State, Country</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span>(accountData.state != <span class="hljs-literal">null</span>)
			{
				<span class="hljs-keyword">var</span> index = getItemIndex(selState, accountData.state.toUpperCase());
				selState.options[index].selected = <span class="hljs-literal">true</span>;				
			}
			<span class="hljs-keyword">else</span> 
				selState.options[<span class="hljs-number">0</span>].selected = <span class="hljs-literal">true</span>;				
				
			<span class="hljs-keyword">if</span>(accountData.country != <span class="hljs-literal">null</span>)
			{
				<span class="hljs-keyword">var</span> index = getItemIndex(selCountry, accountData.country.toUpperCase());
				selCountry.options[index].selected = <span class="hljs-literal">true</span>;				
			}
			<span class="hljs-keyword">else</span>
				selCountry.options[<span class="hljs-number">0</span>].selected = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Characterization Tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span>(accountData.department != <span class="hljs-literal">null</span>)
			{				
				<span class="hljs-keyword">var</span> id = accountData.department.id;
				selDepartment.options.namedItem(id).selected = <span class="hljs-literal">true</span>;	
			}	
			<span class="hljs-keyword">else</span>
				selDepartment.options[<span class="hljs-number">0</span>].selected = <span class="hljs-literal">true</span>;
				
			<span class="hljs-keyword">if</span>(accountData.industries != <span class="hljs-literal">null</span>)
			{	
				<span class="hljs-keyword">if</span>(accountData.industries[<span class="hljs-number">0</span>] != <span class="hljs-literal">null</span>){			
				<span class="hljs-keyword">var</span> id = accountData.industries[<span class="hljs-number">0</span>].id;
				selIndustry.options.namedItem(id).selected = <span class="hljs-literal">true</span>;				
				}
			}	
			<span class="hljs-keyword">else</span>
				selIndustry.options[<span class="hljs-number">0</span>].selected = <span class="hljs-literal">true</span>;
				
			<span class="hljs-keyword">if</span>(accountData.accountType != <span class="hljs-literal">null</span>)
			{				
				<span class="hljs-keyword">var</span> id = accountData.accountType.id;
				selAccountType.options.namedItem(id).selected = <span class="hljs-literal">true</span>;	
			}
			<span class="hljs-keyword">else</span>
				selAccountType.options[<span class="hljs-number">0</span>].selected = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>License Tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span>(accountData.contract != <span class="hljs-literal">null</span>)
			{	
				<span class="hljs-keyword">if</span>(accountData.contract.contractType != <span class="hljs-literal">null</span>){
				<span class="hljs-keyword">var</span> id = accountData.contract.contractType.id;
				selContractType.options.namedItem(id).selected = <span class="hljs-literal">true</span>;}							
				<span class="hljs-keyword">var</span> startDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(accountData.contract.startdate);
				<span class="hljs-keyword">var</span> endDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(accountData.contract.expirationdate);
			}
			<span class="hljs-keyword">else</span>
			{
				<span class="hljs-keyword">var</span> startDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
				<span class="hljs-keyword">var</span> endDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
				endDate.setTime(endDate.getTime()+<span class="hljs-number">86401000</span>);<span class="hljs-comment">// add 24 hours to end date</span>
			}
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"startContract"</span>).value = startDate.toDateString();
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"endContract"</span>).value = endDate.toDateString();</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Database Tab
TODO: Must add database configuration here once it is defined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		}
		<span class="hljs-keyword">else</span>
		{</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>User has changed to no account selected - i.e. add account mode.<br>Uncomment these lines to enable account creation from edit mode
Change the appearance to add mode.
window.sessionStorage.setItem(“AccountMode”, “add”);
$(‘#edit_add_account_submit’).text(“Create Account”);
$(‘#action_title’).html(“Add New Account”);<br>$(“#siteAdminTab”).removeClass(“disabled”);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			enableTabs(<span class="hljs-literal">false</span>);
			enableNavButtons(<span class="hljs-literal">false</span>);
			$(<span class="hljs-string">'#accountNotes'</span>).addClass(<span class="hljs-string">"disabled"</span>);
			$(<span class="hljs-string">"#edit_add_account_submit"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">"hidden"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Clear or reset all data fields on all tabs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-built_in">window</span>.sessionStorage.setItem(<span class="hljs-string">"CurrentAccountID"</span>, <span class="hljs-string">"-1"</span>);	
			<span class="hljs-built_in">window</span>.sessionStorage.setItem(<span class="hljs-string">"AccountStatus"</span>, <span class="hljs-string">"0"</span>);
			<span class="hljs-keyword">var</span> selAccountStatus = $(<span class="hljs-string">'#selAccountStatus'</span>).get(<span class="hljs-number">0</span>);
			<span class="hljs-keyword">if</span>(selAccountStatus != <span class="hljs-literal">null</span>)
				selAccountStatus.selectedIndex = <span class="hljs-number">1</span>;<span class="hljs-comment">// Default to disabled account on creation.</span>
			clearFields();
			
			selState.options[<span class="hljs-number">0</span>].selected = <span class="hljs-literal">true</span>;
			selCountry.options[<span class="hljs-number">0</span>].selected = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Now handle characterizations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;
			selIndustry.options[index].selected = <span class="hljs-literal">true</span>;				
			selDepartment.options[index].selected = <span class="hljs-literal">true</span>;	
			selAccountType.options[index].selected = <span class="hljs-literal">true</span>;	
			selContractType.options[index].selected = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Initial contract date starts and ends today.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> startDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
			<span class="hljs-keyword">var</span> endDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"startContract"</span>).value = startDate.toLocaleDateString();
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"endContract"</span>).value = endDate.toLocaleDateString();</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Database configuration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			
		}
	});
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#mconfirm'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">var</span> delID = <span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">"CurrentAccountID"</span>);
		<span class="hljs-keyword">var</span> curID = <span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">"AllUsersAccountFilter"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>If the id of the company deleted was the same as was being
edited in the user accounts screens, clear the cached account
information to force the selection of a new account.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span>(delID == curID)
		{			
			<span class="hljs-built_in">window</span>.sessionStorage.removeItem(<span class="hljs-string">"AllUsersAccountFilter"</span>);
			<span class="hljs-built_in">window</span>.sessionStorage.removeItem(<span class="hljs-string">"AllUsersAccountCoName"</span>);			
		}
	});
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'change'</span>, <span class="hljs-string">'#deleteAccount'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Switch the page to delete mode if selected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> x = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"deleteAccount"</span>).checked;		
		<span class="hljs-keyword">if</span>(x == <span class="hljs-literal">true</span>)
		{	
			$(<span class="hljs-string">'#mcDeleteBtn'</span>).text(<span class="hljs-string">"DELETE ACCOUNT PERMANENTLY"</span>);
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"mcDeleteBtn"</span>).className = <span class="hljs-string">"btn btn-block btn-danger"</span>;									
			$(<span class="hljs-string">"#deactivateForm"</span>).attr(<span class="hljs-string">"action"</span>, <span class="hljs-string">"/corporate/delete_account"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Switch to danger mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$(<span class="hljs-string">"#modal-title"</span>).html(<span class="hljs-string">"Warning! DELETING ACCOUNT"</span>);
			$(<span class="hljs-string">"#lblWarning"</span>).text(<span class="hljs-string">"YOU MUST FIRST DELETE ASSOCIATED USERS AND SNAPSHOTS.  Deleting this account will permanently remove it from the server.  This action cannot be undone.  The delete performed is not a cascade, so any associated users and snapshots will not be removed."</span>);				
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'mconfirm'</span>).className = <span class="hljs-string">"btn btn-danger"</span>;
			$(<span class="hljs-string">'#mconfirm'</span>).text(<span class="hljs-string">"Yes, DELETE this Account"</span>);
		}
		<span class="hljs-keyword">else</span>
		{		
			$(<span class="hljs-string">'#mcDeleteBtn'</span>).text(<span class="hljs-string">"Suspend Account"</span>);
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"mcDeleteBtn"</span>).className = <span class="hljs-string">"btn btn-block btn-primary"</span>;						
			$(<span class="hljs-string">"#deactivateForm"</span>).attr(<span class="hljs-string">"action"</span>, <span class="hljs-string">"/corporate/deactivate_account"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Switch to suspend mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$(<span class="hljs-string">"#modal-title"</span>).html(<span class="hljs-string">"Confirm Account Suspension"</span>);
			$(<span class="hljs-string">"#lblWarning"</span>).text(<span class="hljs-string">"Are you sure you wish to suspend this account?"</span>);			
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'mconfirm'</span>).className = <span class="hljs-string">"btn btn-primary"</span>;			
			$(<span class="hljs-string">'#mconfirm'</span>).text(<span class="hljs-string">"Suspend Account"</span>);
		}
	})
	
	$(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'change'</span>, <span class="hljs-string">'#selAccount'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>This is the “select Account” on the “Suspend Account” page
This function is called when the account to be deleted has changed
Get the selected account data from the option in the select</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
		<span class="hljs-keyword">var</span> selAccount = $(<span class="hljs-string">"#selAccount"</span>).get(<span class="hljs-number">0</span>);
		<span class="hljs-keyword">var</span> accountData = getSelectedAccountData(selAccount); <span class="hljs-comment">// Note this is the account object, not the web page hybrid</span>
		
 		<span class="hljs-keyword">if</span>(accountData != -<span class="hljs-number">1</span>)
		{</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Display the currently selected account data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-built_in">window</span>.sessionStorage.setItem(<span class="hljs-string">"CurrentAccountID"</span>, accountData.id);				
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"id"</span>).value = accountData.id;			
			$(<span class="hljs-string">'#name'</span>).text(accountData.name);
			<span class="hljs-keyword">if</span>(accountData.status == <span class="hljs-number">0</span>)
				$(<span class="hljs-string">'#status'</span>).text(<span class="hljs-string">"Active"</span>);
			<span class="hljs-keyword">else</span>
				$(<span class="hljs-string">'#status'</span>).text(<span class="hljs-string">"Suspended"</span>);
			$(<span class="hljs-string">'#address'</span>).text(accountData.address);			
			$(<span class="hljs-string">'#city'</span>).text(accountData.city);					
			$(<span class="hljs-string">'#state'</span>).text(accountData.state);
			$(<span class="hljs-string">'#zip'</span>).text(accountData.zip);
			$(<span class="hljs-string">'#mcDeleteBtn'</span>).prop(<span class="hljs-string">'disabled'</span>, <span class="hljs-literal">false</span>);
		}
		<span class="hljs-keyword">else</span>
		{
			<span class="hljs-built_in">window</span>.sessionStorage.setItem(<span class="hljs-string">"CurrentAccountID"</span>, <span class="hljs-string">"-1"</span>);
			$(<span class="hljs-string">'#mcDeleteBtn'</span>).prop(<span class="hljs-string">'disabled'</span>, <span class="hljs-literal">true</span>);			
			<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"id"</span>).value = -<span class="hljs-number">1</span>			
			$(<span class="hljs-string">'#name'</span>).text(<span class="hljs-string">"(account name)"</span>);
			$(<span class="hljs-string">'#status'</span>).text(<span class="hljs-string">"(status)"</span>);
			$(<span class="hljs-string">'#address'</span>).text(<span class="hljs-string">"(street)"</span>);			
			$(<span class="hljs-string">'#city'</span>).text(<span class="hljs-string">"(city)"</span>);		
			$(<span class="hljs-string">'#state'</span>).text(<span class="hljs-string">"(state)"</span>);						
			$(<span class="hljs-string">'#zip'</span>).text(<span class="hljs-string">"(postal code)"</span>);
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>This function disables or enables the tabs in the accounts editing page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enableTabs</span><span class="hljs-params">(boolVal)</span>
</span>{
	<span class="hljs-keyword">if</span>(boolVal == <span class="hljs-literal">true</span>)
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>First tab, “#anTab” never gets disabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="hljs-string">"#addressTab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Primary user tab can be edited in Account Add mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> mode = <span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">"AccountMode"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>if(mode == “add”) // Now allow site admin edit from the tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="hljs-string">"#siteAdminTab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);
		$(<span class="hljs-string">"#charTab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);
		$(<span class="hljs-string">"#licenseTab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);
		$(<span class="hljs-string">"#dbTab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);
	}
	<span class="hljs-keyword">else</span>
	{	
		$(<span class="hljs-string">"#addressTab"</span>).addClass(<span class="hljs-string">"disabled"</span>);
		$(<span class="hljs-string">"#siteAdminTab"</span>).addClass(<span class="hljs-string">"disabled"</span>);
		$(<span class="hljs-string">"#charTab"</span>).addClass(<span class="hljs-string">"disabled"</span>);
		$(<span class="hljs-string">"#licenseTab"</span>).addClass(<span class="hljs-string">"disabled"</span>);
		$(<span class="hljs-string">"#dbTab"</span>).addClass(<span class="hljs-string">"disabled"</span>);	
	}
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enableNavButtons</span><span class="hljs-params">(state)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Not using default because custom css is prettier</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(state == <span class="hljs-literal">true</span>)
	{
		$(<span class="hljs-string">"#nexttab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);
		$(<span class="hljs-string">"#prevtab"</span>).removeClass(<span class="hljs-string">"disabled"</span>);
		$(<span class="hljs-string">"#selAccountStatus"</span>).removeClass(<span class="hljs-string">"disabled"</span>);
	}
	<span class="hljs-keyword">else</span>
	{
		$(<span class="hljs-string">"#nexttab"</span>).addClass(<span class="hljs-string">"disabled"</span>);
		$(<span class="hljs-string">"#prevtab"</span>).addClass(<span class="hljs-string">"disabled"</span>);
		$(<span class="hljs-string">"#selAccountStatus"</span>).addClass(<span class="hljs-string">"disabled"</span>);
	}
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">LoadUserList</span><span class="hljs-params">(accountID, selList)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>This function loads the list of all users for the 
account id passed in.  </p>

            </div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Build the url for the router</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> href = <span class="hljs-string">'/users/site_users'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Put the url for the REST call together with the data    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> body={<span class="hljs-string">'url'</span>:href, <span class="hljs-string">'accountid'</span>: accountID}	
	<span class="hljs-keyword">var</span> retData;</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Use AJAX to post the account reset.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$.ajax({			
			url: href,
			data: body,
			async: <span class="hljs-literal">false</span>, 
			method: <span class="hljs-string">'PUT'</span>,			
			dataType: <span class="hljs-string">'json'</span>,
			success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(response)</span> </span>{
				<span class="hljs-keyword">if</span> (response.success) 
				{
					retData = response.data;
				} 
				<span class="hljs-keyword">else</span> 
				{
					<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Failure. "</span>, response);</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>toast.notifyError(‘Error’, ‘Error: ‘+response.error.code+’ - ‘+response.error.message);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				}
			},
		error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span></span>{
			toast.notifyError(<span class="hljs-string">'Error'</span>, <span class="hljs-string">'Site users could not be loaded!'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>TODO: handle error condition gracefully</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		}
	});

	<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;retData.length; i++) 	
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>JQuery ‘.append’ has a bug.  MUST use DOM to do the work.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> data = <span class="hljs-built_in">JSON</span>.stringify(retData[i].data);
		<span class="hljs-keyword">var</span> option = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"option"</span>);		
		option.id = retData[i].userid;
		option.value = data;
		option.text = retData[i].name;
		selList.add(option);
	}	
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterAccounts</span><span class="hljs-params">(filter)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>This function uses the global accounts array arrAccounts
Get the accounts select</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> accSel = $(<span class="hljs-string">'#selAccountEdit'</span>).get(<span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Empty it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">"#selAccountEdit"</span>).empty();</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Rebuild the accounts list from the global array
filtering as it loops through the list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; arrAccounts.length; i++)
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Get an option</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> opt = arrAccounts[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Filter it and (maybe) add it back to the list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span>(filter == <span class="hljs-string">'all'</span>)
			accSel.options.add( arrAccounts[i]);
		<span class="hljs-keyword">else</span>
		{
			<span class="hljs-keyword">if</span>(!isFiltered(opt, filter))
				accSel.options.add( arrAccounts[i]);
		}
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>When the “all accounts” is chosen, add back the “create account” selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(filter == <span class="hljs-string">'all'</span>)
	{
		arrAccounts[<span class="hljs-number">0</span>].selected = <span class="hljs-literal">true</span>;
		accSel.options.add(arrAccounts[<span class="hljs-number">0</span>],<span class="hljs-number">0</span>);
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Force the refresh of the page through the select    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">'#selAccountEdit'</span>).change();	
}</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Returns true if the option passed in is allowed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isFiltered</span><span class="hljs-params">(opt, filter)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Establish the list of status types available</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> statusTypes=[<span class="hljs-string">'active'</span>,
					<span class="hljs-string">'suspended'</span>];
	
	<span class="hljs-keyword">var</span> filterID = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Get the ID of the status type as a filter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;statusTypes.length; i++)
	{
		<span class="hljs-keyword">if</span>(filter == statusTypes[i]){
			filterID = i;
			<span class="hljs-keyword">break</span>;
		}
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>If the filter is not found on the list, default to no filter.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(i==statusTypes.length)
		filterID = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Get the data from the option</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(opt != <span class="hljs-literal">null</span>)
		<span class="hljs-keyword">var</span> data = opt.value;
	
	<span class="hljs-keyword">if</span>(data != <span class="hljs-literal">null</span>)
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Reconstitute the account object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> accountData = <span class="hljs-built_in">JSON</span>.parse(data);		
		<span class="hljs-keyword">if</span>(accountData.status == filterID)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>If the loop drops out, the filter never matched
an actual status.  Something is wrong.    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;		
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateTab</span><span class="hljs-params">(tabID)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>Create the error tracking object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> errors =[];
	<span class="hljs-keyword">var</span> isValid ={
		valid : <span class="hljs-literal">true</span>,
		errList : errors,		
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Make sure there are no empty “space” only fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	trimAllFields();
	
	<span class="hljs-keyword">switch</span>(tabID)
	{
		<span class="hljs-keyword">case</span> <span class="hljs-string">"anTab"</span>:
			<span class="hljs-keyword">return</span> validateAnTab(isValid);
		<span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-string">"addressTab"</span>:
			<span class="hljs-keyword">return</span> validateAddressTab(isValid);
		<span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-string">"siteAdminTab"</span>:
			<span class="hljs-keyword">return</span> validateSiteManagerTab(isValid);
		<span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-string">"charTab"</span>:
			<span class="hljs-keyword">return</span> validateCharTab(isValid);
		<span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-string">"licenseTab"</span>:
			<span class="hljs-keyword">return</span> valdiateLicenseTab(isValid);
		<span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-string">"dbTab"</span>:
			<span class="hljs-keyword">return</span> validateDbTab(isValid);
		<span class="hljs-keyword">break</span>;
		
		<span class="hljs-keyword">default</span>:
			isValid.valid = <span class="hljs-literal">false</span>;
			isValid.errList.push({text:<span class="hljs-string">"Unknown tab ID in validation"</span>});			
		<span class="hljs-keyword">break</span>;
	}
	
	<span class="hljs-keyword">return</span> isValid;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">displayErrors</span><span class="hljs-params">(audit)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Add the list to be modified to the dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">"#errList"</span>).empty();
	$(<span class="hljs-string">'#errList'</span>).append(<span class="hljs-string">"&lt;ul id='lstList' style='list-style-type:disc'&gt;&lt;/ul&gt;"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Populate the error messages</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;audit.errList.length; i++) 			
		$(<span class="hljs-string">"#lstList"</span>).append(<span class="hljs-string">"&lt;li&gt;"</span>+audit.errList[i].text+<span class="hljs-string">"&lt;/li&gt;"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Tell the user what happened</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(audit.errList.length &gt; <span class="hljs-number">1</span>)
		$(<span class="hljs-string">'#errText'</span>).text(<span class="hljs-string">"The following errors have occurred:"</span>);
	<span class="hljs-keyword">else</span>
		$(<span class="hljs-string">'#errText'</span>).text(<span class="hljs-string">"The following error has occurred:"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Display</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">"#errAudit"</span>).modal(); 	
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetBorders</span><span class="hljs-params">()</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>This function clears all red “error” borders back to normal</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">":text"</span>).css(<span class="hljs-string">'border-color'</span>, <span class="hljs-string">''</span>);	
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearFields</span><span class="hljs-params">()</span>
</span>{
	$(<span class="hljs-string">":text"</span>).val(<span class="hljs-string">""</span>);
	$(<span class="hljs-string">"#accountNotes"</span>).val(<span class="hljs-string">''</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>TODO: Database fields here</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateAnTab</span><span class="hljs-params">(isValid)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>Account Name Tab<br>Check the account name field</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> name = $(<span class="hljs-string">'#accountName'</span>).get(<span class="hljs-number">0</span>);	
	<span class="hljs-keyword">if</span>(name.value == <span class="hljs-string">""</span>){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"Account name is a required field."</span>});		
		name.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
		name.style.borderColor = <span class="hljs-string">""</span>;

	<span class="hljs-keyword">return</span> isValid;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateAddressTab</span><span class="hljs-params">(isValid)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>Account Address Tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> name = $(<span class="hljs-string">'#accountAddress'</span>).get(<span class="hljs-number">0</span>);	
	<span class="hljs-keyword">if</span>(name.value == <span class="hljs-string">""</span>){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"Account address is a required field."</span>});		
		name.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
		name.style.borderColor = <span class="hljs-string">""</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>City    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> name = $(<span class="hljs-string">'#accountCity'</span>).get(<span class="hljs-number">0</span>);	
	<span class="hljs-keyword">if</span>(name.value == <span class="hljs-string">""</span>){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"City is a required field."</span>});		
		name.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
		name.style.borderColor = <span class="hljs-string">""</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>Zip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> name = $(<span class="hljs-string">'#accountZip'</span>).get(<span class="hljs-number">0</span>);	
	<span class="hljs-keyword">if</span>(name.value == <span class="hljs-string">""</span>){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"Postal code is a required field."</span>});		
		name.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
		name.style.borderColor = <span class="hljs-string">""</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>Country and state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> country = $(<span class="hljs-string">'#selCountry'</span>).get(<span class="hljs-number">0</span>);
	<span class="hljs-keyword">var</span> countryOpt = getSelectedOption(country);	
	<span class="hljs-keyword">var</span> state = $(<span class="hljs-string">'#selState'</span>).get(<span class="hljs-number">0</span>)
	<span class="hljs-keyword">var</span> stateOpt = getSelectedOption(state);	
		
	<span class="hljs-keyword">if</span>( (countryOpt == <span class="hljs-literal">null</span>) ){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"Country is a required field."</span>});		
		country.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>A country has been selected.  If it’s the US, then require a state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		country.style.borderColor = <span class="hljs-string">""</span>;		
		<span class="hljs-keyword">if</span> (country.value == <span class="hljs-string">"US"</span>)
		{
			<span class="hljs-keyword">if</span>(stateOpt == <span class="hljs-literal">null</span>) {
				isValid.valid = <span class="hljs-literal">false</span>;
				isValid.errList.push({text:<span class="hljs-string">"State is a required field."</span>});				
				state.style.borderColor = <span class="hljs-string">"red"</span>;
				}
			<span class="hljs-keyword">else</span>
			{			
				state.style.borderColor = <span class="hljs-string">""</span>;
			}
		}
		<span class="hljs-keyword">else</span>
			state.style.borderColor = <span class="hljs-string">""</span>;
	}
	<span class="hljs-keyword">return</span> isValid;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateSiteManagerTab</span><span class="hljs-params">(isValid)</span>
</span>{
	<span class="hljs-keyword">var</span> name = $(<span class="hljs-string">'#email'</span>).get(<span class="hljs-number">0</span>);	
	<span class="hljs-keyword">var</span> namedup = $(<span class="hljs-string">'#emailc'</span>).get(<span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Check that the email was entered correctly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span> (name.value != namedup.value)
	{
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"E-mail addresses do not match."</span>});		
		name.style.borderColor = <span class="hljs-string">"red"</span>;
	}
	<span class="hljs-keyword">else</span>
	{	<span class="hljs-comment">// Duplicates match, but is the address basically valid?	</span>
		<span class="hljs-keyword">var</span> commonLib = <span class="hljs-keyword">new</span> accountsCommon;
		<span class="hljs-keyword">if</span>(commonLib.isValidEmail(name.value)==<span class="hljs-literal">false</span>)
		{
			isValid.valid = <span class="hljs-literal">false</span>;
			isValid.errList.push({text:<span class="hljs-string">"A valid e-mail address is required."</span>});			
			name.style.borderColor = <span class="hljs-string">"red"</span>;
		}
		<span class="hljs-keyword">else</span>
			name.style.borderColor = <span class="hljs-string">""</span>;
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>Check for valid username</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> name = $(<span class="hljs-string">'#username'</span>).get(<span class="hljs-number">0</span>);
	<span class="hljs-keyword">if</span>(name.value == <span class="hljs-string">""</span>){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"User name is a required field."</span>});		
		name.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
		name.style.borderColor = <span class="hljs-string">""</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>Check for valid first name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> name = $(<span class="hljs-string">'#firstname'</span>).get(<span class="hljs-number">0</span>);
	<span class="hljs-keyword">if</span>(name.value == <span class="hljs-string">""</span>)
	{
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"First name is a required field."</span>});		
		name.style.borderColor = <span class="hljs-string">"red"</span>;
	}
	<span class="hljs-keyword">else</span>
		name.style.borderColor = <span class="hljs-string">""</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>Check for valid last name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> name = $(<span class="hljs-string">'#lastname'</span>).get(<span class="hljs-number">0</span>);
	<span class="hljs-keyword">if</span>(name.value == <span class="hljs-string">""</span>){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"Last name is a required field."</span>});		
		name.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
		name.style.borderColor = <span class="hljs-string">""</span>;

	<span class="hljs-keyword">return</span> isValid;	
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateCharTab</span><span class="hljs-params">(isValid)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>Characterizations Tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> selDepartment = $(<span class="hljs-string">'#selDepartment'</span>).get(<span class="hljs-number">0</span>);
	<span class="hljs-keyword">var</span> optDepartment = getSelectedOption(selDepartment);	
	<span class="hljs-keyword">if</span>(optDepartment == <span class="hljs-literal">null</span>){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"Department type is a required field."</span>});		
		selDepartment.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
		selDepartment.style.borderColor = <span class="hljs-string">""</span>;

	<span class="hljs-keyword">var</span> selIndustry = $(<span class="hljs-string">'#selIndustry'</span>).get(<span class="hljs-number">0</span>);
	<span class="hljs-keyword">var</span> optIndustry = getSelectedOption(selIndustry);	
	<span class="hljs-keyword">if</span>(optIndustry == <span class="hljs-literal">null</span>){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"Industry type is a required field."</span>});		
		selIndustry.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
		selIndustry.style.borderColor = <span class="hljs-string">""</span>;

	<span class="hljs-keyword">var</span> selAccountType = $(<span class="hljs-string">'#selAccountType'</span>).get(<span class="hljs-number">0</span>);
	<span class="hljs-keyword">var</span> optAccountType = getSelectedOption(selAccountType);	
	<span class="hljs-keyword">if</span>(optAccountType == <span class="hljs-literal">null</span>){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"Account type is a required field."</span>});		
		selAccountType.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
		selAccountType.style.borderColor = <span class="hljs-string">""</span>;	
	
	<span class="hljs-keyword">return</span> isValid;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">valdiateLicenseTab</span><span class="hljs-params">(isValid)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>License Tab
Check that a license has been selected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> contract = $(<span class="hljs-string">'#selContractType'</span>).get(<span class="hljs-number">0</span>);
	<span class="hljs-keyword">var</span> contractOpt = getSelectedOption(contract);	
	<span class="hljs-keyword">if</span>(contractOpt == <span class="hljs-literal">null</span>){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"Contract type is a required field."</span>});		
		contract.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
		contract.style.borderColor = <span class="hljs-string">""</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>Check that dates have been provided</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> name = $(<span class="hljs-string">'#startContract'</span>).get(<span class="hljs-number">0</span>);	
	<span class="hljs-keyword">if</span>(name.value == <span class="hljs-string">""</span>){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"Start date for contract is required."</span>});		
		name.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
		name.style.borderColor = <span class="hljs-string">""</span>;

	<span class="hljs-keyword">var</span> enddate = $(<span class="hljs-string">'#endContract'</span>).get(<span class="hljs-number">0</span>);	
	<span class="hljs-keyword">if</span>(enddate.value == <span class="hljs-string">""</span>){
		isValid.valid = <span class="hljs-literal">false</span>;
		isValid.errList.push({text:<span class="hljs-string">"End date for contract is required."</span>});		
		enddate.style.borderColor = <span class="hljs-string">"red"</span>;
		}
	<span class="hljs-keyword">else</span>
		enddate.style.borderColor = <span class="hljs-string">""</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>Make sure the end date is later than the start date</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(enddate.style.borderColor != <span class="hljs-string">"red"</span>)<span class="hljs-comment">// No point in continuing if it's already a problem.</span>
	{
		<span class="hljs-keyword">var</span> startd = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($(<span class="hljs-string">'#startContract'</span>).get(<span class="hljs-number">0</span>).value);
		<span class="hljs-keyword">var</span> endd = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($(<span class="hljs-string">'#endContract'</span>).get(<span class="hljs-number">0</span>).value);	
		<span class="hljs-keyword">if</span>(startd.getTime() &gt; endd.getTime())
		{
			isValid.valid = <span class="hljs-literal">false</span>;
			isValid.errList.push({text:<span class="hljs-string">"Contract duration is invalid.  End date cannot precede start date."</span>});			
			enddate.style.borderColor = <span class="hljs-string">"red"</span>;
		}
		<span class="hljs-keyword">else</span>
			enddate.style.borderColor = <span class="hljs-string">""</span>;
	}	

	<span class="hljs-keyword">if</span>(enddate.style.borderColor != <span class="hljs-string">"red"</span>)<span class="hljs-comment">// No point in continuing if it's already a problem.</span>
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>Make sure the contract is longer than 24 hours.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span>((endd.getTime() - startd.getTime()) &lt; <span class="hljs-number">86400000</span> ) <span class="hljs-comment">//24 hours in ms</span>
		{
			isValid.valid = <span class="hljs-literal">false</span>;
			isValid.errList.push({text:<span class="hljs-string">"Contract duration is invalid.  Minimum duration is 24 hours."</span>});			
			enddate.style.borderColor = <span class="hljs-string">"red"</span>;
		}
		<span class="hljs-keyword">else</span>
			enddate.style.borderColor = <span class="hljs-string">""</span>;

	}
	<span class="hljs-keyword">return</span> isValid;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateDbTab</span><span class="hljs-params">(isValid)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>TODO: Database settings validation, once settings are determined.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">return</span> isValid;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">registerPopover</span><span class="hljs-params">(classStr, options)</span>
</span>{	<span class="hljs-comment">// Register custom classname and HTML for the error popovers</span>
    <span class="hljs-keyword">if</span> ($.isPlainObject(classStr))
	{
        options = classStr;
        classStr = <span class="hljs-string">''</span>;
    }
    <span class="hljs-keyword">return</span> $.extend({<span class="hljs-string">'template'</span>: <span class="hljs-string">'&lt;div class="popover '</span> + classStr +<span class="hljs-string">'"&gt;&lt;div class="arrow"&gt;&lt;/div&gt;&lt;h3 class="popover-title"&gt;&lt;/h3&gt;&lt;div class="popover-content"&gt;&lt;/div&gt;&lt;/div&gt;'</span>}, options);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPopContent</span><span class="hljs-params">(opt)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>Returns the content to display in the existing account popover</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> data = opt.value;
	<span class="hljs-keyword">if</span>(data != -<span class="hljs-number">1</span>)
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>Reconstitute the account object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> accountData = <span class="hljs-built_in">JSON</span>.parse(data);		
		
		<span class="hljs-keyword">var</span> status = <span class="hljs-string">"Active"</span>;
		<span class="hljs-keyword">if</span>(accountData.status &gt; <span class="hljs-number">0</span>)
			status = <span class="hljs-string">"Suspended"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>Assemble an address card as an HTML string for display</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> card = accountData.name +<span class="hljs-string">'&lt;br&gt;'</span>+
					accountData.address +<span class="hljs-string">'&lt;br&gt;'</span>+
					accountData.city + <span class="hljs-string">', '</span>+
					accountData.state +<span class="hljs-string">'&lt;br&gt;'</span>+
					accountData.zip +<span class="hljs-string">'&lt;br&gt;'</span>+
					<span class="hljs-string">'Status: '</span> + status;		
		<span class="hljs-keyword">return</span> card;
	}
	<span class="hljs-keyword">else</span>
		<span class="hljs-keyword">return</span> <span class="hljs-string">"The account name selected cannot be used."</span>; <span class="hljs-comment">// never happen</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prepDialog</span><span class="hljs-params">(args)</span>
</span>{	<span class="hljs-comment">// This function preps the modal edit dialog for each</span></pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>list being edited.
Set the title to identify what the user is doing    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">'#dlgTitle'</span>).text(args.title);</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Pass the list that is being modified to the dialog    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">'#assignedList'</span>).get(<span class="hljs-number">0</span>).value = args.assignedList;</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>Display instructions    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">'#instText'</span>).text(args.instructions);</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>Clear out any previous text and put in customized placeholder    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">'#newListValue'</span>).get(<span class="hljs-number">0</span>).value = <span class="hljs-string">""</span>;	
	$(<span class="hljs-string">'#newListValue'</span>).attr(<span class="hljs-string">'placeholder'</span>, args.placeholder);</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>Add the list to be modified to the dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">"#theList"</span>).empty();	
	$(<span class="hljs-string">'#'</span>+args.cloneSel).clone(<span class="hljs-literal">false</span>)
	.attr(<span class="hljs-string">'id'</span>, <span class="hljs-string">'selEditList'</span>)		
	.appendTo(<span class="hljs-string">"#theList"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>Change the “create new…” instruction in the select</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">'#selEditList'</span>).get(<span class="hljs-number">0</span>).options[<span class="hljs-number">0</span>].text=args.selInstructions;</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>Hide the delete button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">"#listDel"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">"hidden"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>Get the new list and set the select to match the current selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> editList = $(<span class="hljs-string">'#selEditList'</span>).get(<span class="hljs-number">0</span>);
	editList.selectedIndex = $(<span class="hljs-string">'#'</span>+args.cloneSel)[<span class="hljs-number">0</span>].selectedIndex;</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>If an item is preselected, put its text in the edit box</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(editList.selectedIndex &gt; <span class="hljs-number">0</span>){
		$(<span class="hljs-string">"#listDel"</span>).css(<span class="hljs-string">"visibility"</span>,<span class="hljs-string">""</span>);<span class="hljs-comment">// and show the delete button</span>
		$(<span class="hljs-string">'#newListValue'</span>).get(<span class="hljs-number">0</span>).value = $(<span class="hljs-string">"#selEditList option:selected"</span>).val();
	} 
}	

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addCheckbox</span><span class="hljs-params">()</span> 
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>This is Patrick’s account kill option</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>   <span class="hljs-keyword">var</span> div = $(<span class="hljs-string">'#cbp'</span>);
   $(<span class="hljs-string">'&lt;input /&gt;'</span>, { type: <span class="hljs-string">'checkbox'</span>, name: <span class="hljs-string">"deleteAccount"</span>, id: <span class="hljs-string">"deleteAccount"</span>, value: <span class="hljs-string">"kill"</span> }).appendTo(div);   
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getItemIndex</span><span class="hljs-params">(selSearch, value)</span> 
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>Returns the index of the item specified by value
on the list passed in.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> selSearch.options)
	{
		<span class="hljs-keyword">var</span> opt = selSearch.options[i];	
		<span class="hljs-keyword">if</span>(opt.value == value)
			<span class="hljs-keyword">return</span> i;			
	}
	<span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>Returns the account object from the select passed in
assumes the select is a “standard” (for this program) </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSelectedAccountData</span><span class="hljs-params">(selList)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>Broken into steps for clarity
Get the index of the currently selected user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> index = selList.options.selectedIndex;</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>Use the index to get the user option object    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> selected = selList.options.item(index);</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>Get the data from the option</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(selected !=<span class="hljs-literal">null</span>)
		<span class="hljs-keyword">var</span> data = selected.value;
	<span class="hljs-keyword">else</span>
		data = -<span class="hljs-number">1</span>;
	<span class="hljs-keyword">if</span>(data != -<span class="hljs-number">1</span>)
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>Reconstitute the account object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> accountData = <span class="hljs-built_in">JSON</span>.parse(data);		
		<span class="hljs-keyword">return</span> accountData;
	}
	<span class="hljs-keyword">else</span>
		<span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>; <span class="hljs-comment">// No selected user	</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSelectedSiteAdmin</span><span class="hljs-params">(accountID)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>Returns the site administrator information
for the account ID passed in
This has been abstracted in to a function call
as a stub for making this an AJAX call in the future.        </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">return</span> $(<span class="hljs-string">"#info ul li[id="</span>+accountID+<span class="hljs-string">"]"</span>).data(<span class="hljs-string">'json'</span>);		
}</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>Update the selected account object and save the data for the post
Assumes the edit has been validated.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">commitAccount</span><span class="hljs-params">()</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>Determine if the page is in add mode or edit mode.    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> mode = <span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">"AccountMode"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>The primary difference between adding and editing is
the rest call, and some of the information provided.
Edit mode requires more information - i.e. the original record</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(mode == <span class="hljs-string">"edit"</span>)
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>Get the full account data that is to be modified</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> selAccount = $(<span class="hljs-string">"#selAccountEdit"</span>).get(<span class="hljs-number">0</span>);		
		<span class="hljs-keyword">var</span> accountData = getSelectedAccountData(selAccount);</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>Apply the edits to the account</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> account = commitAccountEdit(accountData);</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>Get the current site admin user object for the current account</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> currentAdmin = getSelectedSiteAdmin(accountData.id);		
		<span class="hljs-keyword">var</span> oldAdmin = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>See if the admin role has changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span>(currentAdmin.id != $(<span class="hljs-string">'#adminUserID'</span>).val())
		{
			<span class="hljs-keyword">var</span> optAdmin = getSelectedOption($(<span class="hljs-string">'#selUserList'</span>).get(<span class="hljs-number">0</span>));
			<span class="hljs-keyword">var</span> nAdmin = <span class="hljs-built_in">JSON</span>.parse(optAdmin.value);			
			adminRoleChange(currentAdmin, nAdmin); 
			oldAdmin = currentAdmin; <span class="hljs-comment">// Save old admin, now without role</span>
			currentAdmin = nAdmin; <span class="hljs-comment">// Save new admin, now with role</span>
			$(<span class="hljs-string">'#adminUserID'</span>).val(nAdmin);
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p>Apply field edits to the current admin account</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> newAdmin = commitSiteAdminEdit(currentAdmin);		
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>Explicit test for explicit behavior</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(mode == <span class="hljs-string">"add"</span>)
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>Finalize the new account and user data
Note that two types of account are being created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> account = commitAccountNew();
		<span class="hljs-keyword">var</span> newAdmin = commitSiteAdminNew();
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>Once the account record has been created or edits applied,
update the web page with the new information to pass to REST API.
These hidden data fields in the web page are the only place data is passed.
The idea is to loosen the coupling between the web page and the data
by making a single point of binding.    Maybe make it ajax some day.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> $editedAccount = $(<span class="hljs-string">'&lt;input/&gt;'</span>,{type:<span class="hljs-string">'hidden'</span>,id:<span class="hljs-string">'edited_account'</span>, name:<span class="hljs-string">'edited_account'</span>}).appendTo(<span class="hljs-string">'#info'</span>);	
	$editedAccount.val(<span class="hljs-built_in">JSON</span>.stringify(account));	
	
	<span class="hljs-keyword">var</span> $editedNewAdmin = $(<span class="hljs-string">'&lt;input/&gt;'</span>,{type:<span class="hljs-string">'hidden'</span>,id:<span class="hljs-string">'edited_newAdmin'</span>, name:<span class="hljs-string">'edited_newAdmin'</span>}).appendTo(<span class="hljs-string">'#info'</span>);
	$editedNewAdmin.val(<span class="hljs-built_in">JSON</span>.stringify(newAdmin));

	<span class="hljs-keyword">var</span> $editedOldAdmin = $(<span class="hljs-string">'&lt;input/&gt;'</span>,{type:<span class="hljs-string">'hidden'</span>,id:<span class="hljs-string">'edited_oldAdmin'</span>, name:<span class="hljs-string">'edited_oldAdmin'</span>}).appendTo(<span class="hljs-string">'#info'</span>);
	$editedOldAdmin.val(<span class="hljs-built_in">JSON</span>.stringify(oldAdmin));</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>Mode determines PUT or POST</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$(<span class="hljs-string">'&lt;input/&gt;'</span>,{type:<span class="hljs-string">'hidden'</span>, id:<span class="hljs-string">'mode'</span>, name:<span class="hljs-string">'mode'</span>, value:mode}).appendTo(<span class="hljs-string">'#info'</span>);
		
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">adminRoleChange</span><span class="hljs-params">(oldAdmin, newAdmin)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>Remove the admin role from the old admin
add the admin role to the newAdmin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;oldAdmin.groups.length; i++) 	
	{
		<span class="hljs-keyword">if</span>(oldAdmin.groups[i].id == <span class="hljs-number">2</span>)<span class="hljs-comment">// TODO: Make this an enum or const.</span>
		{
			<span class="hljs-keyword">var</span> group = oldAdmin.groups[i];
			oldAdmin.groups.splice(i,<span class="hljs-number">1</span>);
			<span class="hljs-keyword">break</span>;
		}
	}
	newAdmin.groups.push(group);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">commitAccountEdit</span><span class="hljs-params">(account)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              <p>This function takes the finalized account information 
from the fields and builds the new record to PUT.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	
	trimAllFields();</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <p>Get the contract information</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> selected = getSelectedOption($(<span class="hljs-string">"#selContractType"</span>).get(<span class="hljs-number">0</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>console.log(“START DATE CONTROL VALUE: “, $(‘#startContract’).get(0).value    );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> startd = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($(<span class="hljs-string">'#startContract'</span>).get(<span class="hljs-number">0</span>).value);</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>console.log(“Start date says: “, startd.toUTCString());</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> endd = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($(<span class="hljs-string">'#endContract'</span>).get(<span class="hljs-number">0</span>).value);</pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <p>Get the characterizations as objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> sel = getSelectedOption($(<span class="hljs-string">'#selDepartment'</span>).get(<span class="hljs-number">0</span>));
	<span class="hljs-keyword">var</span> department = { <span class="hljs-string">"id"</span>: sel.id};<span class="hljs-comment">//, "name": sel.value};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              <p>Industry</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> sel = getSelectedOption($(<span class="hljs-string">'#selIndustry'</span>).get(<span class="hljs-number">0</span>));	
	<span class="hljs-keyword">var</span> industry = { <span class="hljs-string">"id"</span>: sel.id};<span class="hljs-comment">//, "name": sel.value};</span>
	<span class="hljs-keyword">var</span> ia=[];
	ia[<span class="hljs-number">0</span>]=industry;</pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              <p>Account Type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> sel = getSelectedOption($(<span class="hljs-string">'#selAccountType'</span>).get(<span class="hljs-number">0</span>));
	<span class="hljs-keyword">var</span> type = { <span class="hljs-string">"id"</span>: sel.id};<span class="hljs-comment">//, "name": sel.value};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              <p>Edit the account object
account.id = window.sessionStorage.getItem(“CurrentAccountID”),
account.status: 0,//window.sessionStorage.getItem(“AccountStatus”),</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	account.name =  $(<span class="hljs-string">'#accountName'</span>).get(<span class="hljs-number">0</span>).value;
	account.notes =  $(<span class="hljs-string">'#accountNotes'</span>).get(<span class="hljs-number">0</span>).value;
	account.address =  $(<span class="hljs-string">'#accountAddress'</span>).get(<span class="hljs-number">0</span>).value;
	account.address2 = $(<span class="hljs-string">'#accountAddress2'</span>).get(<span class="hljs-number">0</span>).value;
	account.city =  $(<span class="hljs-string">'#accountCity'</span>).get(<span class="hljs-number">0</span>).value;
	account.state =  getSelectedOption($(<span class="hljs-string">'#selState'</span>).get(<span class="hljs-number">0</span>)).value;
	account.zip =  $(<span class="hljs-string">'#accountZip'</span>).get(<span class="hljs-number">0</span>).value;
	account.country =  getSelectedOption($(<span class="hljs-string">'#selCountry'</span>).get(<span class="hljs-number">0</span>)).value;
	account.province =  <span class="hljs-string">"-1"</span>; <span class="hljs-comment">// Abandoned field</span>
	account.department =  department;
	account.industries =  ia;
	account.accountType =  type;</pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              <p>An invalid account may be editable (i.e. it exists in some form) but the 
contract might not exist.  This will handle incomplete records on the 
server.  This should never happen, but during testing, the server
was initialized with incomplete data.  This code adds a layer of 
robustness.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(account.contract == <span class="hljs-literal">null</span>)
	{
		<span class="hljs-keyword">var</span> contract = {</pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>“id”:null, // New contract ID provided by server</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-string">"contractType"</span>:{<span class="hljs-string">"id"</span>: selected.id<span class="hljs-comment">//,</span></pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>“name”: selected.value // Server assigned name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>									},
					<span class="hljs-string">"startdate"</span>: startd.getTime(),
					<span class="hljs-string">"expirationdate"</span>:endd.getTime()	};
	}
	<span class="hljs-keyword">else</span>
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <p>account.contract.id = null, // ID already exists, and will be used by the server    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		account.contract.contractType.id = selected.id;								
		account.contract.contractType.name = selected.value	
		account.contract.startdate = startd.getTime();
		account.contract.expirationdate = endd.getTime();					
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              <p>Finally, account status.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	field = $(<span class="hljs-string">'#selAccountStatus'</span>).get(<span class="hljs-number">0</span>);		
	account.status = field.value;

	<span class="hljs-keyword">return</span> account;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">commitSiteAdminEdit</span><span class="hljs-params">(siteAdminData)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <p>This function takes the finalized user information 
from the fields and builds the new record to PUT.
Assumes data has been validated.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	trimAllFields();
	siteAdminData.firstname =  $(<span class="hljs-string">'#firstname'</span>).get(<span class="hljs-number">0</span>).value;
	siteAdminData.middlename =  $(<span class="hljs-string">'#middlename'</span>).get(<span class="hljs-number">0</span>).value;
	siteAdminData.lastname =  $(<span class="hljs-string">'#lastname'</span>).get(<span class="hljs-number">0</span>).value;
	siteAdminData.username = $(<span class="hljs-string">'#username'</span>).get(<span class="hljs-number">0</span>).value;
	siteAdminData.email =  $(<span class="hljs-string">'#email'</span>).get(<span class="hljs-number">0</span>).value;
	<span class="hljs-keyword">return</span> siteAdminData;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">commitAccountNew</span><span class="hljs-params">()</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-197">&#182;</a>
              </div>
              <p>This function takes the finalized account information 
from the fields and builds the new record to POST.    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	
	trimAllFields();</pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-198">&#182;</a>
              </div>
              <p>Get the contract information</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> selected = getSelectedOption($(<span class="hljs-string">"#selContractType"</span>).get(<span class="hljs-number">0</span>));		
	<span class="hljs-keyword">var</span> startd = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($(<span class="hljs-string">'#startContract'</span>).get(<span class="hljs-number">0</span>).value);
	<span class="hljs-keyword">var</span> endd = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>($(<span class="hljs-string">'#endContract'</span>).get(<span class="hljs-number">0</span>).value);	
	<span class="hljs-keyword">var</span> contract = {</pre></div></div>
            
        </li>
        
        
        <li id="section-199">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-199">&#182;</a>
              </div>
              <p>“id”:null, // New contract ID provided by server</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-string">"contractType"</span>:{<span class="hljs-string">"id"</span>: selected.id<span class="hljs-comment">//,</span></pre></div></div>
            
        </li>
        
        
        <li id="section-200">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-200">&#182;</a>
              </div>
              <p>“name”: selected.value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>									},
					<span class="hljs-string">"startdate"</span>: startd.getTime(),
					<span class="hljs-string">"expirationdate"</span>:endd.getTime()	};</pre></div></div>
            
        </li>
        
        
        <li id="section-201">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-201">&#182;</a>
              </div>
              <p>Get the characterizations as objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> sel = getSelectedOption($(<span class="hljs-string">'#selDepartment'</span>).get(<span class="hljs-number">0</span>));
	<span class="hljs-keyword">var</span> department = { <span class="hljs-string">"id"</span>: sel.id};<span class="hljs-comment">//, "name": sel.value};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-202">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-202">&#182;</a>
              </div>
              <p>Industry</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> sel = getSelectedOption($(<span class="hljs-string">'#selIndustry'</span>).get(<span class="hljs-number">0</span>));	
	<span class="hljs-keyword">var</span> industry = { <span class="hljs-string">"id"</span>: sel.id};<span class="hljs-comment">//, "name": sel.value};</span>
	<span class="hljs-keyword">var</span> ia=[];
	ia[<span class="hljs-number">0</span>]=industry;</pre></div></div>
            
        </li>
        
        
        <li id="section-203">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-203">&#182;</a>
              </div>
              <p>Account Type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> sel = getSelectedOption($(<span class="hljs-string">'#selAccountType'</span>).get(<span class="hljs-number">0</span>));
	<span class="hljs-keyword">var</span> type = { <span class="hljs-string">"id"</span>: sel.id};<span class="hljs-comment">//, "name": sel.value};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-204">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-204">&#182;</a>
              </div>
              <p>Build the account object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> account = { <span class="hljs-comment">//id: window.sessionStorage.getItem("CurrentAccountID"),</span>
					status: <span class="hljs-number">0</span>,<span class="hljs-comment">//window.sessionStorage.getItem("AccountStatus"),</span>
					name: $(<span class="hljs-string">'#accountName'</span>).get(<span class="hljs-number">0</span>).value,
					notes: $(<span class="hljs-string">'#accountNotes'</span>).get(<span class="hljs-number">0</span>).value,
					address: $(<span class="hljs-string">'#accountAddress'</span>).get(<span class="hljs-number">0</span>).value,
					address2:$(<span class="hljs-string">'#accountAddress2'</span>).get(<span class="hljs-number">0</span>).value,
					city: $(<span class="hljs-string">'#accountCity'</span>).get(<span class="hljs-number">0</span>).value,
					state: getSelectedOption($(<span class="hljs-string">'#selState'</span>).get(<span class="hljs-number">0</span>)).value,
					zip: $(<span class="hljs-string">'#accountZip'</span>).get(<span class="hljs-number">0</span>).value,
					country: getSelectedOption($(<span class="hljs-string">'#selCountry'</span>).get(<span class="hljs-number">0</span>)).value,
					province: <span class="hljs-string">"-1"</span>, <span class="hljs-comment">// Abandoned field</span>
					department: department,
					industries: ia,
					accountType: type,
					contract: contract
					};</pre></div></div>
            
        </li>
        
        
        <li id="section-205">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-205">&#182;</a>
              </div>
              <p>Finally, account status.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	field = $(<span class="hljs-string">'#selAccountStatus'</span>).get(<span class="hljs-number">0</span>);		
	account.status = field.value;

	<span class="hljs-keyword">return</span> account;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">commitSiteAdminNew</span><span class="hljs-params">()</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-206">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-206">&#182;</a>
              </div>
              <p>New accounts are established with the original first user name
This function prepares the user information for account creation.
Assumes the account data is validated and unique</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	
	<span class="hljs-keyword">var</span> user = 
	{		
		firstname: $(<span class="hljs-string">"#firstname"</span>).val(),
		middlename: $(<span class="hljs-string">'#middlename'</span>).val(),
		lastname: $(<span class="hljs-string">'#lastname'</span>).val(),
		username: $(<span class="hljs-string">'#username'</span>).val(),
		email: $(<span class="hljs-string">'#email'</span>).val(),
		status: <span class="hljs-number">1</span>, <span class="hljs-comment">// New User status</span>
		password: <span class="hljs-string">"prenostik"</span> <span class="hljs-comment">// This will be reset immediately</span>
	}	
	<span class="hljs-keyword">return</span> user;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trimAllFields</span><span class="hljs-params">()</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-207">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-207">&#182;</a>
              </div>
              <p>Condition the user data fields for robustness    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> t = $(<span class="hljs-string">":text"</span>);
	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;t.length; i++)	
		t[i].value = t[i].value.trim();	
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debugDumpAccount</span><span class="hljs-params">(account)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-208">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-208">&#182;</a>
              </div>
              <p>This is strictly a utility function to assist
debugging the complex account object structure</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Debug dump: Account object detail"</span>);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"status: "</span> + account.status);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"id: "</span> + account.id);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"name: "</span> + account.name);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"notes: "</span> + account.notes);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"address: "</span> + account.address);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"address2: "</span> + account.address2);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"city: "</span> + account.city);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"state: "</span> + account.state);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"zip: "</span> + account.zip);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"country: "</span> + account.country);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"province: "</span> + account.province);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"department: "</span> , account.department);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"industry: "</span> , account.industries[<span class="hljs-number">0</span>]);	
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"accountType: "</span> , account.accountType);</pre></div></div>
            
        </li>
        
        
        <li id="section-209">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-209">&#182;</a>
              </div>
              <p>Break out the contract object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(account.contract !=<span class="hljs-literal">null</span>)
	{
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"contract object: "</span> , account.contract);
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"contract ID:"</span> , account.contract.id);
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"contract type:"</span> , account.contract.contractType);
		<span class="hljs-keyword">var</span> sd = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(account.contract.startdate);
		<span class="hljs-keyword">var</span> ed = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(account.contract.expirationdate);
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"contract Start: "</span>, sd.toLocaleDateString());
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"contract End: "</span>,ed.toLocaleDateString() );
	}	
	<span class="hljs-keyword">else</span>
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Contract null"</span>);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-210">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-210">&#182;</a>
              </div>
              <p>Returns the group object from the select passed in.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSelectedOption</span><span class="hljs-params">(selList)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-211">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-211">&#182;</a>
              </div>
              <p>Broken in to steps for clarity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(selList == <span class="hljs-literal">null</span>)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-212">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-212">&#182;</a>
              </div>
              <p>Get the index of the currently selected option</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> index = selList.options.selectedIndex;</pre></div></div>
            
        </li>
        
        
        <li id="section-213">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-213">&#182;</a>
              </div>
              <p>Use the index to get the selected option object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> selected = selList.options.item(index);</pre></div></div>
            
        </li>
        
        
        <li id="section-214">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-214">&#182;</a>
              </div>
              <p>Get the id from the option</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> data = selected.id;
	<span class="hljs-keyword">if</span>(data != -<span class="hljs-number">1</span>)
	{
		<span class="hljs-keyword">return</span> selected;
	}
	<span class="hljs-keyword">else</span>
		<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// No selected option	</span>
}</pre></div></div>
            
        </li>
        
        
        <li id="section-215">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-215">&#182;</a>
              </div>
              <p>This function validates editing changes before submission.
errors are hilighted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidAccount</span><span class="hljs-params">()</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-216">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-216">&#182;</a>
              </div>
              <p>Make sure there are no empty “space” only fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	trimAllFields();</pre></div></div>
            
        </li>
        
        
        <li id="section-217">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-217">&#182;</a>
              </div>
              <p>This function validates all the Account data fields on all tabs
When in edit mode, the Prime user is not included</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(<span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">"AccountMode"</span>) == <span class="hljs-string">"edit"</span>)
	{
		<span class="hljs-keyword">var</span> idList =[
					<span class="hljs-string">"anTab"</span>,		<span class="hljs-comment">// Account Name</span>
					<span class="hljs-string">"addressTab"</span>,	<span class="hljs-comment">// Account address</span>
					<span class="hljs-string">"siteAdminTab"</span>, <span class="hljs-comment">// Account manager user</span>
					<span class="hljs-string">"charTab"</span>,		<span class="hljs-comment">// Characteristics</span>
					<span class="hljs-string">"licenseTab"</span>,	<span class="hljs-comment">// License type</span>
					<span class="hljs-string">"dbTab"</span>			<span class="hljs-comment">// Database settings</span>
					]
	}
	<span class="hljs-keyword">else</span>
	{
		<span class="hljs-keyword">var</span> idList =[
					<span class="hljs-string">"anTab"</span>,		<span class="hljs-comment">// Account Name</span>
					<span class="hljs-string">"addressTab"</span>,	<span class="hljs-comment">// Account address</span>
					<span class="hljs-string">"siteAdminTab"</span>, <span class="hljs-comment">// Account manager user</span>
					<span class="hljs-string">"charTab"</span>,		<span class="hljs-comment">// Characteristics</span>
					<span class="hljs-string">"licenseTab"</span>,	<span class="hljs-comment">// License type</span>
					<span class="hljs-string">"dbTab"</span>			<span class="hljs-comment">// Database settings</span>
					]
	}
	
	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> idList)
	{
		<span class="hljs-keyword">var</span> tabID = idList[i];		
		<span class="hljs-keyword">var</span> audit = validateTab(tabID);
		<span class="hljs-keyword">if</span>(audit.valid == <span class="hljs-literal">false</span>)
		{	<span class="hljs-comment">// Return the id of the tab that failed audit</span>
			audit.tabID = tabID;
			<span class="hljs-keyword">return</span> audit;
		}
	}
	<span class="hljs-keyword">return</span> audit;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">GetCharacterizationList</span><span class="hljs-params">(listName)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-218">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-218">&#182;</a>
              </div>
              <p>Takes the list name passed in and returns 
a handle to the list as well as its crud name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> crudName = <span class="hljs-literal">null</span>;
	<span class="hljs-keyword">var</span> list = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-219">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-219">&#182;</a>
              </div>
              <p>Now get a handle on the list object itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">switch</span> (listName)
	{
	<span class="hljs-keyword">case</span> <span class="hljs-string">'department'</span>:
		list = $(<span class="hljs-string">'#selDepartment'</span>).get(<span class="hljs-number">0</span>);
		crudName = <span class="hljs-string">'department'</span>;
	<span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">'industry'</span>:
		list = $(<span class="hljs-string">'#selIndustry'</span>).get(<span class="hljs-number">0</span>);
		crudName = <span class="hljs-string">'industry'</span>;
	<span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">'account'</span>:
		list = $(<span class="hljs-string">'#selAccountType'</span>).get(<span class="hljs-number">0</span>);
		crudName = <span class="hljs-string">'accounttype'</span>;
	<span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">'contract'</span>:
		list = $(<span class="hljs-string">'#selContractType'</span>).get(<span class="hljs-number">0</span>);
		crudName = <span class="hljs-string">'contracttype'</span>;
	<span class="hljs-keyword">break</span>;

	<span class="hljs-keyword">default</span>:
		list = <span class="hljs-literal">null</span>;
	}
	<span class="hljs-keyword">return</span> { <span class="hljs-string">"selList"</span>:list, <span class="hljs-string">"name"</span>:crudName};

}</pre></div></div>
            
        </li>
        
        
        <li id="section-220">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-220">&#182;</a>
              </div>
              <p>This function updates the characterization lists on the server
with new items. Handles POST, PUT and DELETE via AJAX</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">UpdateCharacterization</span><span class="hljs-params">(charObj)</span>
</span>{	
	<span class="hljs-comment">/*
	charObj={url: 'account', // base url for this type of update
			list: crudName,  // base url for this particular item
			id: editID,		 // ID needed to put and delete
			item: $('#newListValue').get(0).value, // The new text to create (if put or post)
			method: method // REST method
			}
	*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-221">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-221">&#182;</a>
              </div>
              <p>Build the url for the router</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> href = charObj.url + <span class="hljs-string">'/'</span> + charObj.list;</pre></div></div>
            
        </li>
        
        
        <li id="section-222">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-222">&#182;</a>
              </div>
              <p>Make a small object out of the new item data
This is the body in req.body    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> newitem = {<span class="hljs-string">'id'</span>:charObj.id, <span class="hljs-string">'name'</span>:charObj.item};</pre></div></div>
            
        </li>
        
        
        <li id="section-223">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-223">&#182;</a>
              </div>
              <p>Put the url for the REST call together with the data    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> data={<span class="hljs-string">'url'</span>:href, <span class="hljs-string">'body'</span>: newitem};	
	
	<span class="hljs-keyword">var</span> newID;</pre></div></div>
            
        </li>
        
        
        <li id="section-224">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-224">&#182;</a>
              </div>
              <p>Use AJAX to post the new list object to the server.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$.ajax({
			url: href,
			data: data,
			async: <span class="hljs-literal">false</span>, <span class="hljs-comment">// Can't come back without an ID from the server</span>
			method: charObj.method,			
			dataType: <span class="hljs-string">'json'</span>,
			success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(response)</span> </span>{
				<span class="hljs-keyword">if</span> (response.success) 
				{
					toast.notifySuccess(<span class="hljs-string">'Success'</span>, <span class="hljs-string">'List Item updated successfully.'</span>);					
					newID = response.data.id;					
				} 
				<span class="hljs-keyword">else</span> 
				{
					toast.notifyError(<span class="hljs-string">'Error'</span>, <span class="hljs-string">'Error: '</span>+response.error.code+<span class="hljs-string">' - '</span>+response.error.message);
				}
			},
		error: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-225">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-225">&#182;</a>
              </div>
              <p>todo: handle error condition gracefully</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		}

	});</pre></div></div>
            
        </li>
        
        
        <li id="section-226">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-226">&#182;</a>
              </div>
              <p>Return the id for the new option or null for failure</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">return</span> newID;	
}

}) <span class="hljs-comment">// end of document ready function</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
